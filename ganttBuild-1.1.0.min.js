/*! ganttBuild-1.1.0 2013-11-07 */
function ajaxUpdateStudyProp(a,b,c,d){var e=null===d||void 0===d?!0:d,f=encodeURIComponent('"'+a.toString()+'"'),g=encodeURI('"'+b.toString()+'"'),h=encodeURI('"'+c.toString()+'"'),i=encodeURI('"'+e.toString()+'"');if(e||"start"===b&&"end"===b){var j="SetStudyProp("+f+","+g+","+h+","+i+")";setAjaxData(j)}}function ajaxUpdateSubStudy(a,b,c,d){var e=encodeURI('"'+a.toString()+'"'),f=encodeURI('"'+b.toString()+'"'),g=encodeURI('"'+c.toString()+'"'),h=encodeURI('"'+d.toString()+'"'),i=getSessionID(),j="SetSubStudyProp("+e+","+f+","+g+","+h+")";$.ajax({url:"dscript?EXEC-"+i+"-("+j+")",async:!1}).error(function(a){console.log(a)})}function ajaxUpdateProjectProp(a,b,c){var d=encodeURI('"'+a.toString()+'"'),e=encodeURI('"'+b.toString()+'"'),f=encodeURI('"'+c.toString()+'"');setAjaxData("SetProjectProp("+d+","+e+","+f+")")}function ajaxAddStudy(a,b){var c=encodeURI('"'+a.toString()+'"'),d=encodeURI('"'+b.toString()+'"');setAjaxData("AddStudy("+c+","+d+")")}function ajaxRemoveStudies(a){getSessionID();for(var b=0;b<a.length;b++){var c=encodeURI('"'+a[b].toString()+'"');setAjaxData("RemoveStudy("+c+")")}}function ajaxCopyStudy(a,b){var c=encodeURI('"'+a.toString()+'"'),d=encodeURI('"'+b.toString()+'"'),e="CopyStudy("+c+","+d+")",f=getSessionID();$.ajax({url:"dscript?EXEC-"+f+"-("+e+")",async:!1}).error(function(a){console.log(a)})}function submitForm(){var a=$('input[type=submit][value="Update"]');a.length>0&&a.click()}function _AJAXCALL(a,b,c,d){c=c||function(a){console.log(a)},d=d||null;var e=$.ajax({url:"dscript?EXEC-"+b+"-("+a+")"});e.done(d),e.error(c)}function ajaxGetGanttTasks(){for(var a=getSessionID(),b=[],c=ajaxGetTaskNames(a),d=ajaxGetAllTaskProps(a),e=getProjectName(),f=0;f<c.length;f++){var g=c[f],h={},i=e+"_"+g;if(localStorage[i]){var j=localStorage.getItem(i);h=JSON.parse(j),b.push(h)}else{for(var k=ajaxGetSubTaskNames(a,g),l=[],m=0;m<k.length;m++){var n=k[m],o={};o.subID=n,l.push(o)}for(var p=0;p<d.length;p++){var q=d[p];if("subtasks"!==q){var r=ajaxGetTaskProp(a,g,q);r=parseString(r),h[q]=r}for(var s=0;s<l.length;s++){var o=l[s],t=o.subID,u=ajaxGetSubTaskProp(a,g,t,q);u=parseString(u),o[q]=u}}h.subtasks=l;var j=JSON.stringify(h);localStorage.setItem(i,j),b.push(h)}}return b}function ajaxGetTaskNames(a){var b="GetStudyNames()",c=[];return $.ajax({url:"dscript?EXEC-"+a+"-("+b+")",async:!1}).done(function(a){c=a.split(",")}),c}function ajaxGetTaskProp(a,b,c){var d=encodeURI('"'+b.toString()+'"'),e=encodeURI('"'+c.toString()+'"'),f="GetStudyProp("+d+","+e+")",g="";return $.ajax({url:"dscript?EXEC-"+a+"-("+f+")",async:!1}).done(function(a){g=a}),g}function ajaxGetAllTaskProps(a){var b="GetAllTaskProps()",c=[];return $.ajax({url:"dscript?EXEC-"+a+"-("+b+")",async:!1}).done(function(a){c=a.split(",")}),c}function ajaxGetSubTaskNames(a,b){var c=encodeURI('"'+b.toString()+'"'),d="GetSubTaskNames("+c+")",e=[];return $.ajax({url:"dscript?EXEC-"+a+"-("+d+")",async:!1}).done(function(a){e=a.split(",")}),e}function ajaxGetSubTaskProp(a,b,c,d){var e=encodeURI('"'+b.toString()+'"'),f=encodeURI('"'+c.toString()+'"'),g=encodeURI('"'+d.toString()+'"'),h="GetSubStudyProp("+e+","+f+","+g+")",i="";return $.ajax({url:"dscript?EXEC-"+a+"-("+h+")",async:!1}).done(function(a){i=a}),i}function getProjectName(){var a="",b=getSessionID(),c="ProjectName";return $.ajax({url:"dscript?EXEC-"+b+"-("+c+")",async:!1}).done(function(b){a=decodeURI(b),a=a.replace(/[^a-zA-Z0-9]/g,"")}),a}function daysBetween(a,b){var c=864e5,d=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),e=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,0),f=Math.ceil(Math.abs((d.getTime()-e.getTime())/c));return f}function Viewport(a){this.x=a.x||0,this.y=a.y||0,this.w=a.w||0,this.h=a.h||0}function translateCoords(a,b){var c=b.viewport,d=a.x-c.x,e=a.y-c.y;return{x:d,y:e}}function createDefaultContextMenu(a){var b,c,d,e,f;b=$('<div class="control_contextmenu" style="display: none; position: absolute"><div class="context_border"></div></div>'),c=$("<ul></ul>"),d=$('<li id="insertPhaseButton"><a href="#">Insert New Phase</a></li>'),d.bind("click",function(b){var c=a.getMouse(b);$(".splitterWrapper").trigger("insertPhase.gantt",c)}),c.append(d),c.append('<div class="context-menu-separator">&nbsp</div>'),e=$('<li id="zoomInButton"><a href="#">Zoom In</a></li>'),e.bind("click",function(){$(".splitterWrapper").trigger("zoomIn.gantt")}),c.append(e),f=$('<li id="zoomOutButton"><a href="#">Zoom Out</a></li>'),f.bind("click",function(){$(".splitterWrapper").trigger("zoomOut.gantt")}),c.append(f),c.append('<div class="context-menu-separator"></div>');var g=b.children(0);return g.append(c),$("body").append(b),b}function GanttCanvas(a,b,c,d){function e(){j.draw(),l(e)}this.start=new Date(d.startDate),this.end=new Date(d.endDate),this.dayWidth=1,this.monthWidth=30,this.canvas=a,this.parent=b,this.master=c,this.ctx=canvasInit("canvas"),this.canvas=a;var f=document.createElement("canvas");void 0!=G_vmlCanvasManager&&G_vmlCanvasManager.initElement(f),f.height=1e3,f.width=1e3,this.gctx=f.getContext("2d"),this.tasks={},this.expandedTasks={},this.numTasks=0,this.highlightBars={},this.phases=d.phases,this.phaseSelectors={},this.zoom=1,this.snapToDate="month",this.displayToolTips=!0,this.isInitialized=!1,document.defaultView&&document.defaultView.getComputedStyle&&(this.stylePaddingLeft=parseInt(document.defaultView.getComputedStyle(a,null).paddingLeft,10)||0,this.stylePaddingTop=parseInt(document.defaultView.getComputedStyle(a,null).paddingTop,10)||0,this.styleBorderLeft=parseInt(document.defaultView.getComputedStyle(a,null).borderLeftWidth,10)||0,this.styleBorderTop=parseInt(document.defaultView.getComputedStyle(a,null).borderTopWidth,10)||0);var g=document.body.parentNode;this.htmlTop=g.offsetTop,this.htmlLeft=g.offsetLeft,this.valid=!1,this.shapes=[[],[],[],[],[],[],[],[],[]],this.dragging=!1,this.selection=[],this.selection[0]=null,this.isResizeDrag=!1,this.expectResize=-1,this.dragoffx=0,this.dragoffy=0,this.header=null,this.displayAxis=d.displayAxis||!1,this.xAxis=d.xAxis||[],this.yAxis=d.yAxis||[],this.selectionColor="#FF3333",this.selectionWidth=2,this.selectionHandles=[],this.selBoxSize=6,this.selBoxColor="darkred";for(var h=0;8>h;h++){var i=new Box;this.selectionHandles.push(i)}this.colors=d.colors||["#0033CC","#FFCC00","#FF6600","#66FFFF","#663300","#FF0066","#3399FF","#669900"],this.colorIndex=0;var j=this,k=60,l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){setTimeout(a,1e3/k)};l(e),this.init()}function editStudies(){var a=$('input[name="GCCB"]').val().split(";"),b=getSessionID(),c=getAllStudyProperties(a[0],b);getAllStudyPropValues(a[0],c,b),getSubStudyNames(a[0],b)}function getAllStudyProperties(a,b){var c=encodeURI('"'+a.toString()+'"'),d="GetAllStudyProps("+c+")",e=[];return $.ajax({url:"dscript?EXEC-"+b+"-("+d+")",async:!1}).done(function(a){e=a.split(",")}),e}function getAllStudyPropValues(a,b,c){var d={},e=encodeURI('"'+a.toString()+'"'),f="GetAllStudyPropValues("+e+")",g="";$.ajax({url:"dscript?EXEC-"+c+"-("+f+")",async:!1}).done(function(a){g=a}),g=g.split(",");for(var h=0;h<b.length;h++){var i=b[h];d[i]=g[h]}return d}function getStudyPropValue(a,b,c){var d=encodeURI('"'+a.toString()+'"'),e=encodeURI('"'+b.toString()+'"'),f="GetStudyPropValue("+d+","+e+")",g="";return $.ajax({url:"dscript?EXEC-"+c+"-("+f+")",async:!1}).done(function(a){g=a}),g}function getSubStudyNames(a,b){var c=encodeURI('"'+a.toString()+'"'),d="GetSubStudyNames("+c+")",e=[];return $.ajax({url:"dscript?EXEC-"+b+"-("+d+")",async:!1}).done(function(a){e=decodeURI(a).split(",")}),e}function setUpdateFunction(a,b){function c(a){var c=snapToMonth(a);b.childNodes[0].innerHTML=c.format("MM/dd/yyyy");var d=b.parentNode,e=d.getElementsByClassName("staticText")[0].innerHTML,f=0,g=$(b).index()-1,h=getCellValue(d,2).toString(),i=c.format("MMMM dd yyyy");return ajaxUpdateStudyProp(h,g,i),$(".splitterWrapper").trigger("gridUpdateTask.gantt",[d,e,f]),!0}a.DateChooser.setUpdateFunction(c)}function createTableDatePicker(a,b){var c=a.get(0),d=cumulativeOffset(c),e=d.left,f=d.top,g=new Date(c.childNodes[0].innerHTML),h=$(".calendar");h.remove();var i=$("#datechooserex0");0==i.length&&(i=$('<p id="datechooserex0"><input id="dateinputex0" type="hidden" value=""></p>'),i.width(50),i.height(20),i.css("position","absolute"),$("body").append(i)),i.offset({top:f,left:e}),i.DateChooser=new DateChooser,i.DateChooser.setXOffset(20),i.DateChooser.setYOffset(20),i.DateChooser.setStartDate(g),setUpdateFunction(i,c),i.DateChooser.display(b),$(".calendar").offset({top:b.pageY,left:b.pageX})}function initializeGanttTable(a){var b=$("#gantt_table"),c=b.find("tbody");c.on("dblclick","td",function(a){var b=$(this),c=b.parent(),d=c.get(0).getElementsByClassName("staticText")[0].innerHTML,e=d.split(".")[1];if("0"===e){var f=$(this).parent().children().index($(this));if(0!==b.children().length){if(b.children().length>1)return;if(3>f)return;if(f===getColNumber("Start")||f===getColNumber("End"))createTableDatePicker(b,a);else{var g=b.children(0);g.attr("contenteditable","true"),b.css({outline:"2px solid black"}),c.children(1).addClass("indexHighlight"),c.children(2).addClass("indexHighlight"),c.get(0).childNodes[0].style.backgroundColor="#FFE066",c.get(0).childNodes[1].style.backgroundColor="#FFE066",f=$(this).parent().children().index($(this)),$(".ganttHeader tr").get(0).childNodes[f].style.backgroundColor="#FFE066"}}g&&g.focusEnd()}}),b.on("blur","td",function(){if(!($(this).find("input").length>0)){var a=$(this),b=a.parent(),c=b.get(0).getElementsByClassName("staticText")[0].innerHTML,d=c.split(".")[1];if("0"===d){var e=this.childNodes[0].innerHTML,f=a.index()-1,g=getCellValue(b.get(0),2).toString();if(ajaxUpdateStudyProp(g,f,e),0!==a.children().length){var h=a.children(0);h.attr("contenteditable","false"),a.css({outline:"none"}),b.children(1).removeClass("indexHighlight"),b.children(2).removeClass("indexHighlight"),b.get(0).childNodes[0].style.backgroundColor="#E4ECF7",b.get(0).childNodes[1].style.backgroundColor="#E4ECF7";var i=$(this).parent().children().index($(this));$(".ganttHeader tr").get(0).childNodes[i].style.backgroundColor="#E4ECF7"}$(".splitterWrapper").trigger("gridUpdateTask.gantt",[b,c])}}}),b.on("keypress","td",function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&($(this).children().trigger("blur"),$(this).trigger("blur"))}),c.on("click","input[type=checkbox]",function(b){var c=$(this).parent().parent();c.toggleClass("highlighted");var d,e=c.is(".highlighted"),f=c.get(0).childNodes[1],g=f.childNodes.length;if(1===g?(d=f.childNodes[0].innerHTML,"undefined"==typeof d&&(d=f.childNodes[0].nodeValue)):2===g&&(d=f.childNodes[1].innerHTML),d&&160!==d.charCodeAt(0)){$(".splitterWrapper").trigger("toggleRowHighlight.gantt",[d,e]);var h=d.split(".")[1];if("0"===h){var i,j=$("#ganttChart"),k=a.canvas,l=k.tasks[d].name,m=$("#GCCB");if(e)m.length<1?m=$('<input type="hidden" id="GCCB" name="GCCB" value="'+l+';">'):(i=m.val(),i+=l+";",m.val(i)),j.append(m);else{i=m.val();for(var n=i.split(";"),o=0;o<n.length;o++){var p=n[o];l===p&&(n.splice(o,1),o--)}i=n.join(";")+";",m.val(i)}b.stopPropagation()}}}),$(".expandable").on("click",toggleRowExpansion),initializeResizeEvents()}function initializeResizeEvents(){var a=document.getElementById("gantt_table"),b=20;$("#ganttTableHeader th").mousedown(function(c){if(c.pageX-$(this).offset().left<=b)headerCell=this.previousSibling;else{if(!(c.pageX-$(this).offset().left>=$(this).width()-b))return;headerCell=this}colNum=$(headerCell).parent().children().index($(headerCell)),3>colNum||(bodyCell=a.childNodes[0].childNodes[0].childNodes[colNum],minWidths[colNum]=null===minWidths[colNum]||void 0===minWidths[colNum]?parseInt(bodyCell.style.width,10):minWidths[colNum],pressed=!0,startX=c.pageX,startWidth=$(headerCell).width(),bodyStartWidth=$(bodyCell).width())}).mousemove(function(a){var c=$(this).parent().children().index($(this));2>c||(a.pageX-$(this).offset().left<=b||a.pageX-$(this).offset().left>=$(this).width()-b?$(this).addClass("resizing"):$(this).removeClass("resizing"))}).mouseleave(function(){$(this).removeClass("resizing")}),$(document).mousemove(function(a){if(pressed){if(bodyStartWidth+(a.pageX-startX)<=minWidths[colNum])return;var b=a.pageX-startX;headerCell.style.minWidth=startWidth+b+"px",headerCell.style.width=startWidth+b+"px",headerCell.style.maxWidth=startWidth+b+"px",bodyCell.style.minWidth=bodyStartWidth+b+"px",bodyCell.style.width=bodyStartWidth+b+"px",bodyCell.style.maxWidth=bodyStartWidth+b+"px"}}),$(document).mouseup(function(){pressed&&($(headerCell).removeClass("resizing"),pressed=!1)})}function getCellElement(a,b,c){return a.rows[b].cells[c].firstChild}function split(a){return a.split(/,|\s|<br>/)}function toggleRowExpansion(a){a.stopPropagation();var b=$(this).next().html(),c=$(this).parent().parent(),d=c.attr("level");$(this).is(".collapsed")?($(this).removeClass("collapsed"),$(this).addClass("expanded"),$(".splitterWrapper").trigger("expandTask.gantt",[b,d])):($(this).removeClass("expanded"),$(this).addClass("collapsed"),$(".splitterWrapper").trigger("collapseTask.gantt",[b,d]))}function canvasZoomIn(){$(".splitterWrapper").trigger("zoomIn.gantt")}function canvasZoomOut(){$(".splitterWrapper").trigger("zoomOut.gantt")}function addTask(){$(".splitterWrapper").trigger("addTask.gantt")}function removeTask(){$(".splitterWrapper").trigger("removeTask.gantt")}function shiftTaskUp(){$(".splitterWrapper").trigger("shiftTasksUp.gantt")}function shiftTaskDown(){$(".splitterWrapper").trigger("shiftTasksDown.gantt")}function saveCanvasAsImage(){$(".splitterWrapper").trigger("saveImage.gantt")}function displayFullScreen(){$(".splitterWrapper").trigger("displayFullScreen.gantt")}function copyTask(){$(".splitterWrapper").trigger("copyTask.gantt")}function addTimeAfter(){}function addTimeBefore(){}function ubertreeUpdatePhaseDate(a,b){var c=b.value;b.getAttribute("value")!==c&&$(".splitterWrapper").trigger("updatePhaseDate.gantt",[a,c])}function toggleDisplayToolTips(a){var b=a.checked;$(".splitterWrapper").trigger("toggleToolTips.gantt",[b])}function snapToDate(a){$(".splitterWrapper").trigger("snapToDate.gantt",[a])}function DateHeaderBar(a,b,c,d,e,f,g){this.x=a,this.y=b,this.w=c,this.h=d,this.startDate=new Date(e),this.endDate=new Date(f),this.numMonths=12*(this.endDate.getFullYear()-this.startDate.getFullYear())+(this.endDate.getMonth()-this.startDate.getMonth()),this.numYears=Math.round(this.numMonths/12),this.canvas=null,this.master=g,this.init()}function setCellWidth(a,b){a.style.width=b+"px",a.style.width=b+"px",a.style.minWidth=b+"px",a.style.minWidth=b+"px",a.style.maxWidth=b+"px",a.style.maxWidth=b+"px"}function getMonthXCords(a,b,c,d){var e=d||1;a.setHours(0,0,0,0),b.setHours(0,0,0,0);var f=[0],g=a.getTime(),h=b.getTime(),i=h-g,j=new Date;j.setYear(a.getFullYear()),j.setMonth(a.getMonth()),j.setDate(1),j.setHours(0,0,0,0);for(var k,l,m,n=0;b>j;)k=Math.round((j.getTime()-g)/i*c),k>0&&(2>e&&e>.5?f.push(k):1>e&&e>.25?0===n%3&&f.push(k):.5>e&&e>.125?0===n%6&&f.push(k):f.push(k)),n++,l=j.getMonth()+1,m=j.getFullYear(),12==l&&(l=0,m++),j.setYear(m),j.setMonth(l),j.setDate(1);return f.push(c),f}function getYearXCords(a,b,c){a.setHours(0,0,0,0),b.setHours(0,0,0,0);var d=[0],e=a.getTime(),f=b.getTime(),g=f-e,h=new Date;h.setYear(a.getFullYear()),h.setMonth(0),h.setDate(1),h.setHours(0,0,0,0);for(var i,j,k;b>h;)i=Math.round((h.getTime()-e)/g*c),i>0&&d.push(i),j=0,k=h.getFullYear()+1,h.setYear(k),h.setMonth(j),h.setDate(1);return d.push(c),d}function drawMonthBar(a,b,c,d,e){for(var f,g=getMonthXCords(b,c,d),h=[],i=[],j=1;j<g.length;j++)f=(g[j]-g[j-1])/2,i.push(2*f),h.push(g[j-1]+f);var k=e/2+.5,l=.75*e;a.beginPath();for(var m=0;m<i.length;m++)a.fillStyle="#6699CC",a.rect(g[m],k,i[m],e-k),a.fill(),a.strokeStyle="#FFFFFF",a.rect(g[m],k,i[m],e-k),a.stroke();drawMonthNames(a,b,h,l)}function drawYearBar(a,b,c,d,e){for(var f,g=getYearXCords(b,c,d),h=[],i=[],j=1;j<g.length;j++)f=(g[j]-g[j-1])/2,i.push(2*f),h.push(g[j-1]+f);var k=e/2+.5,l=.25*e;a.beginPath();for(var m=0;m<i.length;m++)a.fillStyle="#6699CC",a.rect(g[m],0,i[m],k),a.fill(),a.strokeStyle="#FFFFFF",a.rect(g[m],0,i[m],k),a.stroke();drawYearNames(a,b,h,l)}function drawMonthNames(a,b,c,d){var e=Date.monthAbbreviations,f=b.getMonth(),g=d*(4/3),h=g/2,i=.35*h;a.beginPath(),a.fillStyle="#FFFFFF",a.font=i+"px Arial, Helvetica, sans-serif",a.textAlign="center";for(var j=0;j<c.length-1;j++)a.fillText(e[f%12],c[j],d+i/2),f++;a.stroke()}function drawYearNames(a,b,c,d){var e=b.getFullYear(),f=4*d,g=f/2,h=.5*g;a.beginPath(),a.fillStyle="#FFFFFF",a.font=h+"px Arial, Helvetica, sans-serif",a.textAlign="center";for(var i=0;i<c.length;i++)a.fillText(e,c[i],d+h/2),e++;a.stroke()}function GanttGrid(a,b){function c(){for(var a,b,c=2,e=d.element.find('tr.gantt_row[level="0"]'),f=0;f<e.length;f++){a=e[f];var g,h=a.getAttribute("level"),i=a.getElementsByTagName("td")[1];g=1===i.childNodes.length?i.innerHTML:i.childNodes[1].innerHTML,b=d.master.tasks[""+g],b?(b.rowNum=f+c,b.rowElement=a,b.level=h):c--}}this.master=a,this.element=$("#"+b);var d=this;c()}function GanttMasterTask(a){this.id=a.id||null,this.studyID=a.studyID||null,this.name=a.STUDY_ID?a.STUDY_ID.toString():null,this.level=a.level||null,this.start=a.start||null,this.end=a.end||null,this.parent=a.parent||null,this.children=a.children||null,this.master=a.master||null,this.phase=a.phase,this.endEarly=a.endEarly,this.TaskInfo={};for(var b in a)a.hasOwnProperty(b)&&(this.TaskInfo[b]=a[b]);this.addSubTask=function(a){this.subtasks||(this.subtasks=[]),this.subtasks.push(a)}}function GanttMaster(a,b,c){function d(a){var b=$("#canvasWrapper"),c=$("#phaseWrapper"),d=$("#headerWrapper"),e=$("#tableHeadWrapper"),f=$("#vSplitBar"),g=$("#first"),h=$("#second");$(".splitterWrapper");var i=$(".splitterContainer"),j=i.width(),k=f.width(),l=.5*j;f.css({left:l}),g.width(l),h.css({left:l+k,width:j-l-k}),b.css({left:l+k}),b.children(0).get(0).width=h.width()-16,d.css({left:l+k,width:j-l-k}),c.css("left",$("#second").css("left")),c.children(0).get(0).width=h.width()-16,e.width(l),a.canvas.viewport.w=h.width()-16,a.canvas.valid=!1}var e=this;this.element=a,this.parentName=c.parentName,this.tasks={};for(var f,g=0;g<c.tasks.length;g++)f=c.tasks[g],f.master=this,this.addTask(f);this.phases=c.phases,this.phaseOptions=c.phaseOptions,this.gridEditor=new GanttGrid(this,b),this.canvas=new GanttCanvas(document.getElementById(c.name),c.parent,e,c);for(var h in this.tasks)if(this.tasks.hasOwnProperty(h)){var i=this.tasks[h];this.canvas.addTask(i)}initializeGanttTable(this),getScrollbarWidth(),window.onresize=function(){this.resizeTO&&clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},250)},$(window).bind("resizeEnd",function(){d(e)}),$(window).keypress(function(a){13==a.which&&a.preventDefault()}),$(document).keydown(function(a){if(keys[a.which]=!0,keys[17]===!0&&(keys[37]===!0||keys[39]===!0)&&barMoveEventFired!==!0){var b=$("#ganttContainer"),c=$("#canvasWrapper"),d=$("#phaseWrapper"),f=$("#headerWrapper"),g=$("#tableHeadWrapper"),h=$("#vSplitBar"),i=$("#first"),j=$("#second"),k=parseInt(h.css("left"),10),l=Math.round(10*(k/b.width()))/10,m=0,n=0,o=h.parent().width(),p=h.width();keys[17]===!0&&(keys[39]||keys[37])&&(keys[39]===!0?(.5>l&&(k=(b.width()-p)/2),l>=.5&&(k=b.width()-p-myScrollBarWidth),barMoveEventFired=!0):keys[37]===!0&&(l>.5?k=(b.width()-p)/2:.5>=l&&(k=0),barMoveEventFired=!0),h.css({left:k}),i.width(k-m),j.css({left:k+p,width:o-k-p-n}),c.css({left:k+p}),c.children(0).get(0).width=j.width()-16,f.css({left:k+p,width:o-k-p-n}),d.css("left",$("#second").css("left")),d.children(0).get(0).width=j.width()-16,g.width(k-m),e.canvas.viewport.w=j.width()-16,e.canvas.valid=!1)}}),$(document).keyup(function(a){delete keys[a.which],(17===a.which||37===a.which||39===a.which)&&(barMoveEventFired=!1)}),a.bind("canvasUpdateTask.gantt",function(a,b,c,d){var f=e.tasks[b];void 0!==f&&(f.start=c,f.end=d,e.gridEditor.updateDateValues(b,f,c,d))}),a.bind("gridUpdateTask.gantt",function(a,b,c,d){e.canvas.updateValue(b,c,d)}),a.bind("expandTask.gantt",function(a,b){function c(){var a=b.split("."),c=a[0],d=a[1],f=e.gridEditor.expandRow(c,d),g=e.canvas.tasks[b];e.canvas.expandRow(b,g);for(var h,i,j,k=0;k<f.length;k++){h=f[k];var l=getCellValue(h,2),m=(Number(d)+1).toString(),n=g.id+"."+m,o=getCellValue(h,3),p=getCellValue(h,4);i={start:o,end:p,id:n,name:l,level:m},j=new GanttMasterTask(i),e.tasks[n]=j}setColumnWidth(2,e,!0),setColumnWidth(6,e,!0)}if(e.canvas.expandedTasks[b]===!0)c();else{var d=document.getElementById("loadingWrapper"),f=document.getElementById("loadingSpinner");d.className="loadingWrapper",f.className="loading",delayCall(function(){c(),d.className="loadingWrapper done",f.className="loading done"},.1)}e.canvas.expandedTasks[b]=!0}),a.bind("collapseTask.gantt",function(a,b){var c=b.split("."),d=c[0],f=c[1],g=e.gridEditor.collapseRow(d,f),h=e.canvas.tasks[b];e.canvas.collapseRow(d,f,h,g),setColumnWidth(2,e,!1),setColumnWidth(6,e,!1)}),a.bind("zoomIn.gantt",function(){e.canvas.zoomIn()}),a.bind("zoomOut.gantt",function(){e.canvas.zoomOut()}),a.bind("lockTask.gantt",function(){e.canvas.lockTask()}),a.bind("unlockTask.gantt",function(){e.canvas.unlockTask()}),a.bind("insertPhase.gantt",function(a,b){var c=b.x;e.canvas.addPhase(c)}),a.bind("addTask.gantt",function(){var a=e.gridEditor.addTask(),b=e.canvas.tasks[a[0]];ajaxAddStudy(b.name,a[2]),e.canvas.addNewTask(b,a[1],a[2],a[3],a[4]),setColumnWidth(3,e,!0)}),a.bind("removeTask.gantt",function(){for(var a=e.gridEditor.getCheckedRows(),b=getTaskIDS(a),c=[],d=0;d<b.length;d++)c.push(e.canvas.tasks[b[d]].name);ajaxRemoveStudies(c),e.gridEditor.removeTasks(a),e.canvas.removeTasks(b)}),a.bind("copyTask.gantt",function(){for(var a=e.gridEditor.getCheckedRows(),b=0;b<a.length;b++){var c=a[b],d=e.gridEditor.copyTask(c);e.canvas.copyTask(d);var f=e.canvas.tasks[d[0]].name,g=d[2];ajaxCopyStudy(f,g)}setColumnWidth(3,e,!0)}),a.bind("delete.gantt",function(a,b){e.canvas.deleteItem(b)}),a.bind("shiftTasksUp.gantt",function(){var a=e.gridEditor.getCheckedRows(),b=getTaskIDS(a);e.gridEditor.shiftTasksUp(a),e.canvas.shiftTasksUp(b)}),a.bind("shiftTasksDown.gantt",function(){var a=e.gridEditor.getCheckedRows(),b=getTaskIDS(a);e.gridEditor.shiftTasksDown(a),e.canvas.shiftTasksDown(b)}),a.bind("toggleRowHighlight.gantt",function(a,b,c){e.canvas.toggleRowHighlight(b,c)}),a.bind("saveImage.gantt",function(){e.canvas.saveAsImage()}),a.bind("displayFullScreen.gantt",function(){e.canvas.displayFullScreen()}),a.bind("updatePhaseDate.gantt",function(a,b,c){e.canvas.updatePhaseDate(b,c)}),a.bind("toggleToolTips.gantt",function(a,b){e.canvas.toggleToolTips(b)}),a.bind("snapToDate.gantt",function(a,b){e.canvas.setDateSnap(b)})}function showSpinner(){var a=document.getElementById("loadingWrapper"),b=document.getElementById("loadingSpinner");a.className="loadingWrapper",b.className="loading"}function hideSpinner(){var a=document.getElementById("loadingWrapper"),b=document.getElementById("loadingSpinner");a.className="loadingWrapper done",b.className="loading done"}function inherit(a){function b(){}if(null===a)throw new TypeError;if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw new TypeError;return b.prototype=a,new b}function inheritFrom(a,b){function c(){}if(null===b.prototype)throw new TypeError;if(Object.create)return Object.create(b.prototype);var d=typeof b.prototype;if("object"!==d&&"function"!==d)throw new TypeError;return c.prototype=b.prototype,a.prototype=new c,a.uber=b.prototype,a.prototype.constructor=a,new c}function roundRect(a,b,c,d,e,f,g,h){"undefined"==typeof h&&(h="#000000"),"undefined"==typeof f&&(f=50),a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath(),h&&(a.strokeStyle=h,a.stroke()),g&&(a.fillStyle=g,a.fill())}function ShapeException(a){this.message=a,this.name="ShapeException"}function Shape(a){isNaN(a.x)||isNaN(a.y)||isNaN(a.w)||isNaN(a.h),this.x=0===a.x?0:a.x||10,this.y=0===a.y?0:a.y||10,this.w=0===a.w?0:a.w||10,this.h=0===a.h?0:a.h||10,this.dragX=a.dragX||!1,this.dragY=a.dragY||!1,this.fill=a.fill||"#AAAAAA",this.strokeStyle=a.strokeStyle||this.fill,this.highlightSelected=a.highlightSelected||!0,this.selectionWidth=a.selectionWidth||0,this.borderWidth=a.borderWidth||1,this.points=a.points||null,this.angle=a.angle||0,this.rotate(this.angle)}function calcDiemnsions(a){for(var b=1/0,c=-1/0,d=1/0,e=-1/0,f=0;f<a.points.length;f++){var g=a.points[f];b=g.x<b?g.x:b,d=g.y<d?g.y:d,c=g.x>c?g.x:c,e=g.y>e?g.y:e}var h={};return h.center={},h.x=b,h.y=d,h.w=c-b,h.h=e-d,h.center.x=b+(c-b)/2,h.center.y=d+(e-d)/2,h}function Rectangle(a){Shape.call(this,a),this.radius=a.radius||0,this.draw=function(a){roundRect(a,this.x,this.y,this.w,this.h,this.radius,this.fill,this.strokeStyle)}}function Box(){this.x=0,this.y=0,this.w=1,this.h=1,this.fill="#000000",this.display=!1}function TextBox(a){Shape.call(this,a),this.text=a.text||"",this.font=a.font||"sans-serif",this.fontsize=a.fontsize||.6*this.h,this.fontcolor=a.fontcolor||"#000000",this.textAlign=this.textAlign=a.textAlign||"left"}function LineGroup(a){Shape.call(this,a),this.group=!0,this.numLines=a.numLines||0,this.highlightSelected=!1,this.lines=[],this.x=this.x-this.w/2}function calcTextWidth(a,b){var c=document.createElement("canvas"),d=c.getContext("2d");d.font=b,d.fillText(a,0,0);var e=d.measureText(a);return e.width}function LineGroupSelector(a){if(Shape.call(this,a),this.linegroup=a.linegroup,this.name=a.name||null,this.text=a.text||null,null!==this.text){var b=calcTextWidth(this.name,"11px sans-serif"),c=this.x-this.w/2-b-10,d=a.editableName||!1,e=new EditableTextBox({x:c,y:this.y,w:b,h:this.h,text:this.text,name:this.name,editableName:d});e.txtWidth=b,this.textBox=e}this.isSelector=!0,this.fill=hex2rgb(this.fill,1),this.assignedPhases=a.assignedPhases||[]}function EditableTextBox(a){TextBox.call(this,a),this.name=a.name||null,this.highlightSelected=!1,this.editableName=a.hasOwnProperty("editableName")?!0:!1}function CollisionBoxTextBox(a){TextBox.call(this,a),this.text=a.text||["",""],this.display=a.display||!1,this.strokeStyle=a.strokeStyle||"#AAAAAA",this.lineWidth=a.lineWidth||1,this.parentWidth=a.parentWidth||0,this.widthCalculated=!1}function CollisionLine(a){Shape.call(this,a),this.collisionBlock=a.collisionBlock,this.fill=hex2rgb(this.fill,1)}function star(a,b,c,d,e,f){a.save(),a.beginPath(),a.translate(b,c),a.moveTo(0,0-d);for(var g=0;e>g;g++)a.rotate(Math.PI/e),a.lineTo(0,0-d*f),a.rotate(Math.PI/e),a.lineTo(0,0-d);a.fill(),a.restore()}function PhaseGroup(a){if(Shape.call(this,a),this.selectors=a.selectors||{},this.isGroup=!0,this.linegroup=a.linegroup||null,this.name=a.name,this.groupNumber=a.groupNumber,this.text=a.name,this.isSelector=!0,null!==this.text){var b=calcTextWidth(this.name,"11px sans-serif"),c=this.x-this.w/2-b-10,d=new EditableTextBox({x:c,y:this.y,w:b,h:this.h,text:this.text,name:this.name});d.txtWidth=b,this.textBox=d}this.groupSelectors(),Object.defineProperty(this,"fill",{value:hex2rgb("#888888",1),writable:!1,enumerable:!0,configurable:!1})}function getMyCollisionLine(a,b){for(var c,d=a.linegroup.lines,e=d[1].y-d[0].y,f=d.length;f;){if(b.y>d[f-1].y&&b.y-d[f-1].y<e){c=d[f-1];break}f--}return c}function updateTaskPhase(a,b){var c=$("input[name=Field1]:checked","#subContextMenu").val();a.phase=c;var d=b.getPhases()[c].fill;if(void 0===d){var e=b.master.tasks[a.id].rowNum;d=0===e%2?"rgba(0, 102, 0, 0.5)":"rgba(0, 204, 0, 0.5)"}else d=hex2rgb(d,.5);if(a.fill=d,a.children)for(var f=0;f<a.children.length;f++)a.children[f].fill=d;a.setPhaseLinePosition(b),ajaxUpdateStudyProp(a.name,"phase",a.phase)}function GanttCanvasTask(a){this.x=0===a.x?0:a.x||10,this.y=0===a.y?0:a.y||10,this.w=0===a.w?0:a.w||10,this.h=0===a.h?0:a.h||10,this.dragX=a.dragX||!1,this.dragY=a.dragY||!1,this.isLocked=!1,this.fill=a.fill||"#AAAAAA",this.strokeStyle=a.strokeStyle||this.fill,this.highlightSelected=a.highlightSelected||!0,this.selectionWidth=a.selectionWidth||0,this.borderWidth=a.borderWidth||2,this.borderColor=a.borderColor||"#000000",this.detectCollision=a.detectCollision||!1,this.collisionLine=a.collisionLine||null,this.isTask=!0,this.id=a.id||null,this.studyID=a.studyID||null,this.level=parseInt(a.level,10)||null,this.name=a.name||null,this.parent=a.parent||null,this.children=a.children||null,this.phase=a.phase||"Start",this.isLocked=a.isLocked||!1,this.endEarly="false"===a.endEarly||a.endEarly===!1?!1:!0,this.TaskInfo=a.TaskInfo||null}function getDateDiff(a,b){for(var c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),d=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,0),e=0,f=0,g=0;d>c;){var h=c;if(c.setFullYear(c.getFullYear()+1),d>=c)e++;else for(c.setFullYear(c.getFullYear()-1);d>c;)if(h=c,c.setMonth(c.getMonth()+1),d>=c)f++;else for(c.setMonth(c.getMonth()-1);d>=c;)g++,c.setDate(c.getDate()+1)}return{year:e,month:f,day:g}}function resizeTables(a){for(var b=[],c=0;c<a.length;c++)b.push(document.getElementById(a[c]));var d=[];for(c=0;c<b.length;c++)for(j=0;j<b[c].rows[0].cells.length;j++){var e=b[c].rows[0].cells[j];(!d[j]||d[j]<e.clientWidth)&&(d[j]=e.clientWidth)}for(c=0;c<b.length;c++)for(j=0;j<b[c].rows[0].cells.length;j++)b[c].rows[0].cells[j].style.width=d[j]+"px",b[c].rows[0].cells[j].style.minWidth=d[j]+"px",b[c].rows[0].cells[j].style.maxWidth=d[j]+"px"}function formatTables(a,b){function c(a,b,c){var d=parseInt($(b).css("padding-left"),10)+parseInt($(b).css("padding-right"),10)+parseInt($(b).css("border-left"),10)+parseInt($(b).css("border-right"),10);parseInt($(c).css("padding-left"),10)+parseInt($(c).css("padding-right"),10)+parseInt($(c).css("border-left"),10)+parseInt($(c).css("border-right"),10),0==a&&d++;var e=Math.max($(b).outerWidth()+0,$(c).outerWidth()+0);b.style.width=e-0+"px",c.style.width=e-0+"px",b.style.minWidth=e-0+"px",c.style.minWidth=e-0+"px",b.style.maxWidth=e-0+"px",c.style.maxWidth=e-0+"px"}var d=b||!1,e=$(".gantt"),f=e[0].childNodes[1].childNodes[0].childNodes,g=e[1].childNodes[0].childNodes[a].childNodes;if(d)c(d,f[d],g[d]);else for(var h=0;h<f.length;h++)c(h,f[h],g[h])}function setColumnWidth(a,b,c){var d=document.getElementById("ganttTableHeader"),e=document.getElementById("gantt_table"),f=d.childNodes[1].childNodes[0].childNodes[a],g=e.childNodes[0].childNodes[0].childNodes[a],h=parseInt(f.style.paddingRight,10)+parseInt(f.style.paddingLeft,10),i=parseInt(g.style.paddingRight,10)-parseInt(g.style.paddingLeft,10),j=parseInt(f.clientWidth,10)-(isNaN(h)?0:h),k=parseInt(g.clientWidth,10)-(isNaN(i)?0:i),l=Math.max(j,k);c?(b["old1_"+a]=j,b["old2_"+a]=k,f.style.width=l+"px",g.style.width=l+"px",f.style.minWidth=l+"px",g.style.minWidth=l+"px",f.style.maxWidth=l+"px",g.style.maxWidth=l+"px"):(f.style.width=b["old1_"+a]+"px",g.style.width=b["old2_"+a]+"px",f.style.minWidth=b["old1_"+a]+"px",g.style.minWidth=b["old2_"+a]+"px",f.style.maxWidth=b["old1_"+a]+"px",g.style.maxWidth=b["old2_"+a]+"px")}function getCellValue(a,b){return a.childNodes[b].childNodes[0].innerHTML}function getColNumber(a){var b=$(".ganttHeader"),c=b.children(0).children(1).children();return c.filter(function(){return $(this).text()==a}).index()}function incrementStudyID(a){function b(a){return a-0==a&&(a+"").replace(/^\s+|\s+$/g,"").length>0}var c;if(b(a))c=Number(a)+1;else if(-1!==a.indexOf(".")){var d=a.split("."),e=(parseInt(d[0],10)+1).toString();d[0]=e,c=d.join(".")}return c}function getSubIDs(a,b){for(var c,d,e,f=[],g=parseInt(b,10)+1,h=$("tr.gantt_row[study='"+a+"'][level='"+g+"']"),i=0;i<h.length;i++)c=h[i],d=c.childNodes[1],e="idCell"===d.className?d.childNodes[1].innerHTML:d.innerHTML,f.push(e);return f}function getTaskIDS(a){for(var b,c,d,e=[],f=0;f<a.length;f++){b=a[f],c=b.getElementsByClassName("staticText")[0].innerHTML,b.getAttribute("studyID"),e.push(c),d=b.getAttribute("level");
var g=getSubIDs(c,d);g.length>0&&e.concat(g)}return e}function getNextSibling(a){var b=a,c=a.getAttribute("level");do b=b.nextSibling;while(b.getAttribute("level")!==c);return b}function getTempalteRow(){var a=document.getElementsByClassName("gantt_row");a.length;var b,c=$(".gantt_row").filter(function(){var a=null;return $(this).is(":visible")&&(a=this.childNodes[2].childNodes[0].innerHTML,"P0"===a&&(b=this)),$(this).is(":visible")&&0==$(this).attr("level")&&"P0"!==a&&null!==a}),d=null===c||0===c.length?b:c[c.length-1];return d}function getFirstTemplateRow(){for(var a,b=document.getElementsByClassName("gantt_row"),c=b.length-1;c&&(a=b[c],null===a.getAttribute("study"));)c--;return a=b[c+1]}function getRowName(a){var b,c=1,d=a.tasks;for(var e in d)if(d.hasOwnProperty(e)){var f=d[e].name;-1!==f.indexOf("NewStudy")&&c++}return b="NewStudy"+c}function geLastRow(){for(var a,b,c=document.getElementsByClassName("gantt_row"),d=c.length;d;){if(a=c[d-1],null!==a.getAttribute("study")&&"none"!==a.style.display){b=a;break}d--}return a}function getScrollbarWidth(){if(void 0===myScrollBarWidth){var a=document.createElement("div");a.style.visibility="hidden",a.style.width="100px",document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var c=document.createElement("div");c.style.width="100%",a.appendChild(c);var d=c.offsetWidth;a.parentNode.removeChild(a),myScrollBarWidth=b-d}return myScrollBarWidth}function cumulativeOffset(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{top:b,left:c}}function fitToContainer(a){var b=document.getElementById(a),c=b.parentNode;b.width=c.offsetWidth,b.height=c.offsetHeight}function hasClass(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1}function getStyle(a,b){if(document.getElementById){var c=a.style[toCamelCase(b)];return c||(document.defaultView?c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b):a.currentStyle&&(c=a.currentStyle[toCamelCase(b)])),c}}function setStyle(a,b,c){document.getElementById(a).style[b]=c}function toCamelCase(a){var b=a.split("-");if(1==b.length)return b[0];for(var c=0==a.indexOf("-")?b[0].charAt(0).toUpperCase()+b[0].substring(1):b[0],d=1,e=b.length;e>d;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c}function contains(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}function delayCall(a,b){setTimeout(a,1e3*b)}function addEventListener(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function monthDiff(a,b){var c;return c=12*(b.getFullYear()-a.getFullYear()),c-=a.getMonth()+1,c+=b.getMonth(),0>=c?0:c}function parseString(a){var b=a;return b=b.replace(/[^a-zA-Z0-9&\/\\#,+()$~%.'":*?<>{}]/g," "),b=b.trim()}function formatString(a){var b=a;return b=b.replace(/[^a-zA-Z0-9&\/\\#,+()$~%.'":*?<>{}-]/g," "),b=b.trim()}function rgbToHex(a,b,c){if(a>255||b>255||c>255)throw"Invalid color component";return(a<<16|b<<8|c).toString(16)}function hex2rgb(a,b){var c;if(a.match(/rgb/)){var d=a.match(/\d+/g);return d[3]=b,"rgba("+d.join(",")+")"}c=a.replace("#",""),c=c.match(new RegExp("(.{"+c.length/3+"})","g"));for(var e=0;e<c.length;e++)c[e]=parseInt(1==c[e].length?c[e]+c[e]:c[e],16);return"undefined"!=typeof b&&c.push(b),"rgba("+c.join(",")+")"}function snapToMonth(a){var b=new Date(a.getFullYear(),a.getMonth(),1,0,0,0,0),c=a.getDate(),d=a.getLastDayOfMonth().getDate();return c>Math.floor(d/2)&&(11===a.getMonth()?(b.setFullYear(b.getFullYear()+1),b.setMonth(0)):b.setMonth(b.getMonth()+1)),b}function getDurationString(a,b){var c,d=[],e=Date.dateDiff(a,b);1===e.year?d.push("1 year"):e.year>1&&d.push(e.year+" years");var f=e.month+Math.round(e.day/30);return f>=12&&(f-=12,void 0!==d[0]&&null!==d[0]?d[0]=parseInt(d[0].replace(" years",""),10)+1+" years":d.push("1 year")),1===f?d.push("1 month"):f>1&&12>f&&d.push(f+" months"),c=d.join(", ")}function toggleCheckBoxes(a){var b=$("#gantt_table").find("input[type=checkbox]");$(a).is(":checked")?b.prop("checked",!1):b.prop("checked",!0),b.each(function(){$(this).is(":visible")&&$(this).click()})}function canvasInit(a){var b=document.getElementById(a);return void 0!=G_vmlCanvasManager&&G_vmlCanvasManager.initElement(b),b.getContext?b.getContext("2d"):void 0}function sortTable(a,b,c){var d,e=a.tBodies[0],f=Array.prototype.slice.call(e.rows,0);for(c=-(+c||-1),f=f.sort(function(a,d){return c*a.cells[b].textContent.trim().localeCompare(d.cells[b].textContent.trim())}),d=0;d<f.length;++d)e.appendChild(f[d])}function makeSortable(a){var b,c=a.tHead;if(c&&(c=c.rows[0])&&(c=c.cells),c)for(b=c.length;--b>=0;)(function(b){var d=1;c[b].addEventListener("click",function(){sortTable(a,b,d=1-d)})})(b)}function makeAllSortable(a){a=a||document.body;for(var b=a.getElementsByTagName("table"),c=b.length;--c>=0;)makeSortable(b[c])}!function(a,b){"use strict";function c(a,b,d){var e=this;return null==e||e.constructor!=c?new c(a,b,d):(x(a,"Object")?d=a:x(a,"Function")?(d=b,b=a):x(b,"Object")?(d=b,b=null,e.name=a):e.name=a,F(e,d),e.id||(e.id=++nb),null==e.fn&&(e.fn=b),e.stats=H(e.stats),e.times=H(e.times),void 0)}function d(a){var b=this;return null==b||b.constructor!=d?new d(a):(b.benchmark=a,jb(b),void 0)}function e(a){var b=this;return null==b||b.constructor!=e?new e(a):a instanceof e?a:J(b,{timeStamp:+new Date},"string"==typeof a?{type:a}:a)}function f(a,b){var c=this;return null==c||c.constructor!=f?new f(a,b):(x(a,"Object")?b=a:c.name=a,F(c,b),void 0)}function g(){for(var a,b=-1,c=arguments.length,d=k.call(this),e=d.length;++b<c;)if(a=arguments[b],x(a,"Array"))for(var f=0,g=a.length;g>f;f++,e++)f in a&&(d[e]=a[f]);else d[e++]=a;return d}function h(a,b,c){for(var d=a+b,e=c?c.length:0,f=a-1,g=a+e,h=this,i=Array(b),j=k.call(h,d);++f<d;)f in h&&(i[f-a]=h[f],delete h[f]);for(f=a-1;++f<g;)h[f]=c[f-a];for(a=f--,g=Qb(0,(h.length>>>0)-b+e);++f<g;)f-a in j?h[f]=j[f-a]:f in h&&delete h[f];for(b=b>e?b-e:0;b--;)f=g+b,f in h&&delete h[f];return h.length=g,i}function i(){var a,b,c=-1,d=Object(this),e=d.length>>>0,f=Pb(e/2);if(e>1)for(;++c<f;)a=e-c-1,b=a in d?d[a]:Eb,c in d?d[a]=d[c]:delete d[a],b!=Eb?d[c]=b:delete d[c];return d}function j(){return h.call(this,0,1)[0]}function k(a,b){var c=-1,d=Object(this),e=d.length>>>0,f=[];for(a=m(a),a=0>a?Qb(e+a,0):Rb(a,e),a--,b=null==b?e:m(b),b=0>b?Qb(e+b,0):Rb(b,e);++c,++a<b;)a in d&&(f[c]=d[a]);return f}function l(a,b){var c=Object(this),d=c.length>>>0;return a=m(a),a=0>a?Qb(d+a,0):Rb(a,d),b=1==arguments.length?d-a:Rb(Qb(m(b),0),d-a),h.call(c,a,b,k.call(arguments,2))}function m(a){return a=+a,0!==a&&isFinite(a)?a-a%1:a||0}function n(){var a=Object(this);return h.call(a,0,0,arguments),a.length}function o(a,b){return function(){a.apply(b,arguments)}}function p(){return p=function(a,b){var d,e=pb?define.amd:c,f=Eb+"createFunction";return E((pb?"define.amd.":"Benchmark.")+f+"=function("+a+"){"+b+"}"),d=e[f],delete e[f],d},p=Jb.browser&&(p("",'return"'+Eb+'"')||C)()==Eb?p:Function,p.apply(null,arguments)}function q(a,b){a._timerId=setTimeout(b,1e3*a.delay)}function r(a){Db.appendChild(a),Db.innerHTML=""}function s(){var a,c,d=!0,e=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];return function(b,e){function f(){this.valueOf=0}f.prototype.valueOf=0;for(e in new f)b+="valueOf"==e?1:0;for(e in arguments)"0"==e&&(d=!1);c=2==b,a=!b}(0),s=function(f,g,h){h||(h={});var i=f;f=Object(f);var j,k,l,m,n=!i,p=h.which,q="all"==p,r=-1,s=f,t=f.length,u=q||"own"==p,v={},y=x(f,"Function"),z=h.bind;if(z!==b&&(g=o(g,z)),q&&Jb.getAllKeys)for(r=0,l=sb(f),t=l.length;t>r&&(k=l[r],g(f[k],k,f)!==!1);r++);else{for(k in f)if(n=!(y&&"prototype"==k||c&&(O(v,k)||!(v[k]=!0))||!(!u||u&&O(f,k))||g(f[k],k,f)!==!1))break;if(!n&&(d&&w(f)||(Mb||Nb)&&x(f,"String")&&(s=Mb?f.split(""):f)))for(;++r<t&&!(n=g(s[r],String(r),f)===!1););if(!n&&a)for(j=f.constructor,m=j&&j.prototype&&j.prototype.constructor===j,r=0;7>r&&(k=e[r],m&&"constructor"==k||!O(f,k)||g(f[k],k,f)!==!1);r++);}return i},s.apply(null,arguments)}function t(a){return!O(a,"toString")&&(/^[\s(]*function[^(]*\(([^\s,)]+)/.exec(a)||0)[1]||""}function u(a){return V(a,function(a,b){return a+b})/a.length||0}function v(a,b){var c=b;return A(a)?c=String(a):Jb.decompilation&&(c=(/^[^{]+\{([\s\S]*)}\s*$/.exec(a)||0)[1]),c=(c||"").replace(/^\s+|\s+$/g,""),/^(?:\/\*+[\w|\W]*?\*\/|\/\/.*?[\n\r\u2028\u2029]|\s)*(["'])use strict\1;?$/.test(c)?"":c}function w(){return w=function(a){return"[object Arguments]"==Cb.call(a)},Lb&&(w=function(a){return O(a,"callee")&&!(Ab&&Ab.call(a,"callee"))}),w(arguments[0])}function x(a,b){return null!=a&&Cb.call(a)=="[object "+b+"]"}function y(a,b){var c=null!=a?typeof a[b]:"number";return!/^(?:boolean|number|string|undefined)$/.test(c)&&("object"==c?!!a[b]:!0)}function z(a){var b=!1;if(!a||"object"!=typeof a||w(a))return b;var c=a.constructor;return!Jb.nodeClass&&"function"!=typeof a.toString&&"string"==typeof(a+"")||x(c,"Function")&&!(c instanceof c)?b:Jb.iteratesOwnFirst?(s(a,function(a,c){b=c}),b===!1||O(a,b)):(s(a,function(c,d){return b=!O(a,d),!1}),b===!1)}function A(a){return O(a,"toString")||x(a,"String")}function B(a){return function(){var b=[this];return b.push.apply(b,arguments),a.apply(null,b)}}function C(){}function D(a){try{var b=qb&&rb(a)}catch(c){}return b||null}function E(a){var b=pb?define.amd:c,d=ob.createElement("script"),e=ob.getElementsByTagName("script")[0],f=e.parentNode,g=Eb+"runScript",h="("+(pb?"define.amd.":"Benchmark.")+g+"||function(){})();";try{d.appendChild(ob.createTextNode(h+a)),b[g]=function(){r(d)}}catch(i){f=f.cloneNode(!1),e=null,d.text=a}f.insertBefore(d,e),delete b[g]}function F(a,b){b=J({},a.constructor.options,b),a.options=M(b,function(b,c){null!=b&&(/^on[A-Z]/.test(c)?L(c.split(" "),function(c){a.on(c.slice(2).toLowerCase(),b)}):O(a,c)||(a[c]=H(b)))})}function G(){var a=this,b=a.benchmark,c=b._original;c.aborted?(a.teardown(),b.running=!1,lb(a)):++a.cycles<b.count?Jb.timeout?setTimeout(function(){b.compiled.call(a,Kb)},0):b.compiled.call(a,Kb):(Kb.stop(a),a.teardown(),q(b,function(){lb(a)}))}function H(a){function b(a){this.raw=a}function c(c,d){if(!c||c.constructor!=b)if(c===Object(c))v[v.length++]={key:d,parent:g,source:a};else try{g[d]=c}catch(e){}}function d(a){for(var c=Eb;a[c]&&a[c].constructor!=b;)c+=1;return c}var e,f,g,h,i,j,k,l,m,n,o,p,q,r={value:a},t=0,u=[],v={length:0},w=[];do{if(k=r.key,n=r.parent,p=r.source,g=a=p?p[k]:r.value,e=f=i=!1,a===Object(a)){if(x(a.deepClone,"Function"))g=a.deepClone();else switch(h=a.constructor,Cb.call(a)){case"[object Array]":g=new h(a.length);break;case"[object Boolean]":g=new h(1==a);break;case"[object Date]":g=new h(+a);break;case"[object Object]":z(a)&&(g={});break;case"[object Number]":case"[object String]":g=new h(a);break;case"[object RegExp]":g=h(a.source,(a.global?"g":"")+(a.ignoreCase?"i":"")+(a.multiline?"m":""))}if(g&&g!=a&&(i=p&&Jb.descriptors&&tb(p,k),!(e=i&&(i.get||i.set)))){if(j=vb(a))m=d(a),a[m]&&(f=g=a[m].raw);else for(q=0,l=w.length;l>q;q++)if(r=w[q],r.object===a){f=g=r.clone;break}f||(j?(a[m]=new b(g),u.push({key:m,object:a})):w.push({clone:g,object:a}),s(a,c,{which:"all"}))}}n?e||i&&!(i.configurable&&i.enumerable&&i.writable)?("value"in i&&(i.value=g),Bb(n,k,i)):n[k]=g:o=g}while(r=v[t++]);for(t=0,l=u.length;l>t;t++)r=u[t],delete r.object[r.key];return o}function I(a,b,c){var d=a;a=Object(a);var e=b,f=-1,g=a.length,h=!(!a.snapshotItem||!(g=a.snapshotLength)),i=(Mb||Nb)&&x(a,"String"),j=h||i||"item"in a,k=a;if(g===g>>>0){if(j)if(b=function(a,b){return e.call(this,a,b,k)},i)a=a.split("");else for(a=[];++f<g;)a[f]=h?d.snapshotItem(f):d[f];L(a,b,c)}else M(a,b,c);return d}function J(a){var b=a;return delete arguments[0],L(arguments,function(a){s(a,function(a,c){b[c]=a})}),b}function K(a,b,c){var d;return"successful"==b?b=function(a){return a.cycles&&isFinite(a.hz)}:("fastest"==b||"slowest"==b)&&(d=K(a,"successful").sort(function(a,c){return a=a.stats,c=c.stats,(a.mean+a.moe>c.mean+c.moe?1:-1)*("fastest"==b?1:-1)}),d=K(d,function(a){return 0==d[0].compare(a)})),d||V(a,function(d,e,f){return b.call(c,e,f,a)?(d.push(e),d):d},[])}function L(a,c,d){var e=-1,f=(a=Object(a)).length>>>0;for(d!==b&&(c=o(c,d));++e<f&&!(e in a&&c(a[e],e,a)===!1););return a}function M(a,b,c){return s(a,b,{bind:c,which:"own"})}function N(a){return a=String(a).split("."),a[0].replace(/(?=(?:\d{3})+$)(?!\b)/g,",")+(a[1]?"."+a[1]:"")}function O(){return O=function(a,b){var c=null!=a&&(a.constructor||Object).prototype;return!!c&&b in Object(a)&&!(b in c&&a[b]===c[b])},x(ub,"Function")?O=function(a,b){return null!=a&&ub.call(a,b)}:{}.__proto__==Object.prototype&&(O=function(a,b){var c=!1;return null!=a&&(a=Object(a),a.__proto__=[a.__proto__,a.__proto__=null,c=b in a][0]),c}),O.apply(this,arguments)}function P(a,b,c){var d=m(c),e=(a=Object(a)).length>>>0;for(d=(0>d?Qb(0,e+d):d)-1;++d<e;)if(d in a&&b===a[d])return d;return-1}function Q(a,b){return M(b,function(b,c){a=a.replace(RegExp("#\\{"+c.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"\\}","g"),b)}),a}function R(a,d){function g(){var a,c=i(n);return c&&(n.on("complete",h),a=n.events.complete,a.splice(0,0,a.pop())),t[p]=x(n&&n[d],"Function")?n[d].apply(n,m):b,!c&&h()}function h(b){var c,d=n,f=i(d);if(f&&(d.off("complete",h),d.emit("complete")),r.type="cycle",r.target=d,c=e(r),s.onCycle.call(a,c),c.aborted||l()===!1)r.type="complete",s.onComplete.call(a,e(r));else if(n=o?a[0]:t[p],i(n))q(n,g);else{if(!f)return!0;for(;g(););}return b?(b.aborted=!0,void 0):!1}function i(a){var b=m[0]&&m[0].async;return Object(a).constructor==c&&"run"==d&&((null==b?a.options.async:b)&&Jb.timeout||a.defer)}function l(){var b=t.length;if(o){do++p>0&&j.call(a);while((b=a.length)&&!("0"in a))}else for(;++p<b&&!(p in t););return(o?b:b>p)?p:p=!1}var m,n,o,p=-1,r={currentTarget:a},s={onStart:C,onCycle:C,onComplete:C},t=T(a,function(a){return a});if(x(d,"String")?m=k.call(arguments,2):(s=J(s,d),d=s.name,m=x(m="args"in s?s.args:[],"Array")?m:[m],o=s.queued),l()!==!1)if(n=t[p],r.type="start",r.target=n,s.onStart.call(a,e(r)),a.aborted&&a.constructor==f&&"run"==d)r.type="cycle",s.onCycle.call(a,e(r)),r.type="complete",s.onComplete.call(a,e(r));else if(i(n))q(n,g);else for(;g(););return t}function S(a,b,c){var d=[],e=(a=Object(a)).length,f=e===e>>>0;return c||(c=": "),I(a,function(a,b){d.push(f?a:b+c+a)}),d.join(b||",")}function T(a,b,c){return V(a,function(d,e,f){return d[f]=b.call(c,e,f,a),d},Array(Object(a).length>>>0))}function U(a,c){return T(a,function(a){return null==a?b:a[c]})}function V(a,b,c){var d=arguments.length<3;return L(a,function(e,f){c=d?(d=!1,e):b(c,e,f,a)}),c}function W(){var a,b=this,c=Fb.resetSuite;return b.running&&(a=e("abort"),b.emit(a),(!a.cancelled||c)&&(Fb.abortSuite=!0,b.reset(),delete Fb.abortSuite,c||(b.aborted=!0,R(b,"abort")))),b}function X(a,b,d){var f=this,g=c(a,b,d),h=e({type:"add",target:g});return f.emit(h),h.cancelled||f.push(g),f}function Y(a){var b=this,c=new b.constructor(J({},b.options,a));return M(b,function(a,b){O(c,b)||(c[b]=a&&x(a.clone,"Function")?a.clone():H(a))}),c}function Z(a){var b=this,c=new b.constructor;return c.push.apply(c,K(b,a)),c}function $(){var a,b=this,c=Fb.abortSuite;return b.running&&!c?(Fb.resetSuite=!0,b.abort(),delete Fb.resetSuite):!b.aborted&&!b.running||(b.emit(a=e("reset")),a.cancelled)||(b.running=!1,c||R(b,"reset")),b}function _(a){var b=this;return b.reset(),b.running=!0,a||(a={}),R(b,{name:"run",args:a,queued:a.queued,onStart:function(a){b.emit(a)},onCycle:function(a){var c=a.target;c.error&&b.emit({type:"error",target:c}),b.emit(a),a.aborted=b.aborted},onComplete:function(a){b.running=!1,b.emit(a)}}),b}function ab(a){var b,c=this,d=e(a),f=c.events,g=(arguments[0]=d,arguments);return d.currentTarget||(d.currentTarget=c),d.target||(d.target=c),delete d.result,f&&(b=O(f,d.type)&&f[d.type])&&L(b.slice(),function(a){return(d.result=a.apply(c,g))===!1&&(d.cancelled=!0),!d.aborted}),d.result}function bb(a){var b=this,c=b.events||(b.events={});return O(c,a)?c[a]:c[a]=[]}function cb(a,b){var c=this,d=c.events;return d&&I(a?a.split(" "):d,function(a,c){var e;"string"==typeof a&&(c=a,a=O(d,c)&&d[c]),a&&(b?(e=P(a,b),e>-1&&a.splice(e,1)):a.length=0)}),c}function db(a,b){var c=this,d=c.events||(c.events={});return L(a.split(" "),function(a){(O(d,a)?d[a]:d[a]=[]).push(b)}),c}function eb(){var a,b=this,c=Fb.reset;return b.running&&(a=e("abort"),b.emit(a),(!a.cancelled||c)&&(Fb.abort=!0,b.reset(),delete Fb.abort,Jb.timeout&&(clearTimeout(b._timerId),delete b._timerId),c||(b.aborted=!0,b.running=!1))),b}function fb(a){var b=this,c=new b.constructor(J({},b,a));return c.options=J({},b.options,a),M(b,function(a,b){O(c,b)||(c[b]=H(a))}),c}function gb(a){function b(a,b){return V(b,function(b,c){return b+(c>a?0:a>c?1:.5)},0)}function c(a,c){return V(a,function(a,d){return a+b(d,c)},0)}function d(a){return(a-j*k/2)/Tb(j*k*(j+k+1)/12)}var e,f,g=this,h=g.stats.sample,i=a.stats.sample,j=h.length,k=i.length,l=Qb(j,k),m=Rb(j,k),n=c(h,i),o=c(i,h),p=Rb(n,o);return g==a?0:j+k>30?(f=d(p),Ob(f)>1.96?f>0?-1:1:0):(e=5>l||3>m?0:Ib[l][m-3],e>=p?p==n?1:-1:0)}function hb(){var a,b,c=this,d=0,f={length:0},g={length:0};if(c.running&&!Fb.abort)Fb.reset=!0,c.abort(),delete Fb.reset;else{a={destination:c,source:J({},c.constructor.prototype,c.options)};do M(a.source,function(b,c){var d,e=a.destination,h=e[c];b&&"object"==typeof b?(x(b,"Array")?(x(h,"Array")||(d=h=[]),h.length!=b.length&&(d=h=h.slice(0,b.length),h.length=b.length)):h&&"object"==typeof h||(d=h={}),d&&(f[f.length++]={destination:e,key:c,value:h}),g[g.length++]={destination:h,source:b}):b===h||null==b||x(b,"Function")||(f[f.length++]={destination:e,key:c,value:b})});while(a=g[d++]);f.length&&(c.emit(b=e("reset")),!b.cancelled)&&L(f,function(a){a.destination[a.key]=a.value})}return c}function ib(){var a=this,b=a.error,c=a.hz,d=a.id,e=a.stats,f=e.sample.length,g=Jb.java?"+/-":"Â±",h=a.name||(isNaN(d)?d:"<Test #"+d+">");return h+=b?": "+S(b):" x "+N(c.toFixed(100>c?2:0))+" ops/sec "+g+e.rme.toFixed(2)+"% ("+f+" run"+(1==f?"":"s")+" sampled)"}function jb(){function b(a){for(var b,c,d=30,e=1e3,f=Kb.ns,g=[];d--;){if("us"==a)if(e=1e6,f.stop)for(f.start();!(b=f.microseconds()););else if(f[yb])e=1e3,b=Function("n","var r,s=n."+yb+"();while(!(r=n."+yb+"()-s)){};return r")(f);else for(c=f();!(b=f()-c););else if("ns"==a)if(e=1e9,f.nanoTime)for(c=f.nanoTime();!(b=f.nanoTime()-c););else{for(c=(c=f())[0]+c[1]/e;!(b=(b=f())[0]+b[1]/e-c););e=1}else for(c=new f;!(b=new f-c););if(!(b>0)){g.push(1/0);break}g.push(b)}return u(g)/e}function e(a){return Q(a,h).replace(/\$/g,/\d+/.exec(Eb))}var f,g=c.options,h={begin:"s$=new n$",end:"r$=(new n$-s$)/1e3",uid:Eb},i=[{ns:Kb.ns,res:Qb(.0015,b("ms")),unit:"ms"}];jb=function(a){var b;a instanceof d&&(b=a,a=b.benchmark);var c=a._original,h=c.fn,i=b?t(h)||"deferred":"",j=A(h),k={setup:v(c.setup,e("m$.setup()")),fn:v(h,e("m$.fn("+i+")")),fnArg:i,teardown:v(c.teardown,e("m$.teardown()"))},l=c.count=a.count,m=Jb.decompilation||j,n=c.id,o=!(k.fn||j),q=c.name||("number"==typeof n?"<Test #"+n+">":n),r=Kb.ns,s=0;if(a.minTime=c.minTime||(c.minTime=c.options.minTime=g.minTime),f)try{r.nanoTime()}catch(u){r=Kb.ns=new f.Packages.nano}var w=c.compiled=p(e("t$"),Q(e(b?'var d$=this,#{fnArg}=d$,m$=d$.benchmark._original,f$=m$.fn,su$=m$.setup,td$=m$.teardown;if(!d$.cycles){d$.fn=function(){var #{fnArg}=d$;if(typeof f$=="function"){try{#{fn}\n}catch(e$){f$(d$)}}else{#{fn}\n}};d$.teardown=function(){d$.cycles=0;if(typeof td$=="function"){try{#{teardown}\n}catch(e$){td$()}}else{#{teardown}\n}};if(typeof su$=="function"){try{#{setup}\n}catch(e$){su$()}}else{#{setup}\n};t$.start(d$);}d$.fn();return{}':'var r$,s$,m$=this,f$=m$.fn,i$=m$.count,n$=t$.ns;#{setup}\n#{begin};while(i$--){#{fn}\n}#{end};#{teardown}\nreturn{elapsed:r$,uid:"#{uid}"}'),k));try{if(o)throw new Error('The test "'+q+'" is empty. This may be the result of dead code removal.');b||(c.count=1,w=(w.call(c,Kb)||{}).uid==Eb&&w,c.count=l)}catch(u){w=null,a.error=u||new Error(String(u)),c.count=l}if(m&&!w&&!b&&!o){w=p(e("t$"),Q(e((a.error&&!j?"var r$,s$,m$=this,f$=m$.fn,i$=m$.count":"function f$(){#{fn}\n}var r$,s$,m$=this,i$=m$.count")+",n$=t$.ns;#{setup}\n#{begin};m$.f$=f$;while(i$--){m$.f$()}#{end};delete m$.f$;#{teardown}\nreturn{elapsed:r$}"),k));try{c.count=1,w.call(c,Kb),c.compiled=w,c.count=l,delete a.error}catch(u){c.count=l,a.error?w=null:(c.compiled=w,a.error=u||new Error(String(u)))}}return a.compiled=w,a.error||(s=w.call(b||c,Kb).elapsed),s},I(ob&&ob.applets||[],function(a){return!(Kb.ns=f="nanoTime"in a&&a)});try{"number"==typeof Kb.ns.nanoTime()&&i.push({ns:Kb.ns,res:b("ns"),unit:"ns"})}catch(j){}try{(Kb.ns=new(a.chrome||a.chromium).Interval)&&i.push({ns:Kb.ns,res:b("us"),unit:"us"})}catch(j){}if((Kb.ns=yb&&xb)&&i.push({ns:Kb.ns,res:b("us"),unit:"us"}),zb&&"function"==typeof(Kb.ns=zb.hrtime)&&i.push({ns:Kb.ns,res:b("ns"),unit:"ns"}),wb&&"function"==typeof(Kb.ns=wb.now)&&i.push({ns:Kb.ns,res:b("us"),unit:"us"}),Kb=V(i,function(a,b){return b.res<a.res?b:a}),"ns"!=Kb.unit&&f&&(f=r(f)),1/0==Kb.res)throw new Error("Benchmark.js was unable to find a working timer.");return"ns"==Kb.unit?Kb.ns.nanoTime?J(h,{begin:"s$=n$.nanoTime()",end:"r$=(n$.nanoTime()-s$)/1e9"}):J(h,{begin:"s$=n$()",end:"r$=n$(s$);r$=r$[0]+(r$[1]/1e9)"}):"us"==Kb.unit&&(Kb.ns.stop?J(h,{begin:"s$=n$.start()",end:"r$=n$.microseconds()/1e6"}):yb?J(h,{begin:"s$=n$."+yb+"()",end:"r$=(n$."+yb+"()-s$)/1e3"}):J(h,{begin:"s$=n$()",end:"r$=(n$()-s$)/1e6"})),Kb.start=p(e("o$"),e("var n$=this.ns,#{begin};o$.elapsed=0;o$.timeStamp=s$")),Kb.stop=p(e("o$"),e("var n$=this.ns,s$=o$.timeStamp,#{end};o$.elapsed=r$")),g.minTime||(g.minTime=Qb(Kb.res/2/.01,.05)),jb.apply(null,arguments)}function kb(a,b){function c(){j.push(a.clone({_original:a,events:{abort:[d],cycle:[d],error:[d],start:[d]}}))}function d(b){var c=this,d=b.type;a.running?"start"==d?c.count=a.initCount:("error"==d&&(a.error=c.error),"abort"==d?(a.abort(),a.emit("cycle")):(b.currentTarget=b.target=a,a.emit(b))):a.aborted&&(c.events.abort.length=0,c.abort())}function e(b){var d,e,f,l,m,n,o,p,q=b.target,r=a.aborted,s=+new Date,t=k.push(q.times.period),v=t>=i&&(g+=s-q.times.timeStamp)/1e3>a.maxTime,w=a.times,x=function(a,b){return a+Sb(b-f,2)};(r||1/0==q.hz)&&(v=!(t=k.length=j.length=0)),r||(f=u(k),p=V(k,x,0)/(t-1)||0,n=Tb(p),o=n/Tb(t),e=t-1,d=Hb[Math.round(e)||1]||Hb.infinity,l=o*d,m=100*(l/f)||0,J(a.stats,{deviation:n,mean:f,moe:l,rme:m,sem:o,variance:p}),v&&(a.initCount=h,a.running=!1,r=!0,w.elapsed=(s-w.timeStamp)/1e3),1/0!=a.hz&&(a.hz=1/f,w.cycle=f*a.count,w.period=f)),j.length<2&&!v&&c(),b.aborted=r}b||(b={});var f=b.async,g=0,h=a.initCount,i=a.minSamples,j=[],k=a.stats.sample;c(),R(j,{name:"run",args:{async:f},queued:!0,onCycle:e,onComplete:function(){a.emit("complete")}})}function lb(a,b){b||(b={});var c;a instanceof d&&(c=a,a=a.benchmark);var f,g,h,i,j,k,l=b.async,m=a._original,n=a.count,o=a.times;a.running&&(g=++a.cycles,f=c?c.elapsed:jb(a),j=a.minTime,g>m.cycles&&(m.cycles=g),a.error&&(i=e("error"),i.message=a.error,a.emit(i),i.cancelled||a.abort())),a.running&&(m.times.cycle=o.cycle=f,k=m.times.period=o.period=f/n,m.hz=a.hz=1/k,m.initCount=a.initCount=n,a.running=j>f,a.running&&(f||null==(h=Gb[a.cycles])||(n=Pb(4e6/h)),n<=a.count&&(n+=Math.ceil((j-f)/k)),a.running=1/0!=n)),i=e("cycle"),a.emit(i),i.aborted&&a.abort(),a.running?(a.count=n,c?a.compiled.call(c,Kb):l?q(a,function(){lb(a,b)}):lb(a)):(Jb.browser&&E(Eb+"=1;delete "+Eb),a.emit("complete"))}function mb(a){var b=this,c=e("start");return b.running=!1,b.reset(),b.running=!0,b.count=b.initCount,b.times.timeStamp=+new Date,b.emit(c),c.cancelled||(a={async:(null==(a=a&&a.async)?b.async:a)&&Jb.timeout},b._original?b.defer?d(b):lb(b,a):kb(b,a)),b}var nb=0,ob=y(a,"document")&&document,pb="function"==typeof define&&"object"==typeof define.amd&&define.amd&&define,qb="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&(a=global),exports),rb="function"==typeof require&&require,sb=Object.getOwnPropertyNames,tb=Object.getOwnPropertyDescriptor,ub={}.hasOwnProperty,vb=Object.isExtensible||function(){return!0},wb=D("microtime"),xb=y(a,"performance")&&performance,yb=xb&&(xb.now&&"now"||xb.webkitNow&&"webkitNow"),zb=y(a,"process")&&process,Ab={}.propertyIsEnumerable,Bb=Object.defineProperty,Cb={}.toString,Db=ob&&ob.createElement("div"),Eb="uid"+ +new Date,Fb={},Gb={1:4096,2:512,3:64,4:8,5:0},Hb={1:12.706,2:4.303,3:3.182,4:2.776,5:2.571,6:2.447,7:2.365,8:2.306,9:2.262,10:2.228,11:2.201,12:2.179,13:2.16,14:2.145,15:2.131,16:2.12,17:2.11,18:2.101,19:2.093,20:2.086,21:2.08,22:2.074,23:2.069,24:2.064,25:2.06,26:2.056,27:2.052,28:2.048,29:2.045,30:2.042,infinity:1.96},Ib={5:[0,1,2],6:[1,2,3,5],7:[1,3,5,6,8],8:[2,4,6,8,10,13],9:[2,4,7,10,12,15,17],10:[3,5,8,11,14,17,20,23],11:[3,6,9,13,16,19,23,26,30],12:[4,7,11,14,18,22,26,29,33,37],13:[4,8,12,16,20,24,28,33,37,41,45],14:[5,9,13,17,22,26,31,36,40,45,50,55],15:[5,10,14,19,24,29,34,39,44,49,54,59,64],16:[6,11,15,21,26,31,37,42,47,53,59,64,70,75],17:[6,11,17,22,28,34,39,45,51,57,63,67,75,81,87],18:[7,12,18,24,30,36,42,48,55,61,67,74,80,86,93,99],19:[7,13,19,25,32,38,45,52,58,65,72,78,85,92,99,106,113],20:[8,14,20,27,34,41,48,55,62,69,76,83,90,98,105,112,119,127],21:[8,15,22,29,36,43,50,58,65,73,80,88,96,103,111,119,126,134,142],22:[9,16,23,30,38,45,53,61,69,77,85,93,101,109,117,125,133,141,150,158],23:[9,17,24,32,40,48,56,64,73,81,89,98,106,115,123,132,140,149,157,166,175],24:[10,17,25,33,42,50,59,67,76,85,94,102,111,120,129,138,147,156,165,174,183,192],25:[10,18,27,35,44,53,62,71,80,89,98,107,117,126,135,145,154,163,173,182,192,201,211],26:[11,19,28,37,46,55,64,74,83,93,102,112,122,132,141,151,161,171,181,191,200,210,220,230],27:[11,20,29,38,48,57,67,77,87,97,107,118,125,138,147,158,168,178,188,199,209,219,230,240,250],28:[12,21,30,40,50,60,70,80,90,101,111,122,132,143,154,164,175,186,196,207,218,228,239,250,261,272],29:[13,22,32,42,52,62,73,83,94,105,116,127,138,149,160,171,182,193,204,215,226,238,249,260,271,282,294],30:[13,23,33,43,54,65,76,87,98,109,120,131,143,154,166,177,189,200,212,223,235,247,258,270,282,293,305,317]},Jb={};!function(){Jb.air=x(a.runtime,"ScriptBridgingProxyObject"),Jb.argumentsClass=x(arguments,"Arguments"),Jb.browser=ob&&y(a,"navigator"),Jb.charByIndex="xx"=="x"[0]+Object("x")[0],Jb.charByOwnIndex=Jb.charByIndex&&O("x","0"),Jb.java=x(a.java,"JavaPackage"),Jb.timeout=y(a,"setTimeout")&&y(a,"clearTimeout");try{Jb.decompilation="1"===Function("return ("+function(a){return{x:""+(1+a),y:0}}+")")()(0).x}catch(b){Jb.decompilation=!1}try{var c={};Jb.descriptors=(Bb(c,c,c),"value"in tb(c,c))}catch(b){Jb.descriptors=!1}try{Jb.getAllKeys=/\bvalueOf\b/.test(sb(Object.prototype))}catch(b){Jb.getAllKeys=!1}Jb.iteratesOwnFirst=function(){function a(){this.x=1}var b=[];a.prototype={y:1};for(var c in new a)b.push(c);return"x"==b[0]}();try{Jb.nodeClass="[object Object]"!=Cb.call(ob||0)}catch(b){Jb.nodeClass=!0}}();var Kb={ns:Date,start:null,stop:null},Lb=!Jb.argumentsClass,Mb=!Jb.charByIndex,Nb=!Jb.charByOwnIndex,Ob=Math.abs,Pb=Math.floor,Qb=Math.max,Rb=Math.min,Sb=Math.pow,Tb=Math.sqrt;J(c,{options:{async:!1,defer:!1,delay:.005,id:b,initCount:1,maxTime:5,minSamples:5,minTime:0,name:b,onAbort:b,onComplete:b,onCycle:b,onError:b,onReset:b,onStart:b},platform:D("platform")||a.platform||{description:a.navigator&&navigator.userAgent||null,layout:null,product:null,name:null,manufacturer:null,os:null,prerelease:null,version:null,toString:function(){return this.description||""}},version:"1.0.0",support:Jb,deepClone:H,each:I,extend:J,filter:K,forEach:L,forOwn:M,formatNumber:N,hasKey:(O(c,""),O),indexOf:P,interpolate:Q,invoke:R,join:S,map:T,pluck:U,reduce:V}),J(c.prototype,{count:0,cycles:0,hz:0,compiled:b,error:b,fn:b,aborted:!1,running:!1,setup:C,teardown:C,stats:{moe:0,rme:0,sem:0,deviation:0,mean:0,sample:[],variance:0},times:{cycle:0,elapsed:0,period:0,timeStamp:0},abort:eb,clone:fb,compare:gb,emit:ab,listeners:bb,off:cb,on:db,reset:hb,run:mb,toString:ib}),J(d.prototype,{benchmark:null,cycles:0,elapsed:0,timeStamp:0,resolve:G}),J(e.prototype,{aborted:!1,cancelled:!1,currentTarget:b,result:b,target:b,timeStamp:0,type:""}),f.options={name:b},J(f.prototype,{length:0,aborted:!1,running:!1,forEach:B(L),indexOf:B(P),invoke:B(R),join:[].join,map:B(T),pluck:B(U),pop:[].pop,push:[].push,sort:[].sort,reduce:B(V),abort:W,add:X,clone:Y,emit:ab,filter:Z,listeners:bb,off:cb,on:db,reset:$,run:_,concat:g,reverse:i,shift:j,slice:k,splice:l,unshift:n}),J(c,{Deferred:d,Event:e,Suite:f}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return c}):qb?"object"==typeof module&&module&&module.exports==qb?(module.exports=c).Benchmark=c:qb.Benchmark=c:a.Benchmark=c,Jb.air&&jb({_original:{fn:C,count:1,options:{}}})}(this),Date.$VERSION=1.02,Date.LZ=function(a){return(0>a||a>9?"":"0")+a},Date.monthNames=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),Date.monthAbbreviations=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),Date.monthAbbrevToNum={Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},Date.dayNames=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),Date.dayAbbreviations=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat"),Date.preferAmericanFormat=!0,Date.firstDayOfWeek=0,Date.defaultFormat="dd/MM/yyyy",Date.prototype.getFullYear||(Date.prototype.getFullYear=function(){var a=this.getYear();return 1900>a?a+1900:a}),Date.parseString=function(a,b){if("undefined"==typeof b||null==b||""==b){for(var c=new Array(Date.defaultFormat,"y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d","MMM-d","d-MMM"),d=new Array("M/d/y","M-d-y","M.d.y","M/d","M-d"),e=new Array("d/M/y","d-M-y","d.M.y","d/M","d-M"),f=new Array(c,Date.preferAmericanFormat?d:e,Date.preferAmericanFormat?e:d),g=0;g<f.length;g++)for(var h=f[g],i=0;i<h.length;i++){var j=Date.parseString(a,h[i]);if(null!=j)return j}return null}this.isInteger=function(a){for(var b=0;b<a.length;b++)if(-1=="1234567890".indexOf(a.charAt(b)))return!1;return!0},this.getInt=function(a,b,c,d){for(var e=d;e>=c;e--){var f=a.substring(b,b+e);if(f.length<c)return null;if(this.isInteger(f))return f}return null},this.decodeShortcut=function(a){var b=a.trim().toUpperCase(),c=new Date;if(c.clearTime(),["NOW","N"].indexOf(b)>=0)c=new Date;else if(["TODAY","T"].indexOf(b)>=0);else if(["YESTERDAY","Y"].indexOf(b)>=0)c.setDate(c.getDate()-1);else if(["TOMORROW","TO"].indexOf(b)>=0)c.setDate(c.getDate()+1);else if(["W","TW","WEEK","THISWEEK","WEEKSTART","THISWEEKSTART"].indexOf(b)>=0)c.setFirstDayOfThisWeek();else if(["LW","LASTWEEK","LASTWEEKSTART"].indexOf(b)>=0)c.setFirstDayOfThisWeek(),c.setDate(c.getDate()-7);else if(["NW","NEXTWEEK","NEXTWEEKSTART"].indexOf(b)>=0)c.setFirstDayOfThisWeek(),c.setDate(c.getDate()+7);else if(["M","TM","MONTH","THISMONTH","MONTHSTART","THISMONTHSTART"].indexOf(b)>=0)c.setDate(1);else if(["LM","LASTMONTH","LASTMONTHSTART"].indexOf(b)>=0)c.setDate(1),c.setMonth(c.getMonth()-1);else if(["NM","NEXTMONTH","NEXTMONTHSTART"].indexOf(b)>=0)c.setDate(1),c.setMonth(c.getMonth()+1);else if(["Q","TQ","QUARTER","THISQUARTER","QUARTERSTART","THISQUARTERSTART"].indexOf(b)>=0)c.setDate(1),c.setMonth(3*Math.floor(c.getMonth()/3));else if(["LQ","LASTQUARTER","LASTQUARTERSTART"].indexOf(b)>=0)c.setDate(1),c.setMonth(3*Math.floor(c.getMonth()/3)-3);else if(["NQ","NEXTQUARTER","NEXTQUARTERSTART"].indexOf(b)>=0)c.setDate(1),c.setMonth(3*Math.floor(c.getMonth()/3)+3);else if(/^-?[0-9]+[DWMY]$/.test(b)){var d=b.substr(b.length-1),e=parseInt(b.substr(0,b.length-1));"W"==d?c.setDate(c.getDate()+7*e):"M"==d?c.setMonth(c.getMonth()+e):"Y"==d&&c.setYear(c.getYear()+e)}else c=void 0;return c};var k=this.decodeShortcut(a);if(k)return k;a+="",b+="";for(var l,m,n=0,o=0,p="",q="",r=(new Date).getFullYear(),s=1,t=1,u=0,v=0,w=0,x="";o<b.length;){for(p=b.charAt(o),q="";b.charAt(o)==p&&o<b.length;)q+=b.charAt(o++);if("yyyy"==q||"yy"==q||"y"==q){if("yyyy"==q&&(l=4,m=4),"yy"==q&&(l=2,m=2),"y"==q&&(l=2,m=4),r=this.getInt(a,n,l,m),null==r)return null;
n+=r.length,2==r.length&&(r=r>70?1900+(r-0):2e3+(r-0))}else if("MMM"==q||"MMMM"==q){s=0;for(var y="MMMM"==q?Date.monthNames.concat(Date.monthAbbreviations):Date.monthAbbreviations,g=0;g<y.length;g++){var z=y[g];if(a.substring(n,n+z.length).toLowerCase()==z.toLowerCase()){s=g%12+1,n+=z.length;break}}if(1>s||s>12)return null}else if("E"==q||"EE"==q||"EEE"==q||"EEEE"==q)for(var y="EEEE"==q?Date.dayNames:Date.dayAbbreviations,g=0;g<y.length;g++){var A=y[g];if(a.substring(n,n+A.length).toLowerCase()==A.toLowerCase()){n+=A.length;break}}else if("MM"==q||"M"==q){if(s=this.getInt(a,n,q.length,2),null==s||1>s||s>12)return null;n+=s.length}else if("dd"==q||"d"==q){if(t=this.getInt(a,n,q.length,2),null==t||1>t||t>31)return null;n+=t.length}else if("hh"==q||"h"==q){if(u=this.getInt(a,n,q.length,2),null==u||1>u||u>12)return null;n+=u.length}else if("HH"==q||"H"==q){if(u=this.getInt(a,n,q.length,2),null==u||0>u||u>23)return null;n+=u.length}else if("KK"==q||"K"==q){if(u=this.getInt(a,n,q.length,2),null==u||0>u||u>11)return null;n+=u.length,u++}else if("kk"==q||"k"==q){if(u=this.getInt(a,n,q.length,2),null==u||1>u||u>24)return null;n+=u.length,u--}else if("mm"==q||"m"==q){if(v=this.getInt(a,n,q.length,2),null==v||0>v||v>59)return null;n+=v.length}else if("ss"==q||"s"==q){if(w=this.getInt(a,n,q.length,2),null==w||0>w||w>59)return null;n+=w.length}else if("a"==q){if("am"==a.substring(n,n+2).toLowerCase())x="AM";else{if("pm"!=a.substring(n,n+2).toLowerCase())return null;x="PM"}n+=2}else{if(a.substring(n,n+q.length)!=q)return null;n+=q.length}}if(n!=a.length)return null;if(2==s)if(0==r%4&&0!=r%100||0==r%400){if(t>29)return null}else if(t>28)return null;return(4==s||6==s||9==s||11==s)&&t>30?null:(12>u&&"PM"==x?u=u-0+12:u>11&&"AM"==x&&(u-=12),new Date(r,s-1,t,u,v,w))},Date.isValid=function(a,b){return null!=Date.parseString(a,b)},Date.prototype.isBefore=function(a){return null==a?!1:this.getTime()<a.getTime()},Date.prototype.isAfter=function(a){return null==a?!1:this.getTime()>a.getTime()},Date.prototype.equals=function(a){return null==a?!1:this.getTime()==a.getTime()},Date.prototype.equalsIgnoreTime=function(a){if(null==a)return!1;var b=new Date(this.getTime()).clearTime(),c=new Date(a.getTime()).clearTime();return b.getTime()==c.getTime()},Date.prototype.format=function(a){a||(a=Date.defaultFormat),a+="";var b="",c=0,d="",e="",f=this.getFullYear()+"",g=this.getMonth()+1,h=this.getDate(),i=this.getDay(),j=this.getHours(),k=this.getMinutes(),l=this.getSeconds(),m=new Object;for(f.length<4&&(f=""+(+f+1900)),m.y=""+f,m.yyyy=f,m.yy=f.substring(2,4),m.M=g,m.MM=Date.LZ(g),m.MMM=Date.monthAbbreviations[g-1],m.MMMM=Date.monthNames[g-1],m.d=h,m.dd=Date.LZ(h),m.E=Date.dayAbbreviations[i],m.EE=Date.dayAbbreviations[i],m.EEE=Date.dayAbbreviations[i],m.EEEE=Date.dayNames[i],m.H=j,m.HH=Date.LZ(j),m.h=0==j?12:j>12?j-12:j,m.hh=Date.LZ(m.h),m.K=m.h-1,m.k=m.H+1,m.KK=Date.LZ(m.K),m.kk=Date.LZ(m.k),m.a=j>11?"PM":"AM",m.m=k,m.mm=Date.LZ(k),m.s=l,m.ss=Date.LZ(l);c<a.length;){for(d=a.charAt(c),e="";a.charAt(c)==d&&c<a.length;)e+=a.charAt(c++);b+="undefined"!=typeof m[e]?m[e]:e}return b},Date.prototype.getDayName=function(){return Date.dayNames[this.getDay()]},Date.prototype.getDayAbbreviation=function(){return Date.dayAbbreviations[this.getDay()]},Date.prototype.getMonthName=function(){return Date.monthNames[this.getMonth()]},Date.prototype.getMonthAbbreviation=function(){return Date.monthAbbreviations[this.getMonth()]},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.add=function(a,b){if("undefined"==typeof a||null==a||"undefined"==typeof b||null==b)return this;if(b=+b,"y"==a)this.setFullYear(this.getFullYear()+b);else if("M"==a)this.setMonth(this.getMonth()+b);else if("d"==a)this.setDate(this.getDate()+b);else if("w"==a)for(var c=b>0?1:-1;0!=b;){for(this.add("d",c);0==this.getDay()||6==this.getDay();)this.add("d",c);b-=c}else"h"==a?this.setHours(this.getHours()+b):"m"==a?this.setMinutes(this.getMinutes()+b):"s"==a&&this.setSeconds(this.getSeconds()+b);return this},Date.prototype.toInt=function(){return 1e4*this.getFullYear()+100*(this.getMonth()+1)+this.getDate()},Date.fromInt=function(a){var b=parseInt(a/1e4),c=parseInt((a-1e4*b)/100),d=parseInt(a-1e4*b-100*c);return new Date(b,c-1,d,12,0,0)},Date.prototype.isHoliday=function(){return isHoliday(this)},Date.prototype.isToday=function(){return this.toInt()==(new Date).toInt()},Date.prototype.incrementDateByWorkingDays=function(a){for(var b=Math.abs(a);b>0;)this.setDate(this.getDate()+(a>0?1:-1)),this.isHoliday()||b--;return this},Date.prototype.distanceInWorkingDays=function(a){var b=new Date(this.getTime());b.setHours(23,59,59,999);var c=0,d=new Date(a.getTime());d.setHours(23,59,59,999);for(var e=d.getTime();b.getTime()<=e;)c+=isHoliday(b)?0:1,b.setDate(b.getDate()+1);return c},Date.prototype.setFirstDayOfThisWeek=function(a){a||(a=Date.firstDayOfWeek),this.setDate(this.getDate()-this.getDay()+a-(0==this.getDay()&&0!=a?7:0))},Date.prototype.msPERDAY=864e5,Date.prototype.getDaysBetween=function(a){a=a.copy(),a.setHours(this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());var b=a.getTime()-this.getTime();return b/this.msPERDAY},Date.prototype.getDayOfYear=function(){var a=new Date(this.getFullYear(),0,0);return-1*this.getDaysBetween(a)},Date.prototype.addDays=function(a){this.setDate(this.getDate()+a)},Date.prototype.addWeeks=function(a){this.addDays(7*a)},Date.prototype.addMonths=function(a){var b=this.getDate();this.setMonth(this.getMonth()+a),this.getDate()<b&&this.setDate(0)},Date.prototype.addYears=function(a){var b=this.getMonth();this.setFullYear(this.getFullYear()+a),b<this.getMonth()&&this.setDate(0)},Date.prototype.getMonthsBetween=function(a){var b,c,d,e=12*this.getFullYear()+this.getMonth(),f=12*a.getFullYear()+a.getMonth(),g=0;if(this==a)g=0;else if(e==f)g=(a.getDate()-this.getDate())/this.lastday();else{f>e?(b=this,c=a,d=1):(b=a,c=this,d=-1);var h=b.lastday()-b.getDate(),i=c.getDate(),j=(h+i)/b.lastday()-1;g=Math.abs(f-e)+j,g*=d}return g},Date.prototype.adjust=function(a,b){a=a.toLowerCase();var c={years:"FullYear",months:"Month",weeks:"Hours",days:"Hours",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds",utcyears:"UTCFullYear",utcmonths:"UTCMonth",weeks:"UTCHours",utcdays:"UTCHours",utchours:"UTCHours",utcminutes:"UTCMinutes",utcseconds:"UTCSeconds",utcmilliseconds:"UTCMilliseconds"},d=c[a];return("weeks"==a||"utcweeks"==a)&&(b*=168),("days"==a||"utcdays"==a)&&(b*=24),this["set"+d](this["get"+d]()+b),this},Date.prototype.each=function(a,b,c,d,e){for(var f=new Date(this.getTime()),g=new Date(a.getTime()),h=g>=f?1:-1,i=0;(1===h&&g>=f||-1===h&&f>=g)&&d.call(e,f,i,this)!==!1;)i+=c,f.adjust(b,c*h);return this},Date.prototype.daysInMonth=function(){var a=new Date(this.getFullYear(),this.getMonth()+1,0);return a.getDate()},Date.prototype.getFirstDayOfNextMonth=function(){var a=new Date;return a.setTime(this.getTime()),a.addMonths(1),a.setDate(1),a},Date.prototype.getLastDayOfMonth=function(){var a=new Date(this.getFullYear(),this.getMonth());return a.setDate(this.daysInMonth()),a},Date.prototype.getLastDayOfYear=function(){var a=new Date(this.getFullYear(),this.getMonth());return a.setMonth(12),a.setDate(31),a},Date.dateDiff=function(a,b){a/=1e3,b/=1e3,a>b&&(b=[a,a=b][0]);var c={year:0,month:0,day:0,hour:0,minute:0,second:0};return $.each(c,function(d){for(;b>=(d3=Date.strtotime("+1 "+d,a));)a=d3,++c[d]}),c},Date.strtotime=function(a,b){function c(a,b,c){var d,e=i[b];"undefined"!=typeof e&&(d=e-h.getDay(),0===d?d=7*c:d>0&&"last"===a?d-=7:0>d&&"next"===a&&(d+=7),h.setDate(h.getDate()+d))}function d(a){var b=a.split(" "),d=b[0],e=b[1].substring(0,3),f=/\d+/.test(d),g="ago"===b[2],i=("last"===d?-1:1)*(g?-1:1);if(f&&(i*=parseInt(d,10)),j.hasOwnProperty(e)&&!b[1].match(/^mon(day|\.)?$/i))return h["set"+j[e]](h["get"+j[e]]()+i);if("wee"===e)return h.setDate(h.getDate()+7*i);if("next"===d||"last"===d)c(d,e,i);else if(!f)return!1;return!0}var e,f,g,h,i,j,k,l,m,n;if(!a)return null;if(a=a.trim().replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase(),"now"===a)return null===b||isNaN(b)?0|(new Date).getTime()/1e3:0|b;if(!isNaN(e=Date.parse(a)))return 0|e/1e3;if("now"===a)return(new Date).getTime()/1e3;if(!isNaN(e=Date.parse(a)))return e/1e3;if(f=a.match(/^(\d{2,4})-(\d{2})-(\d{2})(?:\s(\d{1,2}):(\d{2})(?::\d{2})?)?(?:\.(\d+)?)?$/))return g=f[1]>=0&&f[1]<=69?+f[1]+2e3:f[1],new Date(g,parseInt(f[2],10)-1,f[3],f[4]||0,f[5]||0,f[6]||0,f[7]||0)/1e3;if(h=b?new Date(1e3*b):new Date,i={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},j={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"},l="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)",m="([+-]?\\d+\\s"+l+"|(last|next)\\s"+l+")(\\sago)?",f=a.match(new RegExp(m,"gi")),!f)return!1;for(n=0,k=f.length;k>n;n++)if(!d(f[n]))return!1;return h.getTime()/1e3},window.objPHPDate||(window.objPHPDate={aDay:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],aShortDay:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],aLetterDay:["S","M","T","W","T","F","S"],aMonth:["January","February","March","April","May","June","July","August","September","October","November","December"],aShortMonth:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],aSuffix:["th","st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],sTimezoneOffset:"",GetTimezoneOffset:function(){var a=new Date;a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0);var b=new Date;b.setMilliseconds(a.getUTCMilliseconds()),b.setSeconds(a.getUTCSeconds()),b.setMinutes(a.getUTCMinutes()),b.setHours(a.getUTCHours()),b.setDate(a.getUTCDate()),b.setMonth(a.getUTCMonth()),b.setFullYear(a.getUTCFullYear()),this.sTimezoneOffset=(a.getTime()-b.getTime())/36e5;var c=this.sTimezoneOffset<0;return this.sTimezoneOffset=c?(this.sTimezoneOffset+"").substring(1):this.sTimezoneOffset+"",this.sTimezoneOffset=this.sTimezoneOffset.replace(/\.5/,60*parseInt("$1",10)+""),this.sTimezoneOffset+=":30"!=this.sTimezoneOffset.substring(this.sTimezoneOffset.length-3)?":00":"",this.sTimezoneOffset=1==this.sTimezoneOffset.substr(0,this.sTimezoneOffset.indexOf(":")).length?"0"+this.sTimezoneOffset:this.sTimezoneOffset,this.sTimezoneOffset=c?"-"+this.sTimezoneOffset:"+"+this.sTimezoneOffset,delete a,delete b,!0},PHPDate:function(){var a=arguments.length>0?arguments[0]:"",b=this.getFullYear(),c=b+"",d=this.getMonth(),e=d+1+"",f=1==e.length?"0"+e:e,g=this.getDate(),h=g+"",i=1==h.length?"0"+h:h,j=this.getDay(),k=this.getHours(),l=k%12+"";"0"==l&&(l="12");var m=1==l.length?"0"+l:l,n=k+"",o=1==n.length?"0"+n:n,p=this.getMinutes()+"";1==p.length&&(p="0"+p);var q=this.getMinutes()+"";1==q.length&&(q="0"+q);var r=this.getHours()<12?"am":"pm";return a=a.replace(/([AacDdFGgHhijLlMmNnrSsUwYy])/g,"y5-cal-regexp:$1"),a=a.replace(/y5-cal-regexp:A/g,r.toUpperCase()),a=a.replace(/y5-cal-regexp:a/g,r),a=a.replace(/y5-cal-regexp:c/g,c+"-"+f+"-"+i+"T00:00:00"+objPHPDate.sTimezoneOffset),a=a.replace(/y5-cal-regexp:D/g,objPHPDate.aShortDay[j]),a=a.replace(/y5-cal-regexp:d/g,i),a=a.replace(/y5-cal-regexp:F/g,objPHPDate.aMonth[d]),a=a.replace(/y5-cal-regexp:G/g,n),a=a.replace(/y5-cal-regexp:g/g,l),a=a.replace(/y5-cal-regexp:H/g,o),a=a.replace(/y5-cal-regexp:h/g,m),a=a.replace(/y5-cal-regexp:i/g,p),a=a.replace(/y5-cal-regexp:j/g,g),a=a.replace(/y5-cal-regexp:L/g,objPHPDate.aLetterDay[j]),a=a.replace(/y5-cal-regexp:l/g,objPHPDate.aDay[j]),a=a.replace(/y5-cal-regexp:M/g,objPHPDate.aShortMonth[d]),a=a.replace(/y5-cal-regexp:m/g,f),a=a.replace(/y5-cal-regexp:N/g,0==j?7:j),a=a.replace(/y5-cal-regexp:n/g,e),a=a.replace(/y5-cal-regexp:r/g,objPHPDate.aShortDay[j]+", "+i+" "+objPHPDate.aShortMonth[d]+" "+c+" 00:00:00 "+objPHPDate.sTimezoneOffset.replace(/:/,"")),a=a.replace(/y5-cal-regexp:S/g,objPHPDate.aSuffix[g]),a=a.replace(/y5-cal-regexp:s/g,q),a=a.replace(/y5-cal-regexp:U/g,parseInt(this.getTime()/1e3,10)),a=a.replace(/y5-cal-regexp:w/g,j),a=a.replace(/y5-cal-regexp:Y/g,c),a=a.replace(/y5-cal-regexp:y/g,c.substring(2))}},objPHPDate.GetTimezoneOffset(),Date.prototype.getPHPDate=objPHPDate.PHPDate),window.DateChooser||(window.DateChooser=function(){var a=0,b=0,c=0,d=0,e={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0},f=null,g=!1,h={},i=null,j=null;if(!arguments||!document.getElementById||!document.getElementsByTagName)return null;for(var k=document.getElementsByTagName("body").length?document.getElementsByTagName("body")[0]:document,l=null,m=null,n=0;document.getElementById("calendar"+n);)++n;var o="calendar"+n,p=null,q=new Date;q.setHours(12),q.setMinutes(0),q.setSeconds(0),q.setMilliseconds(0);var r=new Date(q);r.setDate(1);var s=xb.createElement("div");s.id=o,s.className="calendar",s.style.visibility="hidden",s.style.position="absolute",s.style.zIndex="5001",s.style.top="0",s.style.left="0",k.appendChild(s);var t=function(){for(var a=s.getElementsByTagName("thead")[0].getElementsByTagName("a"),b=0;a[b];++b)events.add(a[b],"click",function(a){a=a||events.fix(event);var b=a.target||a.srcElement;"#text"==b.nodeName&&(b=b.parentNode);var c=b.className;return"previousyear"==c?(r.setFullYear(r.getFullYear()-1),i&&i.getTime()>r.getTime()&&(r.setMonth(i.getMonth()),r.setFullYear(i.getFullYear()))):"previousmonth"==c?(r.setMonth(r.getMonth()-1),i&&i.getTime()>r.getTime()&&(r.setMonth(i.getMonth()),r.setFullYear(i.getFullYear()))):"currentdate"==c?(r.setMonth(q.getMonth()),r.setFullYear(q.getFullYear())):"nextmonth"==c?(r.setMonth(r.getMonth()+1),j&&j.getTime()<r.getTime()&&(r.setMonth(j.getMonth()),r.setFullYear(j.getFullYear()))):"nextyear"==c&&(r.setFullYear(r.getFullYear()+1),j&&j.getTime()<r.getTime()&&(r.setMonth(j.getMonth()),r.setFullYear(j.getFullYear()))),v(),!1});for(var c=s.getElementsByTagName("tbody")[0].getElementsByTagName("a"),d=0;c[d];++d)events.add(c[d],"click",function(a){a=a||events.fix(event);var b=a.target||a.srcElement;"#text"==b.nodeName&&(b=b.parentNode);for(var d=0;c[d];++d)"selecteddate"==c[d].className&&c[d].removeAttribute("class");var g=new Date(r);g.setDate(parseInt(b.childNodes[0].nodeValue,10));var h=g.getTime(),k=g.getPHPDate("w");return delete g,i&&i.getTime()>h?!1:j&&j.getTime()<h?!1:e[k]?(r.setTime(h),r.setDate(1),p||(p=new Date(h)),p.setTime(h),b.className="selecteddate",m&&(m.style.display="none"),s.style.visibility="hidden",l&&clearTimeout(l),u(),f&&f(p),!1):!1});return!0},u=function(){if(!p)return!0;for(var a in h){var b=document.getElementById(a);b&&(b.value=p.getPHPDate(h[a]))}return!0},v=function(){var b,c,d,f,g,h,k,l,n,o="",q=new Date(r),u=new Date;u.setHours(12),u.setMinutes(0),u.setSeconds(0),u.setMilliseconds(0),b=xb.createElement("table"),b.setAttribute("summary","DateChooser"),c=xb.createElement("thead"),b.appendChild(c),d=xb.createElement("tr"),d.className="dclinks",c.appendChild(d),f=xb.createElement("td"),d.appendChild(f),g=xb.createElement("a"),g.className="previousyear",g.setAttribute("href","#"),g.setAttribute("title","Previous Year"),f.appendChild(g),g.appendChild(document.createTextNode(String.fromCharCode(171))),f=xb.createElement("td"),d.appendChild(f),g=xb.createElement("a"),g.className="previousmonth",g.setAttribute("href","#"),g.setAttribute("title","Previous Month"),f.appendChild(g),g.appendChild(document.createTextNode(String.fromCharCode(60))),f=xb.createElement("td"),f.setAttribute("colspan","3"),d.appendChild(f),g=xb.createElement("a"),g.className="currentdate",g.setAttribute("href","#"),g.setAttribute("title","Current Date"),f.appendChild(g),g.appendChild(document.createTextNode(r.getPHPDate("M Y"))),f=xb.createElement("td"),d.appendChild(f),g=xb.createElement("a"),g.className="nextmonth",g.setAttribute("href","#"),g.setAttribute("title","Next Month"),f.appendChild(g),g.appendChild(document.createTextNode(String.fromCharCode(62))),f=xb.createElement("td"),d.appendChild(f),g=xb.createElement("a"),g.className="nextyear",g.setAttribute("href","#"),g.setAttribute("title","Next Year"),f.appendChild(g),g.appendChild(document.createTextNode(String.fromCharCode(187))),d=xb.createElement("tr"),c.appendChild(d);for(var v=0;objPHPDate.aLetterDay[v];++v)k=xb.createElement("td"),d.appendChild(k),k.appendChild(document.createTextNode(objPHPDate.aLetterDay[(a+v)%objPHPDate.aLetterDay.length]));for(h=xb.createElement("tbody"),b.appendChild(h);q.getMonth()==r.getMonth();)for(d=xb.createElement("tr"),h.appendChild(d),v=0;7>v;++v){var w=(a+v)%objPHPDate.aLetterDay.length;q.getUTCDay()==w&&q.getMonth()==r.getMonth()?(l=q.getTime(),n=q.getPHPDate("w"),o=p&&q.getTime()==p.getTime()?"selectedday":"",o+=q.getTime()==u.getTime()?" today":"",o=o.length>0&&" "==o[1]?o.substr(1,o.length-1):o,k=xb.createElement("td"),(i&&i.getTime()>l||j&&j.getTime()<l||!e[n])&&(k.className="invalidday"),d.appendChild(k),g=xb.createElement("a"),o.length>0&&(g.className=o),g.setAttribute("href","#"),k.appendChild(g),g.appendChild(document.createTextNode(q.getDate())),q.setDate(q.getDate()+1)):(k=xb.createElement("td"),d.appendChild(k))}for(;s.hasChildNodes();)s.removeChild(s.firstChild);return s.appendChild(b),m&&(m.style.display="block",m.style.top=s.style.top,m.style.left=s.style.left,m.style.width=b.clientWidth+2+"px",m.style.height=b.clientHeight+4+"px"),t(),delete q,delete u,!0},w=function(){var a=arguments.length>0?arguments[0]:"auto",b=arguments.length>1?arguments[1]:"auto",c=s.style;return c.top=b+"",c.left=a+"",s.style.visibility="visible",l&&clearTimeout(l),p?r.setTime(p.getTime()):r.setTime(q.getTime()),r.setHours(12),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),r.setDate(1),v()},x=function(a){var b=0,c=0;if(a.offsetParent)for(b=a.offsetTop,c=a.offsetLeft;a.offsetParent;)a=a.offsetParent,b+=a.offsetTop,c+=a.offsetLeft;return{top:b,left:c}};this.displayPosition=function(){var a=arguments.length>0?arguments[0]:"auto",b=arguments.length>1?arguments[1]:"auto";return w(a,b)},this.display=function(a){a=a||events.fix(event);var d=a.target||a.srcElement;"#text"==d.nodeName&&(d=d.parentNode);var e=x(d);return w(e.left+b+"px",e.top+c+"px"),!1},this.setXOffset=function(){return b=arguments.length>0&&"number"==typeof arguments[0]?parseInt(arguments[0],10):b,!0},this.setYOffset=function(){return c=arguments.length>0&&"number"==typeof arguments[0]?parseInt(arguments[0],10):c,!0},this.setCloseTime=function(){return d=arguments.length>0&&"number"==typeof arguments[0]&&arguments[0]>=0?arguments[0]:d,!0},this.setUpdateFunction=function(){return arguments.length>0&&"function"==typeof arguments[0]&&(f=arguments[0]),!0},this.setUpdateField=function(){if(h={},"string"==typeof arguments[0]&&"string"==typeof arguments[1]&&document.getElementById(arguments[0]))h[arguments[0]]=arguments[1];else if("object"==typeof arguments[0]&&"object"==typeof arguments[1])for(var a=0;void 0!==arguments[0][a]&&!(a>=arguments[1].length);++a)h[arguments[0][a]]=arguments[1][a];else"object"==typeof arguments[0]&&(h=arguments[0]);return!0},this.setLink=function(){var a=arguments.length>0&&"string"==typeof arguments[0]?arguments[0]:"Choose a date",b=arguments.length>1&&"string"==typeof arguments[1]?document.getElementById(arguments[1]):null,c=arguments.length<=2||arguments[2],d=arguments.length>3&&"string"==typeof arguments[3]?arguments[3]:"Click to choose a date";if(!b)return!1;var e=xb.createElement("a");return e.className="calendarlink",e.href="#",d.length>0&&e.setAttribute("title",d),e.appendChild(document.createTextNode(a)),c?b.nextSibling?b.parentNode.insertBefore(e,b.nextSibling):b.parentNode.appendChild(e):b.parentNode.insertBefore(e,b),events.add(e,"click",this.display),!0},this.setIcon=function(){var a=arguments.length>0&&"string"==typeof arguments[0]?arguments[0]:g,b=arguments.length>1&&"string"==typeof arguments[1]?document.getElementById(arguments[1]):null,c=arguments.length<=2||arguments[2],d=arguments.length>3&&"string"==typeof arguments[3]?arguments[3]:"Click to choose a date";if(!b||!a)return!1;var e=xb.createElement("img");return e.className="calendaricon",e.src=a,e.setAttribute("alt","DateChooser Icon "+(n+1)),d.length>0&&e.setAttribute("title",d),c?b.nextSibling?b.parentNode.insertBefore(e,b.nextSibling):b.parentNode.appendChild(e):b.parentNode.insertBefore(e,b),events.add(e,"click",this.display),!0},this.setStartDate=function(){return arguments.length&&"object"==typeof arguments[0]&&arguments[0].getTime?(q.setTime(arguments[0].getTime()),q.setHours(12),q.setMinutes(0),q.setSeconds(0),q.setMilliseconds(0),i&&i.getTime()>q.getTime()?q.setTime(i.getTime()):j&&j.getTime()<q.getTime()&&q.setTime(j.getTime()),r.setMonth(q.getMonth()),r.setFullYear(q.getFullYear()),p||(p=new Date(q)),p.setTime(q),!0):!1},this.setEarliestDate=function(){return arguments.length&&"object"==typeof arguments[0]&&arguments[0].getTime?(i=new Date,i.setTime(arguments[0].getTime()),i.setHours(12),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),i.getTime()>q.getTime()&&(q.setTime(i.getTime()),r.setMonth(i.getMonth()),r.setFullYear(i.getFullYear())),p&&i.getTime()>p.getTime()&&(p.setTime(i.getTime()),r.setMonth(i.getMonth()),r.setFullYear(i.getFullYear())),!0):!1},this.setLatestDate=function(){return arguments.length&&"object"==typeof arguments[0]&&arguments[0].getTime?(j=new Date,j.setTime(arguments[0].getTime()),j.setHours(12),j.setMinutes(0),j.setSeconds(0),j.setMilliseconds(0),j.getTime()<q.getTime()&&(q.setTime(j.getTime()),r.setFullYear(j.getFullYear()),r.setMonth(j.getMonth())),p&&j.getTime()<p.getTime()&&(p.setTime(j.getTime()),r.setFullYear(j.getFullYear()),r.setMonth(j.getMonth())),!0):!1},this.setAllowedDays=function(){if(!arguments.length||"object"!=typeof arguments[0])return!1;var a;for(a=0;7>a;++a)e[a+""]=!1;for(a=0;void 0!==arguments[0][a];++a)e[arguments[0][a]+""]=!0;return!0},this.setWeekStartDay=function(){if(!arguments.length||"number"!=typeof arguments[0])return!1;var b=parseInt(arguments[0],10);return 0>b||b>6?!1:(a=b,!0)},this.getSelectedDate=function(){return p},this.setSelectedDate=function(a){return p||(p=new Date(a)),p.setTime(a.getTime()),p.setHours(12),p.setMinutes(0),p.setSeconds(0),p.setMilliseconds(0),u(),!0},this.updateFields=function(){return u()};var y=function(a){a=a||events.fix(event);var b=a.target||a.srcElement;for("#text"==b.nodeName&&(b=b.parentNode);b&&b!=document;){if("calendar"==b.className)return!0;b=b.parentNode}for(var c=0;n>=c;++c)m&&(m.style.display="none"),document.getElementById("calendar"+c).style.visibility="hidden";return!0},z=function(){return l&&clearTimeout(l),!0},A=function(){return d>0&&(l=setTimeout('document.getElementById("'+o+'").style.visibility = "hidden"; if (document.getElementById("iframehack")) document.getElementById("iframehack").style.display = "none";',d)),!0};return events.add(s,"mouseover",z),events.add(s,"mouseout",A),events.add(document,"mousedown",y),!0}),escape||(escape=function(a){return encodeURIComponent(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;){if(c in this&&this[c]===a)return c;++c}return-1}),Array.prototype.push||(Array.prototype.push=function(){for(var a=0;a<arguments.length;a++)this[this.length]=arguments[a];return this.length}),window.xb||(window.xb={createElement:function(a){return document.createElementNS?document.createElementNS("http://www.w3.org/1999/xhtml",a):document.createElement?document.createElement(a):null},getElementsByAttribute:function(a,b,c){var d=[];if(!a.all&&!a.getElementsByTagName)return d;for(var e,f=RegExp("(^|\\s)"+c+"(\\s|$)"),g=a.all||a.getElementsByTagName("*"),h=0;g[h];++h)g[h].getAttribute&&(e="class"==b?g[h].className:g[h].getAttribute(b),"string"==typeof e&&0!=e.length&&f.test(e)&&d.push(g[h]));return d},getStyle:function(a,b){if(document.defaultView&&document.defaultView.getComputedStyle)return document.defaultView.getComputedStyle(a,"").getPropertyValue(b);if(!a.currentStyle)return!0;for(var c=b.indexOf("-");c>=0;)b=b.substring(0,c)+b.substring(c+1,c+2).toUpperCase()+c.substring(c+2),c=b.indexOf("-");return a.currentStyle[b]},getOption:function(a,b){var c=a.getAttribute(b);if(c)return c;var d=3==arguments.length?arguments[2]:!1,e=a.className.match(RegExp("(?:^|\\s)"+b+"=(?:\\'|\\\")([^\\'\\\"]+)(?:\\'|\\\"|$)"));return e?e[1]:d},emptyNode:function(a){for(;a.childNodes.length;)a.removeChild(a.firstChild);return!0},addText:function(a,b){var c=b.replace(/^\s+/,"").replace(/\s+$/,"").replace(/[\r\n]+/,"\n").split("\n");for(nIndex=0;c[nIndex];++nIndex)nIndex&&a.appendChild(xb.createElement("br")),a.appendChild(document.createTextNode(c[nIndex]));return!0},writeText:function(a,b){return xb.emptyNode(a),xb.addText(a,b),!0},setSelectionRange:function(a,b,c){if(a.setSelectionRange)a.setSelectionRange(b,c);else if(document.selection){var d=a.value.substring(0,b).split("\n").length-1;b-=d,c-=d;var e=document.selection.createRange();e.moveToElementText(a),e.collapse(!0),e.moveStart("character",b),e.moveEnd("character",c-b),e.select()}return a.focus(),!0},replaceSelectionRange:function(a,b){if(a.setSelectionRange)a.value=a.value.substring(0,a.selectionStart)+b+a.value.substring(a.selectionEnd);else if(document.selection){var c=document.selection.createRange();c.text=b}return a.focus(),!0},bookmark:function(){if(window.sidebar)return window.sidebar.addPanel(document.title,location.href,null),!0;if(window.opera&&window.print){var a=xb.createElement("a");return a.setAttribute("rel","sidebar"),a.setAttribute("href",location.href),a.setAttribute("title",document.title),a.click(),!0}return document.all?(window.external.AddFavorite(location.href,document.title),!0):(alert("Click Bookmarks->Add Bookmark... to add this page"),!1)}}),window.events||(window.events={nEventID:1,add:function(a,b,c){c.$$nEventID||(c.$$nEventID=this.nEventID++),void 0===a.objEvents&&(a.objEvents={});var d=a.objEvents[b];return d||(d=a.objEvents[b]={},a["on"+b]&&(d[0]=a["on"+b])),d[c.$$nEventID]=c,a["on"+b]=this.handle,!0},remove:function(a,b,c){return a.objEvents&&a.objEvents[b]&&delete a.objEvents[b][c.$$nEventID],!0},exists:function(a,b,c){return a.objEvents&&a.objEvents[b]&&a.objEvents[b][c.$$nEventID]},handle:function(a){a=a||window.events.fix(event);var b=!0,c=this.objEvents[a.type];for(var d in c)this.$$handle=c[d],this.$$handle(a)===!1&&(b=!1);return b},fix:function(a){return a.preventDefault=this.fix.preventDefault,a.stopPropagation=this.fix.stopPropagation,a},cancel:function(a){return a.preventDefault(),a.stopPropagation(),!1},getposition:function(a){return a=a||window.events.fix(event),{x:a.offsetX?a.offsetX:a.pageX?a.pageX-a.target.offsetLeft:0,y:a.offsetY?a.offsetY:a.pageY?a.pageY-a.target.offsetTop:0}}},window.events.fix.preventDefault=function(){return this.returnValue=!1,!0},window.events.fix.stopPropagation=function(){return this.cancelBubble=!0,!0}),events.add(window,"load",function(){var ndDateChooser,ndElement,sLastID,sLinkID,objUpdateField,objDate,aPatternNodes,sDateFormat,sIcon,sText,sXOffset,sYOffset,sCloseTime,sOnUpdate,sStartDate,sEarliestDate,sLatestDate,sAllowedDays,sWeekStartDay,sLinkPosition,nFieldID=0;objDate=new Date,objDate.setHours(12),objDate.setMinutes(0),objDate.setMilliseconds(0);for(var aElements=xb.getElementsByAttribute(document,"class","datechooser"),nIndex=0;aElements[nIndex];++nIndex){ndDateChooser=aElements[nIndex],ndDateChooser.id||(ndDateChooser.id="dc-id-"+ ++nFieldID),sLastID=ndDateChooser.id,sDateFormat=xb.getOption(ndDateChooser,"dc-dateformat"),sIcon=xb.getOption(ndDateChooser,"dc-iconlink"),sText=xb.getOption(ndDateChooser,"dc-textlink"),sXOffset=xb.getOption(ndDateChooser,"dc-offset-x"),sYOffset=xb.getOption(ndDateChooser,"dc-offset-y"),sCloseTime=xb.getOption(ndDateChooser,"dc-closetime"),sOnUpdate=xb.getOption(ndDateChooser,"dc-onupdate"),sStartDate=xb.getOption(ndDateChooser,"dc-startdate"),sEarliestDate=xb.getOption(ndDateChooser,"dc-earliestdate"),sLatestDate=xb.getOption(ndDateChooser,"dc-latestdate"),sAllowedDays=xb.getOption(ndDateChooser,"dc-alloweddays"),sWeekStartDay=xb.getOption(ndDateChooser,"dc-weekstartday"),sLinkPosition=xb.getOption(ndDateChooser,"dc-linkposition"),sLinkPosition&&(sLinkID=ndDateChooser.id),objUpdateField={},sDateFormat&&(objUpdateField[ndDateChooser.id]=sDateFormat),aPatternNodes=ndDateChooser.all||ndDateChooser.getElementsByTagName("*");for(var nPattern=0;aPatternNodes[nPattern];++nPattern)ndElement=aPatternNodes[nPattern],sDateFormat=xb.getOption(ndElement,"dc-dateformat"),sDateFormat&&(ndElement.id||(ndElement.id="dc-id-"+ ++nFieldID),sLastID=ndElement.id,objUpdateField[sLastID]=sDateFormat,sLinkPosition||xb.getOption(ndElement,"dc-linkposition"),sLinkPosition&&(sLinkID=sLastID));sLinkPosition||(sLinkID=sLastID,sLinkPosition="right"),ndDateChooser.DateChooser=new DateChooser,sXOffset&&ndDateChooser.DateChooser.setXOffset(sXOffset),sYOffset&&ndDateChooser.DateChooser.setYOffset(sYOffset),sCloseTime&&ndDateChooser.DateChooser.setCloseTime(sCloseTime),sOnUpdate&&ndDateChooser.DateChooser.setUpdateFunction(eval(sOnUpdate)),sStartDate&&(objDate=new Date,objDate.setFullYear(parseInt(sStartDate.substring(4),10)),objDate.setMonth(parseInt(sStartDate.substring(0,2),10)-1),objDate.setDate(parseInt(sStartDate.substring(2,4),10)),ndDateChooser.DateChooser.setStartDate(objDate)),sEarliestDate&&(objDate=new Date,objDate.setFullYear(parseInt(sEarliestDate.substring(4),10)),objDate.setMonth(parseInt(sEarliestDate.substring(0,2),10)-1),objDate.setDate(parseInt(sEarliestDate.substring(2,4),10)),ndDateChooser.DateChooser.setEarliestDate(objDate)),sLatestDate&&(objDate=new Date,objDate.setFullYear(parseInt(sLatestDate.substring(4),10)),objDate.setMonth(parseInt(sLatestDate.substring(0,2),10)-1),objDate.setDate(parseInt(sLatestDate.substring(2,4),10)),ndDateChooser.DateChooser.setLatestDate(objDate)),sAllowedDays&&ndDateChooser.DateChooser.setAllowedDays(sAllowedDays.split(",")),sWeekStartDay&&ndDateChooser.DateChooser.setWeekStartDay(parseInt(sWeekStartDay,10)),sIcon&&ndDateChooser.DateChooser.setIcon(sIcon,sLinkID,"left"!=sLinkPosition),sText&&ndDateChooser.DateChooser.setLink(sText,sLinkID,"left"!=sLinkPosition),ndDateChooser.DateChooser.setUpdateField(objUpdateField)}return delete objDate,!0}),dragtable={dragRadius2:100,setMinDragDistance:function(a){dragtable.dragRadius2=a*a},cookieDays:365,setCookieDays:function(a){dragtable.cookieDays=a},Browser:function(){var a,b,c;return this.isIE=!1,this.isNS=!1,this.version=null,a=navigator.userAgent,b="MSIE",(c=a.indexOf(b))>=0?(this.isIE=!0,this.version=parseFloat(a.substr(c+b.length)),void 0):(b="Netscape6/",(c=a.indexOf(b))>=0?(this.isNS=!0,this.version=parseFloat(a.substr(c+b.length)),void 0):(b="Gecko",(c=a.indexOf(b))>=0?(this.isNS=!0,this.version=6.1,void 0):void 0))},browser:null,init:function(){arguments.callee.done||(arguments.callee.done=!0,_dgtimer&&clearInterval(_dgtimer),document.createElement&&document.getElementsByTagName&&(dragtable.dragObj.zIndex=0,dragtable.browser=new dragtable.Browser,forEach(document.getElementsByTagName("table"),function(a){-1!=a.className.search(/\bdraggable\b/)&&dragtable.makeDraggable(a)})))},makeDraggable:function(a){0==a.getElementsByTagName("thead").length&&(the=document.createElement("thead"),the.appendChild(a.rows[0]),a.insertBefore(the,a.firstChild)),null==a.tHead&&(a.tHead=a.getElementsByTagName("thead")[0]);for(var b=a.tHead.rows[0].cells,c=0;c<b.length;c++)b[c].onmousedown=dragtable.dragStart;dragtable.cookiesEnabled()&&a.id&&-1==a.className.search(/\bforget-ordering\b/)&&dragtable.replayDrags(a)},dragObj:new Object,findUp:function(a,b){do if(a.nodeName&&-1!=a.nodeName.search(b))return a;while(a=a.parentNode);return null},fullCopy:function(a,b){var c=a.cloneNode(b);return c.className=a.className,forEach(a.style,function(b,d){null!=b&&("string"!=typeof b||0!=b.length)&&(c.style[d]=a.style[d])
}),c},eventPosition:function(a){var b,c;return dragtable.browser.isIE?(b=window.event.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,c=window.event.clientY+document.documentElement.scrollTop+document.body.scrollTop,{x:b,y:c}):{x:a.pageX,y:a.pageY}},absolutePosition:function(a,b){var c=0,d=0;do{var e=dragtable.browser.isIE?a.currentStyle:window.getComputedStyle(a,""),f=!(dragtable.browser.isIE&&dragtable.browser.version<7);if(b&&"relative"==e.position)break;if(f&&"fixed"==e.position){c+=parseInt(e.left,10),d+=parseInt(e.top,10),c+=document.body.scrollLeft,d+=document.body.scrollTop;break}c+=a.offsetLeft,d+=a.offsetTop}while(a=a.offsetParent);return{x:c,y:d}},dragStart:function(a){var b=dragtable.dragObj,c=dragtable.browser;b.origNode=c.isIE?window.event.srcElement:a.target;var d=dragtable.eventPosition(a);b.origNode=dragtable.findUp(b.origNode,/T[DH]/);var e=dragtable.findUp(b.origNode,"TABLE");if(b.table=e,b.startCol=dragtable.findColumn(e,d.x),-1!=b.startCol){var f=dragtable.fullCopy(e,!1);f.style.margin="0";var g=function(a,b){var c=dragtable.fullCopy(a,!1);return forEach(a.rows,function(a){var d=a.cells[b],e=dragtable.fullCopy(a,!1);a.offsetHeight&&(e.style.height=a.offsetHeight+"px");var f=dragtable.fullCopy(d,!0);d.offsetWidth&&(f.style.width=d.offsetWidth+"px"),e.appendChild(f),c.appendChild(e)}),c};e.tHead&&f.appendChild(g(e.tHead,b.startCol)),forEach(e.tBodies,function(a){f.appendChild(g(a,b.startCol))}),e.tFoot&&f.appendChild(g(e.tFoot,b.startCol));var h=dragtable.absolutePosition(b.origNode,!0);f.style.position="absolute",f.style.left=h.x+"px",f.style.top=h.y+"px",f.style.width=b.origNode.offsetWidth+"px",f.style.height=b.origNode.offsetHeight+"px",f.style.opacity=.7,b.addedNode=!1,b.tableContainer=b.table.parentNode||document.body,b.elNode=f,b.cursorStartX=d.x,b.cursorStartY=d.y,b.elStartLeft=parseInt(b.elNode.style.left,10),b.elStartTop=parseInt(b.elNode.style.top,10),isNaN(b.elStartLeft)&&(b.elStartLeft=0),isNaN(b.elStartTop)&&(b.elStartTop=0),b.elNode.style.zIndex=++b.zIndex,c.isIE?(document.attachEvent("onmousemove",dragtable.dragMove),document.attachEvent("onmouseup",dragtable.dragEnd),window.event.cancelBubble=!0,window.event.returnValue=!1):(document.addEventListener("mousemove",dragtable.dragMove,!0),document.addEventListener("mouseup",dragtable.dragEnd,!0),a.preventDefault())}},dragMove:function(a){var b=dragtable.dragObj,c=dragtable.eventPosition(a),d=b.cursorStartX-c.x,e=b.cursorStartY-c.y;!b.addedNode&&d*d+e*e>dragtable.dragRadius2&&(b.tableContainer.insertBefore(b.elNode,b.table),b.addedNode=!0);var f=b.elNode.style;f.left=b.elStartLeft+c.x-b.cursorStartX+"px",f.top=b.elStartTop+c.y-b.cursorStartY+"px",dragtable.browser.isIE?(window.event.cancelBubble=!0,window.event.returnValue=!1):a.preventDefault()},dragEnd:function(a){dragtable.browser.isIE?(document.detachEvent("onmousemove",dragtable.dragMove),document.detachEvent("onmouseup",dragtable.dragEnd)):(document.removeEventListener("mousemove",dragtable.dragMove,!0),document.removeEventListener("mouseup",dragtable.dragEnd,!0));var b=dragtable.dragObj;if(b.addedNode){b.tableContainer.removeChild(b.elNode);var c=dragtable.eventPosition(a),d=dragtable.absolutePosition(b.table);if(!(c.y<d.y||c.y>d.y+b.table.offsetHeight)){var e=dragtable.findColumn(b.table,c.x);-1!=e&&e!=b.startCol&&(dragtable.moveColumn(b.table,b.startCol,e),b.table.id&&dragtable.cookiesEnabled()&&-1==b.table.className.search(/\bforget-ordering\b/)&&dragtable.rememberDrag(b.table.id,b.startCol,e))}}},findColumn:function(a,b){for(var c=a.tHead.rows[0].cells,d=0;d<c.length;d++){var e=dragtable.absolutePosition(c[d]);if(e.x<=b&&b<=e.x+c[d].offsetWidth)return d}return-1},moveColumn:function(a,b,c){for(var d,e=a.rows.length;e--;){d=a.rows[e];var f=d.removeChild(d.cells[b]);c<d.cells.length?d.insertBefore(f,d.cells[c]):d.appendChild(f)}for(var g=a.tHead.rows[0].cells,e=0;e<g.length;e++)g[e].sorttable_columnindex=e},cookiesEnabled:function(){return"file:"!=window.location.protocol&&navigator.cookieEnabled},rememberDrag:function(a,b,c){var d="dragtable-"+a,e=dragtable.readCookie(d),f="";e&&(f=e+","),f+=b+"/"+c,dragtable.createCookie(d,f,dragtable.cookieDays)},replayDrags:function(a){if(dragtable.cookiesEnabled()){var b=dragtable.readCookie("dragtable-"+a.id);if(b)for(var c=b.split(","),d=0;d<c.length;d++){var e=c[d].split("/");if(2==e.length){var f=parseInt(e[0]),g=parseInt(e[1]);isNaN(f)||isNaN(g)||dragtable.moveColumn(a,f,g)}}}},cookiesEnabled:function(){return"file:"!=window.location.protocol&&navigator.cookieEnabled},createCookie:function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+1e3*60*60*24*c);var e="; expires="+d.toGMTString()}else var e="";var f=document.location.pathname;document.cookie=a+"="+b+e+"; path="+f},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},eraseCookie:function(a){dragtable.createCookie(a,"",-1)}};var dgListenOnLoad=!1;if(document.addEventListener&&(dgListenOnLoad=!0,document.addEventListener("DOMContentLoaded",dragtable.init,!1)),/WebKit/i.test(navigator.userAgent)){dgListenOnLoad=!0;var _dgtimer=setInterval(function(){/loaded|complete/.test(document.readyState)&&dragtable.init()},10)}dgListenOnLoad||(window.onload=dragtable.init),Array.forEach||(Array.forEach=function(a,b,c){for(var d=0;d<a.length;d++)b.call(c,a[d],d,a)}),Function.prototype.forEach=function(a,b,c){for(var d in a)"undefined"==typeof this.prototype[d]&&b.call(c,a[d],d,a)},String.forEach=function(a,b,c){Array.forEach(a.split(""),function(d,e){b.call(c,d,e,a)})};var forEach=function(a,b,c){if(a){var d=Object;if(a instanceof Function)d=Function;else{if(a.forEach instanceof Function)return a.forEach(b,c),void 0;"string"==typeof a?d=String:"number"==typeof a.length&&(d=Array)}d.forEach(a,b,c)}};Viewport.prototype.contains=function(a){return a.x>=this.x&&a.x<=this.x+this.w&&a.y>=this.y&&a.y<=this.y+this.h?!0:!1},GanttCanvas.prototype.initWorkSpace=function(){var a,b,c,d,e,f,g,h,i,j,k=this.splitterBarPerc||50;a=$(".splitterWrapper");var l=$(".loading"),m={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},n=new Spinner(m).spin();this.spinner=n,l.get(0).appendChild(n.el);var o=a.innerWidth()/2-l.width(),p=a.innerHeight()/2-l.height();l.css("left",o+"px").css("top",p+"px").addClass("done"),$(".loadingWrapper").addClass("done"),e=$(".splitterContainer"),d=$("#vSplitBar"),b=$("#first"),c=$("#second"),f=$("#gantt_table"),g=$("#tableHeadWrapper"),h=$("#canvasWrapper"),i=$("#headerWrapper"),j=$("#phaseWrapper");var q=g.children(0).height();f.css("top",q+"px");var r=a.innerWidth(),s=e.height(),t=Math.min(r*k/100-d.width()-16,f.width());b.width(t).css({left:0}),d.css({left:b.outerWidth()}),c.width(r-b.width()-d.width()).css({left:b.outerWidth(!0)+d.width()}),b.height(s),c.height(s);var u=g.children(0).height();g.height(u),g.width(t),resizeTables(["gantt_table","ganttTableHeader"]),c.css("overflow-y","auto").scroll(function(){b.scrollTop(c.scrollTop())}),b.scroll(function(){g.scrollLeft(b.scrollLeft())});var v=b.outerWidth(!0)-b.outerWidth(),w=c.outerWidth(!0)-c.outerWidth(),x=this;d.on("mousedown",function(){$("body").on("mousemove",function(a){$(this).unselectable();var e=a.pageX-d.parent().offset().left,f=d.parent().width();e>10&&f-20>e&&(d.css({left:e}),b.width(e-v),c.css({left:e+d.width(),width:f-e-d.width()-w}),h.css("left",c.css("left")),h.children(0).get(0).width=c.width()-16,i.css("left",c.css("left")),i.css("width",c.width()+"px"),j.css("left",c.css("left")),j.children(0).get(0).width=c.width()-16,g.width(e-v),x.viewport.w=c.width()-16,x.valid=!1)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup").clearUnselectable()})});var y=f.height(),z=$(".gantt_row:first"),A=z.children().length,B=z.outerHeight(),C=Math.ceil((b.height()-y)/B);if(C>0)for(var D,E=f.find("tbody"),F=0;C>F;F++){D=$("<tr class=gantt_row></tr>");for(var G=0;A>G;G++)D.append($("<td>&nbsp</td>"));E.append(D)}var H=document.getElementById("canvasGrid");H.style.height=Math.max(c.height()-16,f.height()+g.height())+"px";var I=daysBetween(this.start,this.end);H.style.width=this.dayWidth*I+"px",this.canvasGrid=H,this.canvas.height=c.height()-16,this.canvas.width=c.width()-16,this.width=parseInt(H.style.width,10),this.oldWidth=this.width,this.height=parseInt(H.style.height,10),this.viewport=new Viewport({x:0,y:0,w:c.width(),h:c.height()}),c.on("scroll",function(){var a=this.scrollLeft,b=this.scrollTop;if(x.viewport.x=a,x.viewport.y=b,this.yAxis)for(var c=0;c<this.yAxis.length;c++)this.yAxis[c]+=b}),b.on("mouseover",function(){$(".popUpInfo").hide()}),h.css("top",c.css("top")).css("left",c.css("left")),h.get(0).setAttribute("tabindex","2"),i.css("top",c.css("top")).css("left",c.css("left")),i.get(0).setAttribute("tabindex","3");var J=document.createElement("canvas");J.id="phaseCanvas";var K=$.browser;K.msie&&"8.0"==K.version&&G_vmlCanvasManager.initElement(J),J.height=K.mozilla&&0===F?$("#sliderRow").outerHeight(!0)-10:$("#sliderRow").outerHeight(!0),J.width=$("#canvas").width(),j.append($(J)),j.css("top",$("table.ganttHeader thead").height()).css("left",c.css("left")),j.get(0).setAttribute("tabindex","3"),this.phaseCanvas=J,this.phaseCTX=this.phaseCanvas.getContext("2d");var L=new Date;L.setDate(1),L.setMonth(0);var M=this.getRelativeXCord(L);c.scrollLeft(M)},GanttCanvas.prototype.initEventListeners=function(){function a(a){var b;return b=a&&"function"==typeof a.createContextMenu?a.createContextMenu(c):createDefaultContextMenu(c)}function b(){var b=$("#canvasWrapper");b.bind("contextmenu",function(b){var d=$(".control_contextmenu");d.length>0&&d.remove();var e=a(c.selection[0],b),f=b.clientY;window.innerHeight-f<e.height()&&(f-=e.height()),e.offset({top:f,left:b.clientX}),e.css("display","block"),b.preventDefault()}),$(document).on("click",function(){var a=$(".control_contextmenu"),b=$(".control_subcontextmenu");"block"!==b.css("display")&&(a.offset({top:0,left:0}),a.hide(),a.remove())}),$("#pageContent").on("scroll",function(){var a=$(".control_contextmenu");a.hide(),a.remove()})}var c=this,d=this.canvas;addEventListener(d,"selectstart",function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}),b();var e=document.getElementById("second");addEventListener(e,"scroll",function(){c.valid=!1}),this.dbclickEvent=function(){null!==c.selection[0]&&"function"==typeof c.selection[0].dbclickAction&&c.selection[0].dbclickAction(c)},addEventListener(d,"dblclick",function(a){c.dbclickEvent(a)}),this.mouseDownEvent=function(a){var b=c.getMouse(a);if(-1!==c.expectResize)return c.isResizeDrag=!0,void 0;var d=b.x,e=b.y;if(!("canvas"!==a.target.id||d<c.viewport.x||d>c.viewport.x+c.viewport.w-16||e<c.viewport.y||e>c.viewport.y+c.viewport.h-16)){var f;for(var g in c.tasks)if(c.tasks.hasOwnProperty(g)){var h=c.tasks[g];if("function"==typeof h.contains&&h.contains(d,e))return f=h,c.dragoffx=d-f.x,c.dragoffy=e-f.y,c.dragging=!0,c.selection[0]=f,c.valid=!1,void 0}for(var i=c.shapes.length,j=0;i>j;j++)for(var k=c.shapes[j],l=k.length,m=l-1;m>=0;m--)if(k[m].contains(d,e)){if(f="function"==typeof k[m].returnSelected?k[m].returnSelected(d,e):k[m],f.group)for(var n=0;n<f.lines.length;n++)if(f.lines[n].contains(d,e)){f=f.lines[n];break}return c.dragoffx=d-f.x,c.dragoffy=e-f.y,c.dragging=!0,c.selection[0]=f,c.valid=!1,void 0}c.selection[0]&&(c.selection[0]=null,c.valid=!1)}},addEventListener(d,"mousedown",function(a){c.mouseDownEvent(a),a.stopPropagation()}),addEventListener(document.body,"mousedown",function(a){c.mouseDownEvent(a)}),this.mouseOverEvent=function(a,b){var d=b.x,e=b.y;if(this.viewport,this.displayToolTips){var f=c.getPhaseSelectors();for(var g in f){var h=f[g];if(h.isGroup===!0){if(h.contains(d,e))return h.showToolTip(a,this),void 0;h.hideToolTip()}}for(var i in c.tasks)if(c.tasks.hasOwnProperty(i)){var j=c.tasks[i];if("function"==typeof j.contains){if(j.contains(d,e))return j.showToolTip(a,this),void 0;"function"==typeof j.hideToolTip&&j.hideToolTip()}}}},this.mouseMoveEvent=function(a){var b=c.getMouse(a);if(c.dragging)c.selection[0].move(b,c),c.valid=!1;else if(c.isResizeDrag){{var d=c.selection[0];d.x,d.y}return void 0!==d.resize?(d.resize(b,c.expectResize,this),void 0):void 0}if(null!==c.selection[0]&&!c.isResizeDrag){for(var e=0;8>e;e++){var f=c.selectionHandles[e];if(b.x>=f.x&&b.x<=f.x+c.selBoxSize&&b.y>=f.y&&b.y<=f.y+c.selBoxSize){switch(c.expectResize=e,c.valid=!1,e){case 0:c.canvas.style.cursor="nw-resize";break;case 1:c.canvas.style.cursor="n-resize";break;case 2:c.canvas.style.cursor="ne-resize";break;case 3:c.canvas.style.cursor="w-resize";break;case 4:c.canvas.style.cursor="e-resize";break;case 5:c.canvas.style.cursor="sw-resize";break;case 6:c.canvas.style.cursor="s-resize";break;case 7:c.canvas.style.cursor="se-resize"}return}}c.isResizeDrag=!1,c.expectResize=-1,c.canvas.style.cursor="auto"}this.mouseOverEvent(a,b)},addEventListener(d,"mousemove",function(a){c.mouseMoveEvent(a)}),this.mouseUpEvent=function(){c.dragging=!1,c.isResizeDrag=!1,c.expectResize=-1,null!==c&&null!==c.selection[0]&&void 0!==c.selection[0]&&(void 0!==c.selection[0].mouseUpEvent?c.selection[0].mouseUpEvent(c):c.selection[0].collisionBlock&&(c.selection[0].collisionBlock.colLineStart=c.selection.x))},addEventListener(d,"mouseup",function(a){c.mouseUpEvent(a),a.stopPropagation()}),addEventListener(document.body,"mouseup",function(a){c.mouseUpEvent(a)})},GanttCanvas.prototype.init=function(){this.initEventListeners(),this.initWorkSpace();var a=this,b=4,c=10,d=20,e=$("#first").outerHeight(),f=$("table.gantt thead:first").outerHeight(),g=$("#sliderRow").outerHeight()+f+1,h=$(".gantt_row:first"),i=$("#gantt_table"),j=h.outerHeight(!0)+parseInt(h.css("border"),10)+parseInt(h.css("padding-top"),10)+parseInt(h.css("padding-bottom"),10);isNaN(j)&&(j=24);var k=g-1,l=i.find("tr.gantt_row").length,m=Math.floor(g),n=[];j++;var o=$.browser;o.mozilla?k--:o.msie;for(var p=0;l>=p;p++){m=p*j,n.push(k+m+.5);var q;q=o.mozilla&&0===p?k+m+.1:k+m;var r="#7F9DB9",s=new CollisionLine({x:0,y:q,w:1e4,h:1,fill:r,dragX:!1,dragY:!1,highlightSelected:!1});s.contains=function(){return!1},s.draw=function(b){var c,d=this.fill.match(/\d+/g);c=this.isLocked?"rgba("+d[0]+","+d[1]+","+d[2]+",0.25)":"rgba("+d[0]+","+d[1]+","+d[2]+",1)",this.fill=c,b.fillStyle=this.fill;var e=this.x,f=this.y,g=translateCoords({x:e,y:f},a);b.fillRect(e,g.y,this.w,this.h)},this.addShape(s,0)}this.yAxis=n;var t,u,v,w,x,y=this.phases,z=this.colors,A={};for(p=0;p<y.length;p++){t=this.getRelativeXCord(y[p].date),A[y[p].name]=z[p%z.length],u=Math.max(10*y[p].name.length,50),w=new LineGroup({dragX:!0,dragY:!1,numLines:l,highlightSelected:!0,x:t,y:g,w:b,h:e-j,fill:z[p%z.length]});for(var B=0;l>B;B++)v=new CollisionLine({dragX:!0,dragY:!1,numLines:l,highlightSelected:!0,x:t,y:n[B],w:b,h:j,fill:z[p%z.length]}),v.contains=function(){return!1},w.addLine(v);v=new CollisionLine({dragX:!1,dragY:!1,numLines:l,highlightSelected:!1,x:t,y:n[n.length-1],w:b,h:this.height-n[n.length-1],fill:z[p%z.length]}),w.addLine(v),x=new LineGroupSelector({dragX:!0,dragY:!1,numLines:l,highlightSelected:!0,x:t,y:g-d-2.5,w:c,h:d,name:y[p].name,text:y[p].name,fill:z[p%z.length],linegroup:w}),this.phaseSelectors[y[p].name]=x,this.addShape(w,2),this.addShape(x,2),this.colorIndex++,x.alignToMonth(this)}this.phaseColors=A,this.setHeader(new DateHeaderBar(0,0,null,f,a.start,a.end,this))},GanttCanvas.prototype.addShape=function(a,b){if(this.shapes.length<b)for(var c=this.shapes.length;b>=c;c++)this.shapes.push([]);this.shapes[b].push(a),this.valid=!1},GanttCanvas.prototype.removeShape=function(a){for(var b,c=0;c<this.shapes.length;c++)if(b=this.shapes[c].indexOf(a),-1!=b){this.shapes[c].splice(b,1);break}this.valid=!1},GanttCanvas.prototype.getRelativeXCord=function(a){var b=this,c=b.start.getTime(),d=b.end.getTime(),e=d-c,f=new Date(a),g=f.getTime(),h=this.width,i=(g-c)/e;return Math.round(h*i)},GanttCanvas.prototype.getDateFromXCord=function(a){var b=this,c=b.start,d=b.end,e=d-c,f=b.width,g=a/f,h=c.getTime()+g*e;return new Date(h)},GanttCanvas.prototype.addTask=function(a){var b,c=this.getRelativeXCord(a.start),d=this.getRelativeXCord(a.end),e=this.numTasks;b=0===e%2?"rgba(0, 102, 0, 0.5)":"rgba(0, 204, 0, 0.5)",a.phase&&"Start"!==a.phase&&this.phaseColors[a.phase]&&(b=hex2rgb(this.phaseColors[a.phase],.5));for(var f=this.yAxis,g=f[1]-f[0],h=Math.round(.7*(f[1]-f[0])),i=this.numTasks;i>f.length-1;)f.push(f[f.length-1]+g+.5);a.rowNum=i;var j={dragX:!0,dragY:!1,fill:b,x:c,y:f[i]+4,w:d-c,h:h,id:a.id,name:a.name,studyID:a.studyID,level:a.level,phase:a.phase,endEarly:a.endEarly,TaskInfo:a.TaskInfo},k=new GanttCanvasTask(j),l=a.subtasks;if(l)for(i=0;i<l.length;i++)k.addChild(l[i],this);this.tasks[k.id]=k,this.numTasks=this.numTasks+1,k.setPhaseLinePosition(this)},GanttCanvas.prototype.copyTask=function(a){var b=this.tasks[a[0]],c=this.getDateFromXCord(b.x),d=this.getDateFromXCord(b.x+b.w);this.addNewTask(b,a[1],a[2],c,d)},GanttCanvas.prototype.addPhase=function(a){var b,c,d,e,f;"string"==typeof a?b=this.getRelativeXCord(a):"number"==typeof a&&(b=a);var g=$("tr.gantt_row").filter(function(){return"none"!==$(this).css("display")}).length;f=[];var h=$("table.gantt thead:first").outerHeight(),i=$("#sliderRow").outerHeight()+h+1,j=$(".gantt_row:first");$("#gantt_table");var k=j.outerHeight(!0)+parseInt(j.css("border"),10)+parseInt(j.css("padding-top"),10)+parseInt(j.css("padding-bottom"),10),l=4,m=10,n=20,o=$("#first").outerHeight(),p=i-1,q=this.colors,r=this.colorIndex++,s=q[r%q.length],t="P"+(r+1).toString();k++;var u=$.browser;u.mozilla&&p--;for(var v=Math.floor(i),w=0;g>w;w++)v=w*k,f.push(p+v+.5);d=new LineGroup({dragX:!0,dragY:!1,numLines:g,footerText:"Date: ",highlightSelected:!0,x:b+l/2,y:i,w:l,h:o-k,fill:s});for(var x=0;g>x;x++)e=new CollisionLine({linegroup:d,dragX:!1,dragY:!1,numLines:g,footerText:"Date: ",highlightSelected:!1,x:b+l/2,y:f[x],w:l,h:k,fill:s}),e.contains=function(){return!1},d.addLine(e);e=new CollisionLine({dragX:!1,dragY:!1,numLines:g,footerText:"Date: ",highlightSelected:!1,x:b+l/2,y:f[f.length-1],w:l,h:this.height-f[f.length-1],fill:s}),d.addLine(e),c=new LineGroupSelector({dragX:!0,dragY:!1,numLines:g,highlightSelected:!0,x:b+2,y:i-n-2.5,w:m,h:n,name:t,text:t,fill:s,linegroup:d,editableName:!0}),this.addShape(d,2),this.addShape(c,2),c.alignToMonth(this),this.phaseSelectors[t]=c,c.ajaxUpdate(this)},GanttCanvas.prototype.getPhaseSelectors=function(){for(var a=this.shapes,b=[],c=0;c<a.length;c++)for(var d=a[c],e=d.length,f=0;e>f;f++){var g=d[f];g.isSelector===!0&&b.push(g)}return b},GanttCanvas.prototype.getPhases=function(){for(var a=this.shapes,b={},c=0;c<a.length;c++)for(var d=a[c],e=d.length,f=0;e>f;f++){var g=d[f];if(g.isSelector===!0)if(g.hasOwnProperty("isGroup"))for(var h in g.selectors)b[g.selectors[h].name]=g.selectors[h];else b[g.name]=g}return b},GanttCanvas.prototype.displayFullScreen=function(){var a,b,c,d,e,f,g,h,i,j,k=50,l=$("#ganttChart");if(a=$("#buttonBar"),b=$(".splitterWrapper"),c=$(".splitterContainer"),l.hasClass("overlay")){$(".blanket").remove(),l.removeClass("overlay"),a.removeClass("fullSizeButtonBar").removeClass("fullWidth"),b.removeClass("fullWidth").addClass("fullHeight");var m=$("h2:contains(Gantt)");l.insertAfter(m)}else{$("#pageContent").scrollTop(0);var n=$('<div class="blanket">&nbsp</div>');n.css("background-color","#FFFFFF"),$("body").append('<div class="blanket"></div>'),l.addClass("overlay"),a.addClass("fullWidth").addClass("fullSizeButtonBar"),b.addClass("fullWidth").addClass("fullHeight"),$("body").append(l)}d=$("#vSplitBar"),e=$("#first"),f=$("#second"),g=$("#canvasWrapper"),h=$("#phaseWrapper"),i=$("#headerWrapper"),j=$("#tableHeadWrapper");var o=b.innerWidth(),p=c.height(),q=Math.min(o*k/100-d.width()-16,$("#gantt_table").width());e.width(q).css({left:0}),d.css({left:e.outerWidth()});var r=e.outerWidth(!0)+d.width(),s=o-e.width()-d.width();f.width(s).css({left:r}),e.height(p),f.height(p),g.css({left:r});var t=g.children(0).get(0);t.width=f.width()-16,t.height=p-16,i.css({left:r,width:s}),h.css("left",$("#second").css("left")),h.children(0).get(0).width=f.width()-16,j.width(q),this.canvasGrid.style.height=Math.max(parseInt(this.canvasGrid.style.height,10),t.height)+"px",this.height=parseInt(this.canvasGrid.style.height,10),this.viewport.w=f.width()-16;var u=$("#gantt_table").height(),v=$(".gantt_row:first"),w=v.children().length,x=v.outerHeight(),y=Math.ceil((e.height()-u)/x);if(y>0)for(var z,A=$("#gantt_table").find("tbody"),B=0;y>B;B++){z=$("<tr class=gantt_row></tr>");for(var C=0;w>C;C++)z.append($("<td>&nbsp</td>"));A.append(z)}var D=new Date;D.setDate(1),D.setMonth(0);var E=this.getRelativeXCord(D);f.scrollLeft(E),this.valid=!1},GanttCanvas.prototype.updateValue=function(a,b){var c;c="function"==typeof a.find?a.find("td"):a.getElementsByTagName("td");var d=this.tasks[b],e=c[getColNumber("Start")].childNodes[0].innerHTML,f=c[getColNumber("End")].childNodes[0].innerHTML,g=this,h=g.header,i=h.endDate-h.startDate,j=new Date(e).getTime(),k=new Date(f).getTime(),l=(j-h.startDate.getTime())/i*g.width,m=(k-h.startDate.getTime())/i*g.width-l;d.x=l,d.w=m,this.valid=!1},GanttCanvas.prototype.setHeader=function(a){this.header=a,this.valid=!1},GanttCanvas.prototype.clear=function(){var a=document.getElementById("canvas"),b=parseInt(a.width,10),c=parseInt(a.height,10),d=Math.max(b,this.width),e=Math.max(c,this.height);this.ctx.clearRect(0,0,d,e),this.phaseCTX.clearRect(0,0,this.width,parseInt(this.phaseCanvas.height,10)+1)},GanttCanvas.prototype.drawAxis=function(){var a=this.ctx,b=(this.width,this.height),c=this.yAxis,d=this.xAxis,e=$("#sliderRow").outerHeight(),f=$("table.ganttHeader thead").outerHeight(),g=f+e;if(a.beginPath(),d.length>0)for(var h=0;h<d.length;h++){if(d[h]>this.viewport.x&&d[h]<this.viewport.x+this.viewport.w)var i=Math.round(d[h]-this.viewport.x)-.5;a.moveTo(i,g),a.lineTo(i,b)}if(c.length>0)var h;var j=$(".gantt_row").children(0);a.strokeStyle=j.css("borderRightColor"),a.lineWidth=1,a.stroke()},GanttCanvas.prototype.getTaskSubTasks=function(a){var b=[];getProjectName();for(var c=a.TaskInfo.STUDY_ID,d=getSessionID(),e=ajaxGetAllTaskProps(d),f=ajaxGetSubTaskNames(d,c),g=0;g<f.length;g++){for(var h,i,j=f[g],k={},l=0;l<e.length;l++){var m=e[l];k[m]=formatString(ajaxGetSubTaskProp(d,c,j,m))}var n=this.getRelativeXCord(k.start),o=this.getRelativeXCord(k.end),p=a.fill,q=a.h,r="true"===k.endEarly?!0:!1,s=parseInt(k.level);i={isLocked:!0,dragX:!0,dragY:!1,fill:p,x:n,w:o-n,h:q,id:k.id,name:k.STUDY_ID,studyID:a.studyID,level:s,phase:k.phase,endEarly:r},h=new GanttCanvasTask(i),h.adjustTaskDates(this),b.push(h)}return b},GanttCanvas.prototype.expandRow=function(a,b){null===b.children&&(b.children=this.getTaskSubTasks(b));var c=b.children.length,d=this.yAxis,e=d[1]-d[0],f=$("#ganttTableHeader").height()+$("#gantt_table").height();this.canvasGrid.style.height=Math.max($("#second").height()-16,f)+"px";for(var g,h,i,j,k,l=this.tasks,m=this.phaseSelectors,n=0;n<m.length;n++){g=m[n].linegroup,h=g.lines;for(var o=0;o<h.length;o++){var p=h[o];b.y-p.y<e&&b.y-p.y>0&&(i=p.y+e,j=p,k=o+1),p.y>b.y&&(p.y=p.y+c*e)}for(o=0;c>o;o++){var q={x:j.x,y:i,w:j.w,h:j.h,dragX:!1,dragY:!1},r=new CollisionLine(q);r.fill=j.fill,g.lines.splice(k+o,0,r),i+=e}}var s;for(var t in l)l.hasOwnProperty(t)&&(s=l[t],s.y&&s.y>b.y&&(s.y=s.y+c*e));var u,v;for(o=0;o<b.children.length;o++)v=b.y+e*(o+1),u=b.children[o],u.y=v,u.contains=function(){return!1},this.tasks[u.id]=u,this.master.tasks[u.id]=new GanttMasterTask(u);for(var w=d.length;d.length<w+c;)d.push(d[d.length-1]+e);this.yAxis=d,this.valid=!1},GanttCanvas.prototype.collapseRow=function(a,b,c,d){var e=d.length,f=this.yAxis,g=f[1]-f[0],h=(Number(b)+1).toString(),i=$("#ganttTableHeader").height()+$("#gantt_table").height();this.canvasGrid.style.height=Math.max($("#second").height()-16,i)+"px";var j;a=parseInt(a,10),h=parseInt(h,10);for(var k,l,m=this.phaseSelectors,n=0;n<m.length;n++){k=m[n].linegroup,l=k.lines;for(var o=0;o<l.length;o++){var p=l[o];p.y>c.y&&p.y<c.y+e*g?(l.splice(o,1),o--):p.y>c.y&&(p.y=p.y-e*g)}}for(var q in this.tasks)this.tasks.hasOwnProperty(q)&&(j=this.tasks[q],j.studyID===a&&j.level===h?delete this.tasks[q]:j.y&&j.y>c.y&&(j.y=j.y-e*g));f=f.slice(0,f.length-e),this.yAxis=f,this.valid=!1},GanttCanvas.prototype.zoomOut=function(){if(!(this.header.minCellWidth<10||this.zoom<=.25)){var a=this.canvasGrid,b=parseInt(a.style.width,10);a.style.width=b/2+"px",this.width=b/2,this.zoom=this.zoom/2,this.scaleCanvas(.5),console.time("Header Refresh"),this.header.refresh(!1),console.timeEnd("Header Refresh"),console.time("Task Adjust");for(var c in this.tasks)this.tasks[c].adjustTaskDates(this);console.timeEnd("Task Adjust"),this.valid=!1}},GanttCanvas.prototype.zoomIn=function(){var a=this.canvasGrid,b=parseInt(a.style.width,10);a.style.width=2*b+"px",this.width=2*b,this.zoom=2*this.zoom,this.scaleCanvas(2),console.time("Header Refresh"),this.header.refresh(!0),console.timeEnd("Header Refresh"),console.time("Task Adjust");for(var c in this.tasks)this.tasks[c].adjustTaskDates(this);console.timeEnd("Task Adjust"),this.valid=!1},GanttCanvas.prototype.scaleCanvas=function(a){for(var b=this.shapes,c=0;c<b.length;c++)for(var d=b[c],e=d.length,f=0;e>f;f++){var g=d[f];"function"==typeof g.scalePosition&&g.scalePosition(this)}for(var h in this.tasks)if(this.tasks.hasOwnProperty(h)){var i=this.tasks[h];"function"==typeof i.draw&&i.scalePosition(this)}var j=getMonthXCords(this.header.startDate,this.header.endDate,this.width);this.xAxis=j;var k=this.tasks;for(var h in k)if(k.hasOwnProperty(h)){var i=k[h];"function"==typeof i.setPhaseLinePosition&&i.setPhaseLinePosition(this)}var l=$("#second").scrollLeft();$("#second").scrollLeft(l*a)},GanttCanvas.prototype.lockTask=function(){var a=this.selection[0];a&&(a.lockTask(),this.selection[0]=null,this.valid=!1)},GanttCanvas.prototype.unlockTask=function(){var a=this.selection[0];a&&(a.unlockTask(),this.valid=!1)},GanttCanvas.prototype.deleteItem=function(a){null!=a&&"undefined"!=typeof a&&void 0!==a&&a.deleteItem(this)},GanttCanvas.prototype.addNewTask=function(a,b,c,d,e){var f=new GanttCanvasTask({});for(var g in a)a.hasOwnProperty(g)&&(f[g]=a[g]);var h=this.getRelativeXCord(d),i=this.getRelativeXCord(e);f.x=h,f.w=i-h;var j=this.yAxis,k=j[1]-j[0],l=geLastRow(),m=l.getElementsByClassName("staticText")[0].innerHTML,n=m.split(".");n[0]=(parseInt(n[0],10)-1).toString(),m=n.join("."),f.y=this.tasks[m].y+k,f.id=b,f.name=c,f.fill=hex2rgb("#4D4D4D",.5),this.tasks[b]=f;var o=j[j.length-1]+k;j.push(o),this.yAxis=j,this.valid=!1},GanttCanvas.prototype.removeTasks=function(a){function b(a){var b,c=[],d=h.tasks[a].y;for(var e in h.tasks)h.tasks.hasOwnProperty(e)&&(b=h.tasks[e],b.y>d&&c.push(b));return c}for(var c,d,e,f,g=a.sort(),h=this,i=this.yAxis,j=i[1]-i[0],k=0;k<g.length;k++){c=g[k],d=b(c),f=h.tasks[c],h.deleteItem(f);for(var l=0;l<d.length;l++)e=d[l],e.y=e.y-j;i=i.slice(0,i.length-1),h.yAxis=i}},GanttCanvas.prototype.shiftTasksUp=function(a){function b(a){var b=i.tasks[a],c=a.split("."),d=c[0],e=c[1],f=c[2],g=$('tr.gantt_row[study="'+d+'"][level="'+e+'"][levelElement="'+f+'"]');g.get(0).rowIndex-2;for(var h,j=i.yAxis,k=j[1]-j[0],l=0;l<j.length;l++)if(b.y-j[l]<k){h=l;break}var m,n,o=1/0;for(var p in i.tasks)i.tasks.hasOwnProperty(p)&&(n=i.tasks[p],n.y<b.y&&b.y-n.y<o&&(m=n,o=b.y-n.y));return m}for(var c,d,e,f,g,h=a.sort(function(a,b){return a-b}),i=this,j=0;j<h.length;j++)c=h[j],e=i.tasks[c],j>0?(d=h[j-1],parseInt(c,10)!==parseInt(d,10)+1&&(f=b(c))):f=b(c),g=e.y,e.y=f.y,f.y=g;i.valid=!1},GanttCanvas.prototype.shiftTasksDown=function(a){function b(a){var b,c,d=h.tasks[a],e=1/0;for(var f in h.tasks)h.tasks.hasOwnProperty(f)&&(c=h.tasks[f],c.y>d.y&&c.y-d.y<e&&(e=c.y-d.y,b=c));return b}var c=a.sort(function(a,b){return b-a});c.reverse();for(var d,e,f,g,h=this,i=0;i<c.length;i++)d=c[i],e=h.tasks[d],f=b(d),"undefined"!=typeof f&&(g=e.y,e.y=f.y,f.y=g);h.valid=!1},GanttCanvas.prototype.toggleRowHighlight=function(a,b){if(b){var c=this.tasks[a],d=this.yAxis[1]-this.yAxis[0],e=Math.floor(c.y/d)*d+this.yAxis[0]%d,f=this.canvas.width,g="rgba(102, 153, 204, 0.21)",h={x:0,y:e,w:f,h:d,dragX:!1,dragY:!1,highlightSelected:!1,fill:g},i=new Shape(h);i.draw=function(a,b){var c=translateCoords(this,b);a.fillStyle=this.fill,a.fillRect(this.x,c.y,this.w,this.h)},this.highlightBars[a]=i,this.tasks[a].hBar=i}else delete this.highlightBars[a];this.valid=!1},GanttCanvas.prototype.resizeCanvas=function(a){if(a){var b,c,d,e,f,g=50;b=$(".splitterWrapper"),f=$(".splitterContainer"),e=$("#vSplitBar"),c=$("#first"),d=$("#second");var h=b.outerWidth(),i=f.height(),j=Math.min(h*g/100-e.width()-16,$("#gantt_table").width());c.width(j).css({left:0}),e.css({left:c.outerWidth()}),d.width(h-c.width()-e.width()).css({left:c.outerWidth(!0)+e.width()}),c.height(i),d.height(i),d.css("overflow-y","auto").scroll(function(){c.scrollTop(d.scrollTop())})}},GanttCanvas.prototype.draw=function(){if(this.isInitialized||(this.resizeCanvas(!1),this.isInitialized=!0),!this.valid){var a=this.ctx,b=this.shapes;this.clear(),this.displayAxis&&this.drawAxis(),this.header;for(var c in this.highlightBars)if(this.highlightBars.hasOwnProperty(c)){var d=this.highlightBars[c];d.draw(a,this)}for(var e in this.tasks)if(this.tasks.hasOwnProperty(e)){var f=this.tasks[e];"function"==typeof f.draw&&f.draw(a,this)}if(null!==this.selection[0]){a.strokeStyle=this.selectionColor,a.lineWidth=this.selectionWidth;var g=this.selection[0];"function"==typeof g.drawSelected&&g.drawSelected(a,this)}for(var h=0;h<b.length;h++)for(var i=b[h],j=i.length,k=0;j>k;k++){var l=i[k];l.draw(a,this)}var m=this.getRelativeXCord(new Date),n=translateCoords({x:m,y:0},this);a.beginPath(),a.strokeStyle="#000066",a.lineWidth=4,a.dashedLine(n.x,this.header.h,n.x,this.canvas.height,5),a.stroke(),this.phaseCTX.fillStyle="#000066",star(this.phaseCTX,n.x,15,10,5,.5),this.valid=!0,this.oldWidth=this.width;var o=$("#ganttHeaderTable");a.clearRect(0,0,o.width(),o.height()+26)}},GanttCanvas.prototype.getMouse=function(a){var b,c,d,e,f=this.canvas,g=0,h=0;if("undefined"!==f.offsetParent)do g+=f.offsetLeft,h+=f.offsetTop;while(f=f.offsetParent);g+=this.stylePaddingLeft+this.styleBorderLeft+this.htmlLeft,h+=this.stylePaddingTop+this.styleBorderTop+this.htmlTop,b=this.parent.scrollLeft(),c=this.parent.scrollTop();var i=document.getElementById("pageContent").scrollTop,j=document.getElementById("pageContent").scrollLeft,k=document.getElementById("ag_RightPane");return k&&(i+=k.scrollTop,j+=k.scrollLeft),d=a.pageX-g+b+j,e=a.pageY-h+c+i,{x:d,y:e}},GanttCanvas.prototype.addPhaseGroup=function(a,b){var c,d,e,f;this.groupCounter||(this.groupCounter=[!0]);for(var g=1;void 0!==this.groupCounter[g];)g++;this.groupCounter[g]=!0,c=a.x;var h=$("tr.gantt_row").filter(function(){return"none"!==$(this).css("display")}).length;f=[];var i=$("table.gantt thead:first").outerHeight(),j=$("#sliderRow").outerHeight()+i+1,k=$(".gantt_row:first");$("#gantt_table");var l=k.outerHeight(!0)+parseInt(k.css("border"),10)+parseInt(k.css("padding-top"),10)+parseInt(k.css("padding-bottom"),10),m=4,n=10,o=20,p=$("#first").outerHeight(),q=j-1,r="#888888",s="Group "+g;l++;for(var t=Math.floor(j),u=0;h>u;u++)t=u*l,f.push(q+t+.5);var v={};v[a.name]=a,v[b.name]=b;var w={dragX:!0,dragY:!1,numLines:h,footerText:"Date: ",highlightSelected:!0,x:c,y:j,w:m,h:p-l,fill:r};e=new LineGroup(w),w.dragX=!1,w.highlightSelected=!1,w.h=l;for(var x=0;h>x;x++)w.y=f[x],y=new CollisionLine(w),y.contains=function(){return!1},y.linegroup=e,e.addLine(y);w.dragX=!1,w.y=f[f.length-1],w.h=this.height-f[f.length-1];var y=new CollisionLine(w);y.highlightSelected=!1,e.addLine(y);var z={dragX:!0,dragY:!1,numLines:h,highlightSelected:!0,x:c,y:j-o-2.5,w:n+5,h:o,name:s,text:s,fill:r,selectors:v,linegroup:e,groupNumber:g};d=new PhaseGroup(z),this.removeShape(a),this.removeShape(a.linegroup),this.removeShape(b),this.removeShape(b.linegroup),this.phaseSelectors[a.name]=void 0,this.phaseSelectors[b.name]=void 0,this.addShape(d,2),this.addShape(e,2),this.phaseSelectors[s]=d,this.valid=!1
},GanttCanvas.prototype.updatePhaseDate=function(a,b){for(var c=this.getPhases(),d=this.getPhaseSelectors(),e=[],f=0;f<d.length;f++)d[f].isGroup===!0&&e.push(d[f]);for(var g=c[a],h=0;h<e.length;h++){var i=e[h],j=i.selectors;for(var k in j)k===a&&(g=j[k],i.removeSelector(j[k],this))}var l=new Date(b);g.moveToDate(l,this),g.mouseUpEvent(this),this.valid=!1},GanttCanvas.prototype.toggleToolTips=function(a){this.displayToolTips=a},GanttCanvas.prototype.setDateSnap=function(a){this.snapToDate=a};var pressed=!1,headerCell=void 0,bodyCell=void 0,startX,startWidth,bodyStartWidth,colNum,minWidths={};$.fn.focusEnd=function(){$(this).focus();var a=$("<span />").appendTo($(this)),b=a.get(0),c=null,d=null;return document.selection?(c=document.body.createTextRange(),c.moveToElementText(b),c.select()):window.getSelection&&(c=document.createRange(),c.selectNode(b),d=window.getSelection(),d.removeAllRanges(),d.addRange(c)),a.remove(),this},DateHeaderBar.prototype.init=function(){function a(a,b){for(var c=new Date(l);c.getTime()<=m;)a(c);for(c=new Date(l);c.getTime()<=m;)b(c)}function b(a,b,c,d){var e=$("<th></th>").html(a).attr("colSpan",b);return d&&(e.css("min-width",d-1+"px"),e.css("width",d-1+"px"),e.css("max-width",d-1+"px")),c&&e.addClass(c),e}var c=document.getElementById("canvasGrid"),d=parseInt(c.style.width,10);getYearXCords(this.startDate,this.endDate,d);var e=getMonthXCords(this.startDate,this.endDate,d);this.master.xAxis=e,this.startDate.getFullYear(),Date.monthAbbreviations,this.startDate.getMonth();var f=document.getElementById("headerWrapper"),g=document.createElement("table");g.className="ganttHeaderTable",g.id="ganttHeaderTable";var h=document.createElement("thead"),i=document.createElement("tr"),j=document.createElement("tr"),k=this.master.zoom,l=this.master.start,m=this.master.end,n=$("<tr></tr>"),o=$("<tr></tr>");1===k&&a(function(a){var c=a.getTime();a.setFullYear(a.getFullYear()+1);var d=parseInt((a.getTime()-c)/864e5);n.append(b(new Date(c).format("yyyy"),12,!1,d))},function(a){var c=a.getTime();a.setMonth(a.getMonth()+1);var d=parseInt((a.getTime()-c)/864e5);o.append(b(new Date(c).format("MM"),1,null,d))}),i=n.get(0),j=o.get(0),h.appendChild(i),h.appendChild(j),g.appendChild(h),f.appendChild(g),$(f).width($("#canvas").width());var p=$("#second");p.scroll(function(){f.scrollLeft=p.scrollLeft()})},DateHeaderBar.prototype.refresh=function(a){var b=a?2:.5,c=document.getElementById("canvasGrid"),d=parseFloat(c.style.width,10),e=document.getElementById("ganttHeaderTable"),f=e.childNodes[0].childNodes;this.minCellWidth=parseFloat(f[0].childNodes[0].style.width,10)*b;for(var g=this.master.zoom,h=this.master,i=this.master.start.getFullYear(),j=0;j<f.length;j++)for(var k=f[j],l=k.childNodes,m=0;m<l.length;m++){var n=l[m],o=parseFloat(n.style.width,10);a?o+=.5:o-=1;var p=Math.floor(o*b);this.minCellWidth=Math.min(this.minCellWidth,p);var q,r;if(0===j)q=h.getRelativeXCord(new Date(parseInt(n.innerHTML,10),0,1,0,0,0,0)),r=h.getRelativeXCord(new Date(parseInt(n.innerHTML,10)+1,0,1,0,0,0,0)),p=Math.ceil(r-q)-1;else if(1===j){var s;s=-1!==n.innerHTML.indexOf("Q")?3*parseInt(n.innerHTML.replace("Q",""),10)-1:-1!==n.innerHTML.indexOf("S")?3*parseInt(n.innerHTML.replace("S",""),10):parseInt(n.innerHTML,10),2>g&&g>.5?(n.innerHTML=10>s?"0"+s:s,n.style.display="table-cell",n.setAttribute("colSpan",1),q=h.getRelativeXCord(new Date(i,s-1,1,0,0,0,0)),r=h.getRelativeXCord(new Date(i,s,1,0,0,0,0)),p=Math.ceil(r-q)-1,0===s%12&&i++):1>g&&g>.25?(n.style.display="none",2===s%3&&(i++,q=h.getRelativeXCord(new Date(i,0,1,0,0,0,0)),r=h.getRelativeXCord(new Date(i,3,1,0,0,0,0)),p=Math.ceil(r-q)-1,n.innerHTML="Q"+Math.ceil(s/3),n.style.display="table-cell",n.setAttribute("colSpan",3))):.5>g&&g>.125&&(n.style.display="none",3===s%6&&(n.innerHTML="S"+Math.ceil(s/6),n.style.display="table-cell",n.setAttribute("colSpan",6),3===s?(q=h.getRelativeXCord(new Date(i,0,1,0,0,0,0)),r=h.getRelativeXCord(new Date(i,6,1,0,0,0,0))):(q=h.getRelativeXCord(new Date(i,6,1,0,0,0,0)),r=h.getRelativeXCord(new Date(i+1,0,1,0,0,0,0)),i++),p=Math.ceil(r-q)-1))}setCellWidth(n,p)}var t=getMonthXCords(this.startDate,this.endDate,d,g);this.master.xAxis=t},DateHeaderBar.prototype.draw=function(a,b){var c=b.getRelativeXCord(new Date),d=translateCoords({x:c,y:0},b);a.beginPath(),a.strokeStyle="#009999",a.lineWidth=4,a.dashedLine(d.x,this.h,d.x,b.canvas.height,5),a.stroke(),b.valid=!1},DateHeaderBar.prototype.drawHeader=function(a,b){a.clearRect(this.x,this.y,this.w,this.h),this.w=b.width,a.strokeStyle="#000000",a.lineWidth=1,a.beginPath(),a.rect(0,-0.5,b.canvas.width,this.h),a.moveTo(0,this.h/2+.5),a.lineTo(b.canvas.width,this.h/2+.5),a.stroke(),drawYearBar(a,b.start,b.end,b.canvas.width,this.h),drawMonthBar(a,b.start,b.end,b.canvas.width,this.h)},DateHeaderBar.prototype.drawHeaderTitle=function(a,b){a.clearRect(this.x,this.y,this.w,this.h),this.w=b.width;var c=this.w/this.numMonths,d=12*c,e=this.startDate.getFullYear(),f=["Jan.","Feb.","Mar.","Apr.","May","June","July","Aug.","Sep.","Oct.","Nov.","Dec."],g=this.startDate.getMonth(),h=31;3===g||5===g||8===g||10===g?h=30:1===g&&(h=28,0===Math.abs(this.startDate.getFullYear()-2e3)%4&&(h=29));var i=this.startDate.getDate(),j=h-i;a.strokeStyle="#000000",a.lineWidth=1,a.beginPath(),a.moveTo(m,0),a.lineTo(this.w,0),a.font="20px 'Tahoma', 'Bitstream Vera Sans', Verdana, Helvetica, sans-serif",a.fillStyle="#000000";var k,l=0;l=b.parent.scrollTop();for(var m=0;m<this.w;m+=d){if(a.moveTo(m,0+l),a.lineTo(m,this.h/2+l),0===m){var n=c*(12-g)-i/h*c;k=m+n/2,m=m+n-d}else k=m+d<=this.w?m+d/2:m+(this.w-m)/2;a.fillText(e,k,this.h/4+5+l),e++}for(a.moveTo(0,this.h/2+l),a.lineTo(this.w,this.h/2+l),a.font="10px 'Tahoma', 'Bitstream Vera Sans', Verdana, Helvetica, sans-serif",m=0;m<=this.w;m+=c){a.moveTo(m,this.h/2+l),a.lineTo(m,this.h+l),0===m?(k=m+c*(j/h)/2,m=m+c*(j/h)-c):k=m+c<=this.w?m+c/2:m+(this.w-m)/2;var o=f[g%12];50>c?(a.save(),a.translate(k,.75*this.h+l),a.rotate(-Math.PI/2),a.textAlign="center",a.fillText(o,0,2),a.restore()):k>10&&(a.textAlign="center",a.font="16px 'Tahoma', 'Bitstream Vera Sans', Verdana, Helvetica, sans-serif",a.fillText(o,k,.9*this.h)),g++,Math.ceil(m+c)>=this.w&&(m=Math.ceil(m))}a.moveTo(0,this.h+l),a.lineTo(this.w,this.h+l),a.closePath(),a.stroke(),a.moveTo(0,this.h+l),a.fillStyle="#FAFAFB";var p=getComputedStyle(document.getElementById("sliderRow"),null).height;p=Number(p.substring(0,p.indexOf("px"))),a.fillRect(0,this.h+l,this.w,p),a.fill()},GanttGrid.prototype.expandRow=function(a,b){var c=(Number(b)+1).toString(),d=$('tr[study="'+a+'"][level="'+c+'"]');return d.css("display","table-row"),d},GanttGrid.prototype.collapseRow=function(a,b){var c=(Number(b)+1).toString(),d=$('tr[study="'+a+'"][level="'+c+'"]');d.css("display","none");var e=(Number(b)+2).toString(),f=$('tr[study="'+a+'"][level="'+e+'"]');return f.length>0&&this.collapseRow(a,c),d},GanttGrid.prototype.updateDateValues=function(a,b,c,d){var e=a.split("."),f=e[0],g=e[1],h=e[2],i=document.querySelector('tr.gantt_row[level="'+g+'"][study="'+f+'"][levelelement="'+h+'"]');if(i){var j=getColNumber("Start"),k=getColNumber("End");i.childNodes[j].childNodes[0].innerHTML=c,i.childNodes[k].childNodes[0].innerHTML=d}},GanttGrid.prototype.addTask=function(){var a,b=$("#gantt_table"),c=b.find("tbody"),d=geLastRow(),e=d.getElementsByClassName("staticText")[0].innerHTML,f=getTempalteRow(),g=f.cloneNode(!0);a=f.getElementsByClassName("staticText")[0].innerHTML;var h=incrementStudyID(e);g.childNodes[0].childNodes[0].setAttribute("id","Box"+h),g.childNodes[0].childNodes[0].setAttribute("name","Box"+h);for(var i=getColNumber("Start"),j=getColNumber("End"),k=getColNumber("PROTOCOL NUMBER"),l=new Date,m=new Date(l.getFullYear(),0,1),n=new Date(l.getFullYear()+1,0,1),o=g.childNodes,p=2;p<o.length;p++){var q=o[p].childNodes[0];q.innerHTML=p!==i&&p!==j?p===k?"New-Protocol":"":p===i?m.format("MM/dd/yyyy"):n.format("MM/dd/yyyy")}var r=getRowName(this.master.canvas);g.childNodes[2].childNodes[0].innerHTML=r;var s=document.createElement("div");s.className="staticText",s.innerHTML=h;for(var t=g.childNodes[1];t.firstChild;)t.removeChild(t.firstChild);t.appendChild(s),g.setAttribute("study",h);var u=c.get(0),v=getFirstTemplateRow();return u.insertBefore(g,v),[a,h,r,m,n]},GanttGrid.prototype.copyTask=function(a){var b=$("#gantt_table"),c=b.find("tbody"),d=geLastRow(),e=d.getElementsByClassName("staticText")[0].innerHTML,f=incrementStudyID(e),g=a.cloneNode(!0),h=a.getElementsByClassName("staticText")[0].innerHTML,i=getRowName(this.master.canvas),j=getColNumber("PROTOCOL NUMBER"),k=i.replace("NewStudy",""),l=g.childNodes[0].childNodes[0];l.setAttribute("id","Box"+f),l.setAttribute("name","Box"+f),l.checked=!1,g.className="gantt_row",g.setAttribute("study",f),g.getElementsByClassName("staticText")[0].innerHTML=f,g.childNodes[2].childNodes[0].innerHTML=i,g.childNodes[j].childNodes[0].innerHTML+="_Copy"+k;var m=c.get(0);return m.insertBefore(g,getFirstTemplateRow()),[h,f,i]},GanttGrid.prototype.getCheckedRows=function(){var a,b,c=$(".gantt_row"),d=c.filter(function(){return a=$(this).find("input"),b=a.get(0),0===a.length?!1:!b.disabled&&b.checked});return d},GanttGrid.prototype.removeTasks=function(a){for(var b,c=0;c<a.length;c++)hasClass(a[c],"highlighted")&&(b=a[c].getElementsByClassName("staticText")[0].innerHTML,this.master.canvas.toggleRowHighlight(b,!1)),$(a[c]).remove()},GanttGrid.prototype.shiftTasksUp=function(a){for(var b,c,d,e,f,g=0;g<a.length;g++){b=a[g],c=parseInt(b.getAttribute("study"),10),d=parseInt(b.getAttribute("level"),10),e=parseInt(b.getAttribute("levelElement"),10),0===e?(c--,f=$('tr.gantt_row[study="'+c+'"][level="0"]')):(e--,f=$('tr.gantt_row[study="'+c+'"][level="'+d+'"][levelElement="'+e+'"]')),f=f.get(0);for(var h=b.parentNode,i=b.previousSibling;parseInt(i.getAttribute("level"),10)!==d;)i=i.previousSibling;i&&(h.removeChild(b),h.insertBefore(b,i))}},GanttGrid.prototype.shiftTasksDown=function(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d],c.push(b);for(var e=c.reverse(),f=0;f<e.length;f++){b=e[f];var g=getNextSibling(b),h=b.parentNode;if(h.removeChild(b),!g.nextSibling)return h.appendChild(b),void 0;h.insertBefore(b,g.nextSibling)}},GanttMaster.prototype.addTask=function(a){var b,c,d=new GanttMasterTask(a);if(a.subtasks)for(var e=a.subtasks.length;e--;)b=new GanttMasterTask(a.subtasks[e]),c=a.subtasks[e],d.addSubTask(b);var f=a.id.toString();this.tasks[f]=d},Shape.prototype={draw:function(a){a.fillStyle=this.fill,a.fillRect(this.x,this.y,this.w,this.h)},contains:function(a,b){return this.x-this.selectionWidth<=a&&this.x+this.w+this.selectionWidth>=a&&this.y<=b&&this.y+this.h>=b},move:function(a,b){var c=a.x-b.dragoffx-b.selection[0].x,d=a.y-b.dragoffy-b.selection[0].y;if(b.selection[0].dragX&&(b.selection[0].x+=c),b.selection[0].dragY&&(b.selection.y+=d),null!==b.selection[0].points)for(var e=b.selection[0].points,f=0;f<e.length;f++)b.selection[0].dragX&&(e[f].x+=c),b.selection[0].dragY&&(e[f].y+=d)},drawSelected:function(a){this.highlightSelected&&a.strokeRect(this.x,this.y,this.w,this.h)},rotate:function(a){if(null!==this.points){var b=calcDiemnsions(this),c=b.center;if(0!==this.angle){for(var d,e,f,g,h=this.points,i=0;i<h.length;i++)d=h[i].x-c.x,e=h[i].y-c.y,f=d*Math.cos(a*Math.PI/180)-e*Math.sin(a*Math.PI/180)+c.x,g=e*Math.cos(a*Math.PI/180)+d*Math.sin(a*Math.PI/180)+c.y,h[i]={x:f,y:g};this.points=h}b=calcDiemnsions(this),this.x=b.x,this.y=b.y,this.w=b.w,this.h=b.h}},deleteItem:function(a){for(var b=a.shapes,c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.length;e++){var f=d[e];if(this===f){d.splice(e,1),a.valid=!1;break}}},moveTo:function(a,b){var c=a||0,d=b||0;this.x=c,this.y=d}},Rectangle.prototype=inheritFrom(Rectangle,Shape),Box.prototype=inheritFrom(Box,Rectangle),Box.prototype.draw=function(a,b){var c=translateCoords(this,b);a.fillStyle=this.fill,a.fillRect(c.x,c.y,b.selBoxSize,b.selBoxSize)},TextBox.prototype=inheritFrom(TextBox,Shape),TextBox.prototype.draw=function(a,b){a.font=this.fontsize.toString()+"px "+this.font,a.textAlign=this.textAlign,a.fillStyle=this.fontcolor,a.beginPath(),a.fillText(b.text,this.x,this.y),a.fill()},LineGroup.prototype=inheritFrom(LineGroup,Shape),LineGroup.prototype.draw=function(a,b){for(var c=0;c<this.lines.length;c++)this.lines[c].draw(a,b);var d,e=hex2rgb(this.fill,1),f=e.match(/\d+/g);d=this.isLocked?"rgba("+f[0]+","+f[1]+","+f[2]+",0.4)":"rgba("+f[0]+","+f[1]+","+f[2]+",1)",a.strokeStyle=d,a.lineWidth=3;var g=!0;a.beginPath();for(var h=0;h<this.lines.length-1;h++){var i,j,k=this.lines[h+1].y;this.lines[h].x!==this.lines[h+1].x&&(this.lines[h].x>this.lines[h+1].x?(i=this.lines[h].x+this.lines[h].w-this.lines[h].w/2,j=this.lines[h+1].x-this.lines[h].w/2):(i=this.lines[h].x-this.lines[h].w/2,j=this.lines[h+1].x+this.lines[h+1].w-this.lines[h].w/2),g?k++:k--,g=!g,i-=b.viewport.x,j-=b.viewport.x,k-=b.viewport.y,a.moveTo(i,k),a.lineTo(j,k))}a.closePath(),a.stroke()},LineGroup.prototype.contains=function(a,b){for(var c=0;c<this.lines.length;c++)if(this.lines[c].contains(a,b))return!0;return!1},LineGroup.prototype.move=function(){},LineGroup.prototype.addLine=function(a){this.lines.push(a)},LineGroupSelector.prototype=inheritFrom(LineGroupSelector,Shape),LineGroupSelector.prototype.contains=function(a,b){return this.containsSelector(a,b)?!0:this.textBox?this.textBox.contains(a,b):!1},LineGroupSelector.prototype.containsSelector=function(a,b){var c=$("#second").scrollTop();return b-=c,this.x-this.w/2-this.selectionWidth<=a&&this.x+this.w/2+this.selectionWidth>=a&&this.y<=b&&this.y+this.h>=b?!0:!1},LineGroupSelector.prototype.move=function(a,b){var c=a.x-b.dragoffx-this.x;if(this.dragX){if(this.x<=10&&0>c||this.x+this.w>=parseInt(b.canvasGrid.style.width,10)&&c>0)return;var d;if(Math.abs(this.x-this.w/2-b.viewport.x)<20&&0>c)d=this.x>=100?100:this.x,document.getElementById("second").scrollLeft+=-d;else if(Math.abs(this.x+this.w/2-(b.viewport.x+b.viewport.w))<=36&&c>0){var e=parseInt(b.canvasGrid.style.width,10);d=e-(this.x+this.w/2)>=100?100:e-(this.x+this.w/2),document.getElementById("second").scrollLeft+=d}if(this.x=a.x-b.dragoffx,this.textBox&&(this.textBox.x+=c),this.linegroup){var f=this.linegroup;f.x+=c;for(var g,h=0;h<f.lines.length;h++)g=f.lines[h],g.x=g.x+c}}b.selection[0].dragY&&(b.selection[0].y=a.y-b.dragoffy)},LineGroupSelector.prototype.moveToDate=function(a,b){var c=b.getRelativeXCord(a),d=c-this.x;if(this.x+=d,this.textBox&&(this.textBox.x+=d),this.linegroup){var e=this.linegroup;e.x+=d;for(var f,g=0;g<e.lines.length;g++)f=e.lines[g],f.x=f.x+d}b.valid=!1},LineGroupSelector.prototype.mouseUpEvent=function(a){var b=this.alignToMonth(a);this.linegroup.x=this.x,this.setPhaseLinePosition(a),this.ajaxUpdate(a),this.updateDateInputField(a,b)},LineGroupSelector.prototype.updateDateInputField=function(a,b){var c=this.name.replace(" ","_"),d=$("#phaseDate_"+c);d.length>0&&d.val(b.format("MM/dd/yyyy"))},LineGroupSelector.prototype.setPhaseLinePosition=function(a){var b=a.tasks;for(var c in b){var d=b[c];"function"==typeof d.setPhaseLinePosition&&d.setPhaseLinePosition(a)}a.valid=!1},LineGroupSelector.prototype.ajaxUpdate=function(a){var b=a.header.endDate-a.header.startDate,c=a.header.startDate.getTime()+Math.round(this.x/a.width*b),d=new Date(c),e=d.format("MMMM dd yyyy");ajaxUpdateProjectProp("phaseDate",this.name,e)},LineGroupSelector.prototype.deleteItem=function(a){for(var b=a.shapes,c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.length;e++){var f=d[e];if(this===f&&!this.isLocked){if(d.splice(e,1),a.shapes[c]=d,this.textBox&&this.textBox.deleteItem(a),this.linegroup.lines){for(var g,h=this.linegroup.lines,i=0;i<h.length;i++)g=h[i],g.deleteItem(a);this.linegroup.deleteItem(a)}a.selection[0]===this&&(a.selection[0]=null),a.colorIndex--,a.valid=!1;break}}ajaxUpdateProjectProp("deletePhase",this.name,"prop")},LineGroupSelector.prototype.lockTask=function(){this.dragX=!1,this.dragY=!1,this.isLocked=!0,this.linegroup.isLocked=!0;for(var a=this.linegroup.lines,b=0;b<a.length;b++)a[b].dragX=!1,a[b].dragY=!1,a[b].isLocked=!0},LineGroupSelector.prototype.unlockTask=function(){this.dragX=!0,this.dragY=!1,this.isLocked=!1,this.linegroup.isLocked=!1;for(var a=this.linegroup.lines,b=0;b<a.length;b++)a[b].dragX=!0,a[b].dragY=!1,a[b].isLocked=!1},LineGroupSelector.prototype.alignToMonth=function(a){var b=a.getDateFromXCord(this.x),c=0;if("month"===a.snapToDate){b=snapToMonth(b);var d=a.getRelativeXCord(b);c=d-this.x}this.x=this.x+c,this.textBox&&(this.textBox.x+=c);for(var e=this.linegroup.lines,f=0;f<e.length;f++)e[f].x=e[f].x+c;var g=a.getPhaseSelectors();for(var h in g)if(g[h].x===this.x&&g[h]!=this){this.hasOwnProperty("isGroup")&&g[h].hasOwnProperty("isGroup")?this.groupNumber<g[h].groupNumber?this.mergeGroup(g[h],a):g[h].mergeGroup(this,a):this.hasOwnProperty("isGroup")?this.addSelector(g[h],a):g[h].hasOwnProperty("isGroup")?g[h].addSelector(this,a):a.addPhaseGroup(this,g[h]);break}return b},LineGroupSelector.prototype.scalePosition=function(a){var b=Math.round(a.width*(this.x/a.oldWidth)),c=b-this.x;this.x=b,this.linegroup.x=b,this.textBox&&(this.textBox.x+=c);for(var d=this.linegroup.lines,e=0;e<d.length;e++)d[e].x+=c},LineGroupSelector.prototype.draw=function(a,b){var c,d=translateCoords(this,b),e=this.fill.match(/\d+/g);c=this.isLocked?"rgba("+e[0]+","+e[1]+","+e[2]+",0.25)":"rgba("+e[0]+","+e[1]+","+e[2]+",1)",this.fill=c;var f=d.x-this.w/2,g=d.y,h=this.w,i=this.h,j="#E6E6E6",k="#CFCFCF";this.textBox&&(this.name,this.name=this.textBox.text,this.textBox.draw(a,b));var l=b.phaseCanvas.getContext("2d"),m=parseInt(b.phaseCanvas.parentNode.style.top,10);g=this.y-m,l.beginPath(),l.moveTo(f,g),l.lineTo(f,g+i*(2/3)),l.lineTo(f+h/2,g+i),l.lineTo(f+h,g+i*(2/3)),l.lineTo(f+h,g),l.closePath();var n=l.createLinearGradient(0,0,0,i);n.addColorStop(0,j),n.addColorStop(1,k),l.lineWidth=4,l.lineJoin="round",l.strokeStyle=this.fill,l.stroke(),l.fillStyle=n,l.fill()},LineGroupSelector.prototype.drawSelected=function(a,b){var c=translateCoords(this,b),d=c.x-this.w/2,e=c.y,f=this.w;this.h;var g=b.phaseCTX,h=2*parseInt(b.phaseCanvas.height,10),i=parseInt(b.canvas.height,10),j=parseInt(b.phaseCanvas.parentNode.style.top,10);e=this.y-j,g.lineWidth=2,a.lineWidth=2;var k=2*f;roundRect(g,d-f/2,3,k,h,5,"rgba(127,157,185,0.5)","#7F9DB9"),roundRect(a,d-f/2,3,k,i,5,"rgba(127,157,185,0.5)","#7F9DB9")},LineGroupSelector.prototype.createContextMenu=function(a){var b,c,d,e,f=this,b=createDefaultContextMenu(a),c=b.find("ul");return d=$('<li id="lockButton"></li>'),this.isLocked===!0?(d.append($('<a href="#">Unlock</a>')),d.bind("click",function(){$(".splitterWrapper").trigger("unlockTask.gantt")})):(d.append($('<a href="#">Lock</a>')),d.bind("click",function(){$(".splitterWrapper").trigger("lockTask.gantt")})),c.append(d),e=$('<li id="deleteButton"><a href="#">Delete</a></li>'),e.bind("click",function(){$(".splitterWrapper").trigger("delete.gantt",f)}),c.append(e),c.append('<div class="context-menu-separator">&nbsp</div>'),$.each(a.getPhaseSelectors(),function(b,d){if(d.hasOwnProperty("isGroup")){var e=document.createElement("li");e.innerHTML="Add to "+d.name,$(e).on("click",function(){d.addSelector(f,a)}),c.append(e)}}),b},LineGroupSelector.prototype.updateName=function(a,b){var c=this.name,d=b.tasks;for(var e in d){var f=d[e];f.phase==this.name&&(f.phase=a)}delete b.phaseSelectors[this.name],b.phaseSelectors[a]=this,this.name=a,this.text=a,ajaxUpdateProjectProp("deletePhase",c,"prop"),this.ajaxUpdate(b),b.valid=!1},LineGroupSelector.prototype.returnSelected=function(a,b){return this.containsSelector(a,b)?this:this.textBox},EditableTextBox.prototype=inheritFrom(EditableTextBox,TextBox),EditableTextBox.prototype.draw=function(a,b){var c=translateCoords(this,b),d=c.x,e=c.y;this.w,this.h;var f=b.phaseCTX,g=parseInt(b.phaseCanvas.parentNode.style.top,10);e=this.y-g,f.font="11px Verdana, Arial, Helvetica, sans-serif",f.textAlign=this.textAlign,f.fillStyle="#000000",f.beginPath(),f.fillText(this.text,d,e+.5*this.h),f.fill()},EditableTextBox.prototype.drawSelected=function(a,b){if(this.highlightSelected){var c=translateCoords(this,b);a.strokeRect(c.x,c.y,this.w,this.h)}},EditableTextBox.prototype.dbclickAction=function(a){if(this.editableName){document.getElementsByClassName("canvas")[0];var b=$("canvas:last"),c=b.offset().top+this.y-2,d=Math.max(this.w+this.fontsize,25),e=this.w<d?d-this.w:0,f=b.offset().left+this.x-e,g=$("<input type='text' class='selector_head' />");$("#second").append(g),g.attr("name","S_"+this.name).attr("value",this.text).attr("font-size",this.fontsize.toString()+"px "),g.css("z-index",1).css("position","absolute"),g.offset({top:c,left:f}),g.width(d),g.height(this.fontsize),g.focus();var h=this;g.bind("blur",function(){var b=g.val();h.updatePhaseName(h.name,b,a),g.remove()}),g.keypress(function(b){13===b.which&&(b.preventDefault(),$(this).trigger("blur"),a.valid=!1,$("#gantt_canvas").trigger("click"))})}},EditableTextBox.prototype.updatePhaseName=function(a,b,c){var d=calcTextWidth(b,this.fontSize+"px "+this.font),e=d-this.txtWidth;this.x-=e,this.w+=e,this.txtWidth=d,this.name=b,this.text=b,c.getPhases()[a].updateName(b,c),c.valid=!1},CollisionBoxTextBox.prototype=inheritFrom(CollisionBoxTextBox,TextBox),CollisionBoxTextBox.prototype.contains=function(){return!1},CollisionBoxTextBox.prototype.draw=function(a,b){if(!this.widthCalculated){var c=b.gctx,d=2,e=this.x-d-this.w,f=this.y,g=this.h-4,h=e+4,i=f+g,j=this.text[0];c.font=g.toString()+"px sans-serif",c.fillText(j,h,i);var k=c.measureText(j),l=k.width;this.w=l+8,c.clearRect(h,i,l,g),this.widthCalculated=!0}this.drawPointerTXTBox(a,"left"),this.drawPointerTXTBox(a,"right")},CollisionBoxTextBox.prototype.drawPointerTXTBox=function(a,b){if(this.display){var c=2,d=this.parentWidth,e="left"===b?this.x+c+d:this.x-c-this.w,f=this.y,g=this.h-4,h=e+4,i=f+g,j="left"===b?this.text[1]:this.text[0],k=5,l=this.strokeStyle,m=this.fill,n=this.w,o=this.h;a.lineWidth=this.lineWidth,a.beginPath(),a.moveTo(e+k,f),a.lineTo(e+n-k,f),a.quadraticCurveTo(e+n,f,e+n,f+k),a.lineTo(e+n,f+o-k),"left"===b?(a.quadraticCurveTo(e+n,f+o,e+n-k,f+o),a.lineTo(e+k,f+o),a.lineTo(e-c,f+o+5)):"right"===b&&(a.lineTo(e+n+c,f+o+5),a.lineTo(e+n-k,f+o),a.lineTo(e+k,f+o),a.quadraticCurveTo(e,f+o,e,f+o-k)),a.lineTo(e,f+k),a.quadraticCurveTo(e,f,e+k,f),a.closePath(),l&&(a.strokeStyle=l,a.stroke()),m&&(a.fillStyle=m,a.fill()),a.font=g.toString()+"px sans-serif",a.fillStyle="#000000",a.fillText(j,h,i)}},CollisionLine.prototype=inheritFrom(CollisionLine,Shape),CollisionLine.prototype.draw=function(a,b){var c,d=this.x-this.w/2,e=this.y,f=this.fill.match(/\d+/g);c=this.isLocked?"rgba("+f[0]+","+f[1]+","+f[2]+",0.25)":"rgba("+f[0]+","+f[1]+","+f[2]+",1)",this.fill=c,a.fillStyle=this.fill;var g=translateCoords({x:d,y:e},b);a.fillRect(g.x,g.y,this.w,this.h)},CollisionLine.prototype.drawSelected=function(a,b){if(this.highlightSelected&&!this.isLocked){var c=b.selection[0];a.strokeStyle=b.selectionColor,a.lineWidth=b.selectionWidth;var d=translateCoords(c,b);a.strokeRect(d.x,d.y,c.w,c.h)}},CollisionLine.prototype.dbclickAction=function(a){null!==this.linegroup&&(this.x=this.linegroup.x,this.draw(a.ctx,a))},CollisionLine.prototype.alignToMonth=function(a){var b=snapToMonth(a.getDateFromXCord(this.x)),c=a.getRelativeXCord(b),d=c-this.x;this.x=this.x+d-this.w/2},CollisionLine.prototype.mouseUpEvent=function(a){this.alignToMonth(a),a.valid=!1},PhaseGroup.prototype=inheritFrom(PhaseGroup,LineGroupSelector),PhaseGroup.prototype.draw=function(a,b){LineGroupSelector.prototype.draw.call(this,a,b);var c=b.phaseCanvas.getContext("2d"),d=parseInt(b.canvas.height,10);a.lineWidth=1,c.lineWidth=1;var e=this.w,f=translateCoords(this,b).x-this.w/2;roundRect(c,f,5,e,d,5,"rgba(88,88,88,0.25)","rgba(0,0,0,0)"),roundRect(a,f,3,e,d,5,"rgba(88,88,88,0.25)","rgba(0,0,0,0)")},PhaseGroup.prototype.sortSelectors=function(){var a=[];for(var b in this.selectors)this.selectors.hasOwnProperty(b)&&a.push(b);var c=this;return a.sort(function(a,b){return c.selectors[a].name<c.selectors[b].name?-1:1}),a},PhaseGroup.prototype.createToolTip=function(){var a=document.createElement("div"),b=this.sortSelectors();for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];a.innerHTML+='<span style="margin:0;padding:0;display:table-row;"><span style="min-width:10px;display:table-cell;"><svg style="max-height: 10px; max-width:10px; display:inline;" xmlns="http://www.w3.org/2000/svg" version="1.1"><rect width="10" height="10"style="fill:'+this.selectors[d].fill+';stroke-width:1;stroke:rgb(0,0,0)"/></svg></span><span class="st" style="padding-left:5px;display:table-cell;">'+this.selectors[d].name+"</span></span>"}return a.className="popUpInfo",a},PhaseGroup.prototype.showToolTip=function(a,b){this.hasOwnProperty("toolTip")&&$(this.toolTip).remove();var c,d=document.getElementById("canvas"),e=cumulativeOffset(d),f=a.pageX,g=this.createToolTip(b);g.style.visibility="hidden",document.body.appendChild(g);var h=g.offsetHeight;this.divHeight=h,document.body.removeChild(g),c=e.top+this.y,g.style.cssText=";z-index:1;position:absolute;left:"+f+"px;top:"+c+"px;",g.style.display="block",this.toolTip=g,$("#ganttChart").append($(g))},PhaseGroup.prototype.hideToolTip=function(){this.toolTip&&(this.toolTip.style.display="none")},PhaseGroup.prototype.createContextMenu=function(a){var b,c=document.createElement("div"),d=this,e=this.sortSelectors();$.each(e,function(e,f){var g=d.selectors[f];b=document.createElement("li"),b.innerHTML+='<svg style="max-height: 10px; max-width:10px; display:inline;" xmlns="http://www.w3.org/2000/svg" version="1.1"><rect width="10" height="10" style="fill:'+g.fill+';stroke-width:1;stroke:rgb(0,0,0)"/></svg><span style="padding-left:5px;">Remove '+g.name+"</span>",$(b).on("click",function(){d.removeSelector(g,a)}),c.appendChild(b)});var f=createDefaultContextMenu(a),g=f.find("ul");return g.append($(c)),f},PhaseGroup.prototype.alignToMonth=function(a){var b=LineGroupSelector.prototype.alignToMonth.call(this,a);return this.groupSelectors(a),b},PhaseGroup.prototype.groupSelectors=function(){var a=this.selectors;for(var b in a)if(a.hasOwnProperty(b)){var c=this.x-a[b].x;if(a[b].x+=c,a[b].textBox&&(a[b].textBox.x+=c),a[b].linegroup){var d=a[b].linegroup;d.x+=c;for(var e,f=0;f<d.lines.length;f++)e=d.lines[f],e.x+=c}}},PhaseGroup.prototype.removeSelector=function(a,b){delete this.selectors[a.name];var c={x:this.x+b.monthWidth,y:this.y};b.selection[0]=a,a.move(c,b),b.addShape(a,2),b.addShape(a.linegroup,2),b.phaseSelectors[a.name]=a,a.mouseUpEvent(b);var d=Object.keys(this.selectors).length;1>=d&&this.removeGroup(b),b.selection[0]=a,b.valid=!1},PhaseGroup.prototype.removeGroup=function(a){this.hideToolTip(),a.removeShape(this),a.removeShape(this.linegroup),delete a.phaseSelectors[this.name],delete a.groupCounter[this.groupNumber];for(var b in this.selectors)this.selectors.hasOwnProperty(b)&&(a.addShape(this.selectors[b],2),a.addShape(this.selectors[b].linegroup,2),a.phaseSelectors[this.selectors[b].name]=this.selectors[b],this.selectors[b].mouseUpEvent(a))},PhaseGroup.prototype.mergeGroup=function(a,b){delete b.groupCounter[a.groupNumber],a.hideToolTip(),b.removeShape(a),b.removeShape(a.linegroup);for(var c in a.selectors)a.selectors.hasOwnProperty(c)&&(this.selectors[c]=a.selectors[c]);this.groupSelectors(),b.selection[0]=this,b.valid=!1},PhaseGroup.prototype.addSelector=function(a,b){b.removeShape(a),b.removeShape(a.textBox),b.removeShape(a.linegroup),this.selectors[a.name]=a,delete b.phaseSelectors[a.name],this.groupSelectors(),b.valid=!1},PhaseGroup.prototype.scalePosition=function(a){LineGroupSelector.prototype.scalePosition.call(this,a);var b=a.getPhases();for(var c in this.selectors)this.selectors.hasOwnProperty(c)&&b[c].scalePosition(a)},PhaseGroup.prototype.mouseUpEvent=function(a){var b=this.alignToMonth(a);this.linegroup.x=this.x,this.setPhaseLinePosition(a);for(var c in this.selectors)this.selectors.hasOwnProperty(c)&&(this.selectors[c].ajaxUpdate(a),this.selectors[c].updateDateInputField(a,b))},GanttCanvasTask.prototype.contains=function(a,b){var c=this;return c.x-c.selectionWidth<=a&&c.x+c.w+c.selectionWidth>=a&&c.y<=b&&c.y+c.h>=b},GanttCanvasTask.prototype.addChild=function(a,b){if(null==this.children&&(this.children=[]),a.isTask)this.children.push(a);else{var c=b.getRelativeXCord(a.start),d=b.getRelativeXCord(a.end),e=this.fill,f=this.h,g={dragX:!0,dragY:!1,fill:e,x:c,w:d-c,h:f,id:a.id,name:a.name,studyID:this.studyID,level:this.level+1},h=new GanttCanvasTask(g);h.isLocked=!0,this.children.push(h)}},GanttCanvasTask.prototype.move=function(a,b){var c=this,d=a.x-b.dragoffx-c.x;if(!(this.x<=0&&0>d||this.x+this.w>=parseInt(b.canvasGrid.style.width,10)&&d>0)){Math.abs(this.x-b.viewport.x)<=10&&0>d&&(b.viewport.x=this.x,document.getElementById("second").scrollLeft+=d);var e=this.children;if(c.dragX&&(c.x+=d,e))for(var f=0;f<e.length;f++)e[f].x+=d;c.dragY&&(c.y=a.y-b.dragoffy),this.setPhaseLinePosition(b)}},GanttCanvasTask.prototype.moveTo=function(a,b){var c=a||0,d=b||0;this.x=c,this.y=d},GanttCanvasTask.prototype.resize=function(a,b,c){var d,e,f=this.x,g=this.w;3===b?(this.x=a.x,this.w+=f-a.x,e=this.w-g,this.shiftChildren(e,!0)):4===b&&(d=a.x-f,e=d-this.w,this.w=a.x-f,this.shiftChildren(e,!1)),this.setPhaseLinePosition(c),c.valid=!1},GanttCanvasTask.prototype.shiftChildren=function(a,b){var c=this.children;if(c)for(var d=0;d<c.length;d++)b?c[d].x+c[d].w<this.x?c[d].x-=a:c[d].x<this.x+this.w&&(c[d].x-=a,c[d].w+=a):c[d].x<this.x+this.w?c[d].w+=a:c[d].x>=this.x+this.w&&(c[d].x+=a)},GanttCanvasTask.prototype.mouseUpEvent=function(a,b){var c=null===b||void 0===b?!0:b,d=this.adjustTaskDates(a);this.updateGridDateFields(a,d),this.setPhaseLinePosition(a),this.updateToolTip(a);var e=this.children;if(e)for(var f=0;f<e.length;f++)e[f].mouseUpEvent(a,!1);a.valid=!1,this.ajaxUpdateDates(a,d,c)},GanttCanvasTask.prototype.adjustTaskDates=function(a){var b,c,d=this.x,e=this.x+this.w;if("month"===a.snapToDate){var f=a.getDateFromXCord(this.x),g=a.getDateFromXCord(this.x+this.w),h=getDateDiff(f,g);b=snapToMonth(f);var i=b.getFullYear()+h.year,j=b.getMonth()+1+h.month;h.day>10&&j++,j>12&&(j-=12,i++),c=new Date(i,j-1,1,0,0,0),d=a.getRelativeXCord(b),e=a.getRelativeXCord(c)}return this.x=d,this.w=e-d,{start:b,end:c}},GanttCanvasTask.prototype.setPhaseLinePosition=function(a){if(this.phase&&"Start"!==this.phase&&"None"!==this.phase){var b=a.phaseSelectors[this.phase];if(void 0===b)a:for(var c in a.phaseSelectors)if(void 0!==a.phaseSelectors[c]&&a.phaseSelectors[c].hasOwnProperty("isGroup")){var d=a.phaseSelectors[c];for(var e in d.selectors)if(e===this.phase){b=d;break a}}if(this.selector!==b&&void 0!==this.selector){var f=getMyCollisionLine(this.selector,this);f.x=this.selector.x}this.selector=b;var g=b.linegroup,h=getMyCollisionLine(b,this);h.x=this.endEarly?b.x:g.x>=this.x&&g.x<this.x+this.w?this.x+this.w:b.x,a.valid=!1}},GanttCanvasTask.prototype.scalePosition=function(a){var b=a.width*(this.x/a.oldWidth),c=a.width*((this.x+this.w)/a.oldWidth)-b;this.x=Math.round(b),this.w=Math.round(c)},GanttCanvasTask.prototype.draw=function(a,b){var c=translateCoords(this,b);this.isLocked===!1?(a.lineWidth=this.selectionWidth,roundRect(a,c.x,c.y,this.w,this.h,null,this.fill,null)):this.drawLocked(a,b)},GanttCanvasTask.prototype.drawLocked=function(a,b){var c=translateCoords(this,b);a.beginPath(),a.rect(c.x+2,c.y+2,this.w-4,this.h-4),a.fillStyle="#E6E6E6",a.fill();var d=a.lineWidth;a.lineWidth=3,a.beginPath(),a.rect(c.x,c.y,this.w,this.h),a.closePath(),a.strokeStyle=this.fill,a.stroke(),a.lineWidth=d},GanttCanvasTask.prototype.drawDateLabels=function(a,b,c){var d,e=this;"undefined"==typeof this.textBox&&(d=new CollisionBoxTextBox({x:e.x,y:e.y-25,w:0,h:14,text:[b,c]}),d.strokeStyle="#000000",d.display=!1,d.parentWidth=e.w,e.textBox=d,a.addShape(d,3)),a.selection[0]!==this||this.isLocked?(d=e.textBox,d.display=!1):(d=e.textBox,d.fill="rgba(170,170,170,0.75)",d.text=[b,c],d.x=e.x,d.parentWidth=e.w,d.display=!0,d.draw(a.ctx,a))},GanttCanvasTask.prototype.drawSelectionBoxes=function(a,b){var c=b.selBoxSize/2;
this.dragY&&(b.selectionHandles[0].x=this.x-c,b.selectionHandles[0].y=this.y-c,b.selectionHandles[0].display=!0,b.selectionHandles[1].x=this.x+this.w/2-c,b.selectionHandles[1].y=this.y-c,b.selectionHandles[1].display=!0,b.selectionHandles[2].x=this.x+this.w-c,b.selectionHandles[2].y=this.y-c,b.selectionHandles[2].display=!0,b.selectionHandles[6].x=this.x+this.w/2-c,b.selectionHandles[6].y=this.y+this.h-c,b.selectionHandles[6].display=!0,b.selectionHandles[5].x=this.x-c,b.selectionHandles[5].y=this.y+this.h-c,b.selectionHandles[5].display=!0,b.selectionHandles[7].x=this.x+this.w-c,b.selectionHandles[7].y=this.y+this.h-c,b.selectionHandles[7].display=!0),this.dragX&&(b.selectionHandles[3].x=this.x-c,b.selectionHandles[3].y=this.y+this.h/2-c,b.selectionHandles[3].display=!0,b.selectionHandles[4].x=this.x+this.w-c,b.selectionHandles[4].y=this.y+this.h/2-c,b.selectionHandles[4].display=!0),a.beginPath(),a.fillStyle=b.selBoxColor;for(var d=0;8>d;d++){var e=b.selectionHandles[d];e.display&&e.draw(a,b)}},GanttCanvasTask.prototype.drawSelected=function(a,b){if(this.highlightSelected){var c=b.selection[0],d=translateCoords(c,b);a.strokeStyle=b.selectionColor,a.lineWidth=b.selectionWidth,a.strokeRect(d.x,d.y,c.w,c.h)}this.drawSelectionBoxes(a,b)},GanttCanvasTask.prototype.lockTask=function(){this.dragX=!1,this.dragY=!1,this.isLocked=!0},GanttCanvasTask.prototype.unlockTask=function(){this.dragX=!0,this.dragY=!1,this.isLocked=!1},GanttCanvasTask.prototype.deleteItem=function(a){var b=a.tasks,c=this.id.toString();b[c]&&!this.isLocked&&delete b[c],a.selection[0]===this&&(a.selection[0]=null),a.valid=!1},GanttCanvasTask.prototype.createSubContextMenu=function(a){var b,c,d=this,e=$('<div id="subContextMenu" class="context_border control_subcontextmenu" style="display: none; position: absolute"></div>'),f=$("<ul></ul>"),g=$('<fieldset style="border:none;padding:0;margin:0"></fieldset>'),h=this.phase,j=a.getPhases(),k=[];for(var l in j)k.push(l);k.sort(function(a,b){return j[a].name>j[b].name?1:-1});for(var m in k){i=k[m],c=j[i].name;var n=$('<span style="padding-left: 10px;padding-right: 10px;vertical-align: middle; display: table-cell;"></span>'),o=$('<input type="radio"  class="field radio"  id="Field1_'+i+'"  name="Field1"  value="'+c+'"">');o.on("click",function(b){updateTaskPhase(d,a),d.updateToolTip(a),b.stopPropagation()});var p=$('<label class="choice" for="Field1_'+i+'"></label>');n.append(o).append(p),h===c&&o.attr("checked","checked");var q=j[i].fill;q||(q="rgba(0, 102, 0, 0.5)");var r=$('<svg xmlns="http://www.w3.org/2000/svg" version="1.1"><rect width="10" height="10"style="fill:'+q+';stroke-width:1;stroke:rgb(0,0,0)"/></svg>');r.css("max-height","10px").css("max-width","10px");var s=$('<span style="display: table-cell; padding-left: 5px; line-height: 20px">'+c+"</span>");b=$('<li style="display: table-row"></li>'),b.append(n),b.append(s),b.append($('<span style="min-width: 10px; display: table-cell; padding-left: 15px; padding-right: 15px;"> </span>').append(r)),b.on("click",function(){var a=this.childNodes[0].childNodes[0];a.click()}),g.append(b)}return f.append(g),e.append(f),e},GanttCanvasTask.prototype.createContextMenu=function(a){var b,c,d,e,f,g,h=this;b=createDefaultContextMenu(a),c=b.find("ul"),d=$('<li id="lockButton"></li>'),this.isLocked===!0?(d.append($('<a href="#">Unlock</a>')),d.bind("click",function(){$(".splitterWrapper").trigger("unlockTask.gantt")})):(d.append($('<a href="#">Lock</a>')),d.bind("click",function(){$(".splitterWrapper").trigger("lockTask.gantt")})),c.append(d),e=$('<li id="deleteButton"><a href="#">Delete</a></li>'),e.bind("click",function(){$(".splitterWrapper").trigger("delete.gantt",h)}),c.append(e),c.append('<div class="context-menu-separator">&nbsp</div>'),g=$('<li id="endEarlyButton"></li>');var i=this.endEarly?"&#10003":"&nbsp";g.append($('<a href="#">End Early &nbsp'+i+"</a>")),g.bind("click",function(){h.endEarly=!h.endEarly,h.setPhaseLinePosition(a),ajaxUpdateStudyProp(h.name,"endEarly",h.endEarly)}),c.append(g),f=$('<li id="assignToPhaseButton"><a href="#">Phase &nbsp &#9654</a></li>');var j=this.createSubContextMenu(a);setInterval(function(){var a=$("#subContextMenu"),b=$("#assignToPhaseButton");if(!(a.length<1||b.length<1))if(a.is(":hover")||b.is(":hover")){if(a.is(":visible"))return;a.stop(!0).hide().fadeIn(50)}else a.stop(!0).fadeOut(50)},200),f.bind("hover",function(a){a.stopPropagation();var b=$("#subContextMenu"),c=$(this).parent().width();$(this).parent().parent().css("box-shadow","none");var d=Math.max(b.width(),c);$(this).parent().parent().width(d),b.width(d),b.css("display","block")}),c.append(f);var k=b.children(0);return k.append(c),b.append(j),$("body").append(b),b},GanttCanvasTask.prototype.createToolTip=function(a){var b=document.createElement("div"),c=a.getDateFromXCord(this.x),d=a.getDateFromXCord(this.x+this.w),e=getDurationString(c,d);b.innerHTML="<div class='toolTip'>"+this.id+"</div>",b.innerHTML+="<hr>",b.innerHTML+="<span class='st'>Protocol #:&nbsp;</span><span class='ut'>"+this.TaskInfo.PROTOCOL_NUMBER+"</span><br/>",b.innerHTML+="<span class='st'>Research Account:&nbsp;</span><span class='ut'>"+this.TaskInfo.STUDY_RESEARCH_ACCOUNT+"</span><br/>",b.innerHTML+="<span class='st'>ONB:&nbsp;</span><span class='ut'>"+this.TaskInfo.STUDY_ONB_NUMBER+"</span><br/>";var f=this.id.replace(/\./g,"");return b.innerHTML+="<span class='st'>Start Date:&nbsp;</span><span class='ut' id='tooTipStart_"+f+"'>"+c.format("MM/dd/yy")+"</span><br/>",b.innerHTML+="<span class='st'>Duration:&nbsp;</span><span class='ut' id='tooTipDuration_"+f+"'>"+e+"</span><br/>",b.innerHTML+="<span class='st'>Phase:&nbsp;</span><span class='ut' id='tooTipPhase_"+f+"'>"+this.phase+"</span><br/>",b.className="popUpInfo",b},GanttCanvasTask.prototype.showToolTip=function(a,b){if($(".popUpInfo").hide(),void 0===this.toolTip||null===this.toolTip){var c,d=document.getElementById("canvas"),e=cumulativeOffset(d),f=a.pageX,g=50,h=this.createToolTip(b);h.style.visibility="hidden",document.body.appendChild(h);var i=h.offsetHeight;this.divHeight=i,document.body.removeChild(h),c=e.top+this.y-g-i,h.style.cssText=";z-index:1;position:absolute;left:"+f+"px;top:"+c+"px;",h.style.visibility="visible",this.toolTip=h,$("#ganttChart").append($(h))}else{var c,d=document.getElementById("canvas"),e=cumulativeOffset(d),f=a.pageX,g=50,h=this.toolTip;h.style.visibility="hidden",c=e.top+this.y-g-this.divHeight;var j=parseInt(getStyle(h,"width"),10);f+j+20>=$(window).width()&&(f=f-j-20),h.style.cssText=";z-index:1;position:absolute;left:"+f+"px;top:"+c+"px;",h.style.visibility="visible"}},GanttCanvasTask.prototype.hideToolTip=function(){this.toolTip&&(this.toolTip.style.display="none")},GanttCanvasTask.prototype.updateToolTip=function(a){var b=this.id.replace(/\./g,""),c=$("#tooTipStart_"+b),d=$("#tooTipPhase_"+b);if(c.length>0){var e=$("#tooTipDuration_"+b),f=a.getDateFromXCord(this.x),g=a.getDateFromXCord(this.x+this.w),h=getDurationString(f,g);c.html(f.format("MM/dd/yy")),e.html(h)}d.length>0&&d.html(this.phase)},GanttCanvasTask.prototype.ajaxUpdateDates=function(a,b,c){var d=b.start.format("MMMM dd yyyy"),e=b.end.format("MMMM dd yyyy");ajaxUpdateStudyProp(this.name,"start",d,c),ajaxUpdateStudyProp(this.name,"end",e,c)},GanttCanvasTask.prototype.updateGridDateFields=function(a,b){var c=b.start,d=b.end;$(".splitterWrapper").trigger("canvasUpdateTask.gantt",[this.id,c.format("MM/dd/yyyy"),d.format("MM/dd/yyyy")])};var myScrollBarWidth,G_vmlCanvasManager,keys={},barMoveEventFired=!1,renderToCanvas=function(a,b,c){var d=document.createElement("canvas");return d.width=a,d.height=b,c(d.getContext("2d")),d};CanvasRenderingContext2D.prototype.dashedLine=function(a,b,c,d,e){void 0==e&&(e=2),this.moveTo(a,b);for(var f=c-a,g=d-b,h=Math.floor(Math.sqrt(f*f+g*g)/e),i=f/h,j=g/h,k=0;k++<h;)a+=i,b+=j,this[0==k%2?"moveTo":"lineTo"](a,b);this[0==k%2?"moveTo":"lineTo"](c,d)},String.prototype.padZero=function(a,b){for(var c=this,b=b||"0",a=a||2;c.length<a;)c=b+c;return c},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},$(function(){window.localStorage||(window.localStorage={getItem:function(a){return a&&this.hasOwnProperty(a)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(a){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[a])},setItem:function(a,b){a&&(document.cookie=escape(a)+"="+escape(b)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length)},length:0,removeItem:function(a){a&&this.hasOwnProperty(a)&&(document.cookie=escape(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(a){return new RegExp("(?:^|;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},window.localStorage.length=(document.cookie.match(/\=/g)||window.localStorage).length),Object.keys||(Object.keys=function(){"use strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}())}),$.fn.unselectable=function(){return this.each(function(){$(this).addClass("unselectable").attr("unselectable","on")}),$(this)},$.fn.clearUnselectable=function(){return this.each(function(){$(this).removeClass("unselectable").removeAttr("unselectable")}),$(this)},function(a){Math.precision=function(a,b){return void 0===b&&(b=0),Math.round(a*Math.pow(10,b))/Math.pow(10,b)};var b=function(b,c){var d,e,f=this,g=b.find("img:first"),h=0,i=100,j=100,k=0,l=100,m=100,n=0,o=0,p=new Array,q=function(a){for(var b=0;b<p.length;b++)p[b].call(f,f,a)},r=function(c){var g=b.offset();d={l:0|g.left,t:0|g.top},clearTimeout(e),e=setTimeout(function(){u.call(f,c)},0),a(document).bind("mousemove",s).bind("mouseup",t),c.preventDefault()},s=function(a){return clearTimeout(e),e=setTimeout(function(){u.call(f,a)},0),a.stopPropagation(),a.preventDefault(),!1},t=function(b){return a(document).unbind("mouseup",t).unbind("mousemove",s),b.stopPropagation(),b.preventDefault(),!1},u=function(a){var c=a.pageX-d.l,e=a.pageY-d.t,g=b.w,i=b.h;0>c?c=0:c>g&&(c=g),0>e?e=0:e>i&&(e=i),w.call(f,"xy",{x:c/g*j+h,y:e/i*m+k})},v=function(){var a=0,c=0,d=b.w,e=b.h,f=g.w,h=g.h;setTimeout(function(){j>0&&(a=n==i?d:0|n/j*d),m>0&&(c=o==l?e:0|o/m*e),f>=d?a=(d>>1)-(f>>1):a-=f>>1,h>=e?c=(e>>1)-(h>>1):c-=h>>1,g.css({left:a+"px",top:c+"px"})},0)},w=function(a,b,c){var d=void 0!==b;if(!d)switch((void 0===a||null==a)&&(a="xy"),a.toLowerCase()){case"x":return n;case"y":return o;case"xy":default:return{x:n,y:o}}if(null==c||c!=f){var e,g,j=!1;switch(null==a&&(a="xy"),a.toLowerCase()){case"x":e=b&&(b.x&&0|b.x||0|b)||0;break;case"y":g=b&&(b.y&&0|b.y||0|b)||0;break;case"xy":default:e=b&&b.x&&0|b.x||0,g=b&&b.y&&0|b.y||0}null!=e&&(h>e?e=h:e>i&&(e=i),n!=e&&(n=e,j=!0)),null!=g&&(k>g?g=k:g>l&&(g=l),o!=g&&(o=g,j=!0)),j&&q.call(f,c||f)}},x=function(a,b){var c=void 0!==b;if(!c)switch((void 0===a||null==a)&&(a="all"),a.toLowerCase()){case"minx":return h;case"maxx":return i;case"rangex":return{minX:h,maxX:i,rangeX:j};case"miny":return k;case"maxy":return l;case"rangey":return{minY:k,maxY:l,rangeY:m};case"all":default:return{minX:h,maxX:i,rangeX:j,minY:k,maxY:l,rangeY:m}}var d,e,f,g;switch(null==a&&(a="all"),a.toLowerCase()){case"minx":d=b&&(b.minX&&0|b.minX||0|b)||0;break;case"maxx":e=b&&(b.maxX&&0|b.maxX||0|b)||0;break;case"rangex":d=b&&b.minX&&0|b.minX||0,e=b&&b.maxX&&0|b.maxX||0;break;case"miny":f=b&&(b.minY&&0|b.minY||0|b)||0;break;case"maxy":g=b&&(b.maxY&&0|b.maxY||0|b)||0;break;case"rangey":f=b&&b.minY&&0|b.minY||0,g=b&&b.maxY&&0|b.maxY||0;break;case"all":default:d=b&&b.minX&&0|b.minX||0,e=b&&b.maxX&&0|b.maxX||0,f=b&&b.minY&&0|b.minY||0,g=b&&b.maxY&&0|b.maxY||0}null!=d&&h!=d&&(h=d,j=i-h),null!=e&&i!=e&&(i=e,j=i-h),null!=f&&k!=f&&(k=f,m=l-k),null!=g&&l!=g&&(l=g,m=l-k)},y=function(b){a.isFunction(b)&&p.push(b)},z=function(b){if(a.isFunction(b))for(var c;-1!=(c=a.inArray(b,p));)p.splice(c,1)},A=function(){a(document).unbind("mouseup",t).unbind("mousemove",s),b.unbind("mousedown",r),b=null,g=null,p=null};a.extend(!0,f,{val:w,range:x,bind:y,unbind:z,destroy:A}),g.src=c.arrow&&c.arrow.image,g.w=c.arrow&&c.arrow.width||g.width(),g.h=c.arrow&&c.arrow.height||g.height(),b.w=c.map&&c.map.width||b.width(),b.h=c.map&&c.map.height||b.height(),b.bind("mousedown",r),y.call(f,v)},c=function(b,c,d,e){var f=this,g=b.find("td.Text input"),h=g.eq(3),i=g.eq(4),j=g.eq(5),k=g.length>7?g.eq(6):null,l=g.eq(0),m=g.eq(1),n=g.eq(2),o=g.eq(g.length>7?7:6),p=g.length>7?g.eq(8):null,q=function(a){if(""!=a.target.value||a.target==o.get(0)||(null==d||a.target==d.get(0))&&null!=d){if(!t(a))return a;switch(a.target){case h.get(0):switch(a.keyCode){case 38:return h.val(u.call(f,(h.val()<<0)+1,0,255)),c.val("r",h.val(),a.target),!1;case 40:return h.val(u.call(f,(h.val()<<0)-1,0,255)),c.val("r",h.val(),a.target),!1}break;case i.get(0):switch(a.keyCode){case 38:return i.val(u.call(f,(i.val()<<0)+1,0,255)),c.val("g",i.val(),a.target),!1;case 40:return i.val(u.call(f,(i.val()<<0)-1,0,255)),c.val("g",i.val(),a.target),!1}break;case j.get(0):switch(a.keyCode){case 38:return j.val(u.call(f,(j.val()<<0)+1,0,255)),c.val("b",j.val(),a.target),!1;case 40:return j.val(u.call(f,(j.val()<<0)-1,0,255)),c.val("b",j.val(),a.target),!1}break;case k&&k.get(0):switch(a.keyCode){case 38:return k.val(u.call(f,parseFloat(k.val())+1,0,100)),c.val("a",Math.precision(255*k.val()/100,e),a.target),!1;case 40:return k.val(u.call(f,parseFloat(k.val())-1,0,100)),c.val("a",Math.precision(255*k.val()/100,e),a.target),!1}break;case l.get(0):switch(a.keyCode){case 38:return l.val(u.call(f,(l.val()<<0)+1,0,360)),c.val("h",l.val(),a.target),!1;case 40:return l.val(u.call(f,(l.val()<<0)-1,0,360)),c.val("h",l.val(),a.target),!1}break;case m.get(0):switch(a.keyCode){case 38:return m.val(u.call(f,(m.val()<<0)+1,0,100)),c.val("s",m.val(),a.target),!1;case 40:return m.val(u.call(f,(m.val()<<0)-1,0,100)),c.val("s",m.val(),a.target),!1}break;case n.get(0):switch(a.keyCode){case 38:return n.val(u.call(f,(n.val()<<0)+1,0,100)),c.val("v",n.val(),a.target),!1;case 40:return n.val(u.call(f,(n.val()<<0)-1,0,100)),c.val("v",n.val(),a.target),!1}}}},r=function(a){if(""!=a.target.value||a.target==o.get(0)||(null==d||a.target==d.get(0))&&null!=d){if(!t(a))return a;switch(a.target){case h.get(0):h.val(u.call(f,h.val(),0,255)),c.val("r",h.val(),a.target);break;case i.get(0):i.val(u.call(f,i.val(),0,255)),c.val("g",i.val(),a.target);break;case j.get(0):j.val(u.call(f,j.val(),0,255)),c.val("b",j.val(),a.target);break;case k&&k.get(0):k.val(u.call(f,k.val(),0,100)),c.val("a",Math.precision(255*k.val()/100,e),a.target);break;case l.get(0):l.val(u.call(f,l.val(),0,360)),c.val("h",l.val(),a.target);break;case m.get(0):m.val(u.call(f,m.val(),0,100)),c.val("s",m.val(),a.target);break;case n.get(0):n.val(u.call(f,n.val(),0,100)),c.val("v",n.val(),a.target);break;case o.get(0):o.val(o.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,6)),d&&d.val(o.val()),c.val("hex",""!=o.val()?o.val():null,a.target);break;case d&&d.get(0):d.val(d.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,6)),o.val(d.val()),c.val("hex",""!=d.val()?d.val():null,a.target);break;case p&&p.get(0):p.val(p.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,2)),c.val("a",null!=p.val()?parseInt(p.val(),16):null,a.target)}}},s=function(a){if(null!=c.val())switch(a.target){case h.get(0):h.val(c.val("r"));break;case i.get(0):i.val(c.val("g"));break;case j.get(0):j.val(c.val("b"));break;case k&&k.get(0):k.val(Math.precision(100*c.val("a")/255,e));break;case l.get(0):l.val(c.val("h"));break;case m.get(0):m.val(c.val("s"));break;case n.get(0):n.val(c.val("v"));break;case o.get(0):case d&&d.get(0):o.val(c.val("hex")),d&&d.val(c.val("hex"));break;case p&&p.get(0):p.val(c.val("ahex").substring(6))}},t=function(a){switch(a.keyCode){case 9:case 16:case 29:case 37:case 39:return!1;case"c".charCodeAt():case"v".charCodeAt():if(a.ctrlKey)return!1}return!0},u=function(a,b,c){return""==a||isNaN(a)?b:a>c?c:b>a?b:a},v=function(a,b){var c=a.val("all");b!=h.get(0)&&h.val(null!=c?c.r:""),b!=i.get(0)&&i.val(null!=c?c.g:""),b!=j.get(0)&&j.val(null!=c?c.b:""),k&&b!=k.get(0)&&k.val(null!=c?Math.precision(100*c.a/255,e):""),b!=l.get(0)&&l.val(null!=c?c.h:""),b!=m.get(0)&&m.val(null!=c?c.s:""),b!=n.get(0)&&n.val(null!=c?c.v:""),b!=o.get(0)&&(d&&b!=d.get(0)||!d)&&o.val(null!=c?c.hex:""),d&&b!=d.get(0)&&b!=o.get(0)&&d.val(null!=c?c.hex:""),p&&b!=p.get(0)&&p.val(null!=c?c.ahex.substring(6):"")},w=function(){h.add(i).add(j).add(k).add(l).add(m).add(n).add(o).add(d).add(p).unbind("keyup",r).unbind("blur",s),h.add(i).add(j).add(k).add(l).add(m).add(n).unbind("keydown",q),c.unbind(v),h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null};a.extend(!0,f,{destroy:w}),h.add(i).add(j).add(k).add(l).add(m).add(n).add(o).add(d).add(p).bind("keyup",r).bind("blur",s),h.add(i).add(j).add(k).add(l).add(m).add(n).bind("keydown",q),c.bind(v)};a.jPicker={List:[],Color:function(b){var c,d,e,g,h,i,j,k=this,l=new Array,m=function(a){for(var b=0;b<l.length;b++)l[b].call(k,k,a)},n=function(a,b,l){var o=void 0!==b;if(!o){if((void 0===a||null==a||""==a)&&(a="all"),null==c)return null;switch(a.toLowerCase()){case"ahex":return f.rgbaToHex({r:c,g:d,b:e,a:g});case"hex":return n("ahex").substring(0,6);case"all":return{r:c,g:d,b:e,a:g,h:h,s:i,v:j,hex:n.call(k,"hex"),ahex:n.call(k,"ahex")};default:for(var p={},q=0;q<a.length;q++)switch(a.charAt(q)){case"r":1==a.length?p=c:p.r=c;break;case"g":1==a.length?p=d:p.g=d;break;case"b":1==a.length?p=e:p.b=e;break;case"a":1==a.length?p=g:p.a=g;break;case"h":1==a.length?p=h:p.h=h;break;case"s":1==a.length?p=i:p.s=i;break;case"v":1==a.length?p=j:p.v=j}return p=={}?n.call(k,"all"):p}}if(null==l||l!=k){var r=!1;if(null==a&&(a=""),null==b)return null!=c&&(c=null,r=!0),null!=d&&(d=null,r=!0),null!=e&&(e=null,r=!0),null!=g&&(g=null,r=!0),null!=h&&(h=null,r=!0),null!=i&&(i=null,r=!0),null!=j&&(j=null,r=!0),r&&m.call(k,l||k),void 0;switch(a.toLowerCase()){case"ahex":case"hex":var p=f.hexToRgba(b&&(b.ahex||b.hex)||b||"00000000");n.call(k,"rgba",{r:p.r,g:p.g,b:p.b,a:"ahex"==a?p.a:null!=g?g:255},l);break;default:if(b&&(null!=b.ahex||null!=b.hex))return n.call(k,"ahex",b.ahex||b.hex||"00000000",l),void 0;var s={},t=!1,u=!1;void 0!==b.r&&-1==!a.indexOf("r")&&(a+="r"),void 0!==b.g&&-1==!a.indexOf("g")&&(a+="g"),void 0!==b.b&&-1==!a.indexOf("b")&&(a+="b"),void 0!==b.a&&-1==!a.indexOf("a")&&(a+="a"),void 0!==b.h&&-1==!a.indexOf("h")&&(a+="h"),void 0!==b.s&&-1==!a.indexOf("s")&&(a+="s"),void 0!==b.v&&-1==!a.indexOf("v")&&(a+="v");for(var q=0;q<a.length;q++)switch(a.charAt(q)){case"r":if(u)continue;t=!0,s.r=b&&b.r&&0|b.r||b&&0|b||0,s.r<0?s.r=0:s.r>255&&(s.r=255),c!=s.r&&(c=s.r,r=!0);break;case"g":if(u)continue;t=!0,s.g=b&&b.g&&0|b.g||b&&0|b||0,s.g<0?s.g=0:s.g>255&&(s.g=255),d!=s.g&&(d=s.g,r=!0);break;case"b":if(u)continue;t=!0,s.b=b&&b.b&&0|b.b||b&&0|b||0,s.b<0?s.b=0:s.b>255&&(s.b=255),e!=s.b&&(e=s.b,r=!0);break;case"a":s.a=b&&null!=b.a?0|b.a:null!=b?0|b:255,s.a<0?s.a=0:s.a>255&&(s.a=255),g!=s.a&&(g=s.a,r=!0);break;case"h":if(t)continue;u=!0,s.h=b&&b.h&&0|b.h||b&&0|b||0,s.h<0?s.h=0:s.h>360&&(s.h=360),h!=s.h&&(h=s.h,r=!0);break;case"s":if(t)continue;u=!0,s.s=b&&null!=b.s?0|b.s:null!=b?0|b:100,s.s<0?s.s=0:s.s>100&&(s.s=100),i!=s.s&&(i=s.s,r=!0);break;case"v":if(t)continue;u=!0,s.v=b&&null!=b.v?0|b.v:null!=b?0|b:100,s.v<0?s.v=0:s.v>100&&(s.v=100),j!=s.v&&(j=s.v,r=!0)}if(r){if(t){c=c||0,d=d||0,e=e||0;var p=f.rgbToHsv({r:c,g:d,b:e});h=p.h,i=p.s,j=p.v}else if(u){h=h||0,i=null!=i?i:100,j=null!=j?j:100;var p=f.hsvToRgb({h:h,s:i,v:j});c=p.r,d=p.g,e=p.b}g=null!=g?g:255,m.call(k,l||k)}}}},o=function(b){a.isFunction(b)&&l.push(b)},p=function(b){if(a.isFunction(b))for(var c;-1!=(c=a.inArray(b,l));)l.splice(c,1)},q=function(){l=null};a.extend(!0,k,{val:n,bind:o,unbind:p,destroy:q}),b&&(null!=b.ahex?n("ahex",b):null!=b.hex?n((null!=b.a?"a":"")+"hex",null!=b.a?{ahex:b.hex+f.intToHex(b.a)}:b):null!=b.r&&null!=b.g&&null!=b.b?n("rgb"+(null!=b.a?"a":""),b):null!=b.h&&null!=b.s&&null!=b.v&&n("hsv"+(null!=b.a?"a":""),b))},ColorMethods:{hexToRgba:function(a){if(a=this.validateHex(a),""==a)return{r:null,g:null,b:null,a:null};var b="00",c="00",d="00",e="255";return 6==a.length&&(a+="ff"),a.length>6?(b=a.substring(0,2),c=a.substring(2,4),d=a.substring(4,6),e=a.substring(6,a.length)):(a.length>4&&(b=a.substring(4,a.length),a=a.substring(0,4)),a.length>2&&(c=a.substring(2,a.length),a=a.substring(0,2)),a.length>0&&(d=a.substring(0,a.length))),{r:this.hexToInt(b),g:this.hexToInt(c),b:this.hexToInt(d),a:this.hexToInt(e)}},validateHex:function(a){return a=a.toLowerCase().replace(/[^a-f0-9]/g,""),a.length>8&&(a=a.substring(0,8)),a},rgbaToHex:function(a){return this.intToHex(a.r)+this.intToHex(a.g)+this.intToHex(a.b)+this.intToHex(a.a)},intToHex:function(a){var b=(0|a).toString(16);return 1==b.length&&(b="0"+b),b.toLowerCase()},hexToInt:function(a){return parseInt(a,16)},rgbToHsv:function(a){var b,c=a.r/255,d=a.g/255,e=a.b/255,f={h:0,s:0,v:0},g=0,h=0;return c>=d&&c>=e?(h=c,g=d>e?e:d):d>=e&&d>=c?(h=d,g=c>e?e:c):(h=e,g=d>c?c:d),f.v=h,f.s=h?(h-g)/h:0,f.s?(b=h-g,f.h=c==h?(d-e)/b:d==h?2+(e-c)/b:4+(c-d)/b,f.h=parseInt(60*f.h),f.h<0&&(f.h+=360)):f.h=0,f.s=0|100*f.s,f.v=0|100*f.v,f},hsvToRgb:function(a){var b={r:0,g:0,b:0,a:100},c=a.h,d=a.s,e=a.v;if(0==d)b.r=b.g=b.b=0==e?0:0|255*e/100;else{360==c&&(c=0),c/=60,d/=100,e/=100;var f=0|c,g=c-f,h=e*(1-d),i=e*(1-d*g),j=e*(1-d*(1-g));switch(f){case 0:b.r=e,b.g=j,b.b=h;break;case 1:b.r=i,b.g=e,b.b=h;break;case 2:b.r=h,b.g=e,b.b=j;break;case 3:b.r=h,b.g=i,b.b=e;break;case 4:b.r=j,b.g=h,b.b=e;break;case 5:b.r=e,b.g=h,b.b=i}b.r=0|255*b.r,b.g=0|255*b.g,b.b=0|255*b.b}return b}}};var d=a.jPicker.Color,e=a.jPicker.List,f=a.jPicker.ColorMethods;a.fn.jPicker=function(g){var h=arguments;return this.each(function(){var j=this,k=a.extend(!0,{},a.fn.jPicker.defaults,g);"input"==a(j).get(0).nodeName.toLowerCase()&&(a.extend(!0,k,{window:{bindToInput:!0,expandable:!0,input:a(j)}}),""==a(j).val()?(k.color.active=new d({hex:null}),k.color.current=new d({hex:null})):f.validateHex(a(j).val())&&(k.color.active=new d({hex:a(j).val(),a:k.color.active.val("a")}),k.color.current=new d({hex:a(j).val(),a:k.color.active.val("a")}))),k.window.expandable?a(j).after('<span class="jPicker"><span class="Icon"><span class="Color">&nbsp;</span><span class="Alpha">&nbsp;</span><span class="Image" title="Click To Open Color Picker">&nbsp;</span><span class="Container">&nbsp;</span></span></span>'):k.window.liveUpdate=!1;var l=parseFloat(navigator.appVersion.split("MSIE")[1])<7&&document.body.filters,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=function(a){var b,c,d=ub.active,e=(sb.clientPath,d.val("hex"));switch(k.color.mode=a,a){case"h":if(setTimeout(function(){W.call(j,n,"transparent"),Y.call(j,p,0),Z.call(j,p,100),Y.call(j,q,260),Z.call(j,q,100),W.call(j,o,"transparent"),Y.call(j,s,0),Z.call(j,s,100),Y.call(j,t,260),Z.call(j,t,100),Y.call(j,u,260),Z.call(j,u,100),Y.call(j,v,260),Z.call(j,v,100),Y.call(j,x,260),Z.call(j,x,100)},0),y.range("all",{minX:0,maxX:100,minY:0,maxY:100}),z.range("rangeY",{minY:0,maxY:360}),null==d.val("ahex"))break;y.val("xy",{x:d.val("s"),y:100-d.val("v")},y),z.val("y",360-d.val("h"),z);break;case"s":if(setTimeout(function(){W.call(j,n,"transparent"),Y.call(j,p,-260),Y.call(j,q,-520),Y.call(j,s,-260),Y.call(j,t,-520),Y.call(j,x,260),Z.call(j,x,100)},0),y.range("all",{minX:0,maxX:360,minY:0,maxY:100}),z.range("rangeY",{minY:0,maxY:100}),null==d.val("ahex"))break;y.val("xy",{x:d.val("h"),y:100-d.val("v")},y),z.val("y",100-d.val("s"),z);break;case"v":if(setTimeout(function(){W.call(j,n,"000000"),Y.call(j,p,-780),Y.call(j,q,260),W.call(j,o,e),Y.call(j,s,-520),Y.call(j,t,260),Z.call(j,t,100),Y.call(j,x,260),Z.call(j,x,100)},0),y.range("all",{minX:0,maxX:360,minY:0,maxY:100}),z.range("rangeY",{minY:0,maxY:100}),null==d.val("ahex"))break;y.val("xy",{x:d.val("h"),y:100-d.val("s")},y),z.val("y",100-d.val("v"),z);break;case"r":if(b=-1040,c=-780,y.range("all",{minX:0,maxX:255,minY:0,maxY:255}),z.range("rangeY",{minY:0,maxY:255}),null==d.val("ahex"))break;y.val("xy",{x:d.val("b"),y:255-d.val("g")},y),z.val("y",255-d.val("r"),z);break;case"g":if(b=-1560,c=-1820,y.range("all",{minX:0,maxX:255,minY:0,maxY:255}),z.range("rangeY",{minY:0,maxY:255}),null==d.val("ahex"))break;y.val("xy",{x:d.val("b"),y:255-d.val("r")},y),z.val("y",255-d.val("g"),z);break;case"b":if(b=-2080,c=-2860,y.range("all",{minX:0,maxX:255,minY:0,maxY:255}),z.range("rangeY",{minY:0,maxY:255}),null==d.val("ahex"))break;y.val("xy",{x:d.val("r"),y:255-d.val("g")},y),z.val("y",255-d.val("b"),z);break;case"a":if(setTimeout(function(){W.call(j,n,"transparent"),Y.call(j,p,-260),Y.call(j,q,-520),Y.call(j,s,260),Y.call(j,t,260),Z.call(j,t,100),Y.call(j,x,0),Z.call(j,x,100)},0),y.range("all",{minX:0,maxX:360,minY:0,maxY:100}),z.range("rangeY",{minY:0,maxY:255}),null==d.val("ahex"))break;y.val("xy",{x:d.val("h"),y:100-d.val("v")},y),z.val("y",255-d.val("a"),z);break;default:throw"Invalid Mode"}switch(a){case"h":break;case"s":case"v":case"a":setTimeout(function(){Z.call(j,p,100),Z.call(j,s,100),Y.call(j,u,260),Z.call(j,u,100),Y.call(j,v,260),Z.call(j,v,100)},0);break;case"r":case"g":case"b":setTimeout(function(){W.call(j,n,"transparent"),W.call(j,o,"transparent"),Z.call(j,s,100),Z.call(j,p,100),Y.call(j,p,b),Y.call(j,q,b-260),Y.call(j,s,c-780),Y.call(j,t,c-520),Y.call(j,u,c),Y.call(j,v,c-260),Y.call(j,x,260),Z.call(j,x,100)},0)}null!=d.val("ahex")&&P.call(j,d)},P=function(a,b){(null==b||b!=z&&b!=y)&&S.call(j,a,b),setTimeout(function(){T.call(j,a),U.call(j,a),V.call(j,a)},0)},Q=function(a,b){var c=ub.active;if(b==y||null!=c.val()){var d=a.val("all");switch(k.color.mode){case"h":c.val("sv",{s:d.x,v:100-d.y},b);break;case"s":case"a":c.val("hv",{h:d.x,v:100-d.y},b);break;case"v":c.val("hs",{h:d.x,s:100-d.y},b);break;case"r":c.val("gb",{g:255-d.y,b:d.x},b);break;case"g":c.val("rb",{r:255-d.y,b:d.x},b);break;case"b":c.val("rg",{r:d.x,g:255-d.y},b)}}},R=function(a,b){var c=ub.active;if(b==z||null!=c.val())switch(k.color.mode){case"h":c.val("h",{h:360-a.val("y")},b);break;case"s":c.val("s",{s:100-a.val("y")},b);break;case"v":c.val("v",{v:100-a.val("y")},b);break;case"r":c.val("r",{r:255-a.val("y")},b);break;case"g":c.val("g",{g:255-a.val("y")},b);break;case"b":c.val("b",{b:255-a.val("y")},b);break;case"a":c.val("a",255-a.val("y"),b)}},S=function(a,b){if(b!=y)switch(k.color.mode){case"h":var c=a.val("sv");y.val("xy",{x:null!=c?c.s:100,y:100-(null!=c?c.v:100)},b);break;case"s":case"a":var d=a.val("hv");y.val("xy",{x:d&&d.h||0,y:100-(null!=d?d.v:100)},b);break;case"v":var e=a.val("hs");y.val("xy",{x:e&&e.h||0,y:100-(null!=e?e.s:100)},b);break;case"r":var f=a.val("bg");y.val("xy",{x:f&&f.b||0,y:255-(f&&f.g||0)},b);break;case"g":var g=a.val("br");y.val("xy",{x:g&&g.b||0,y:255-(g&&g.r||0)},b);break;case"b":var h=a.val("rg");y.val("xy",{x:h&&h.r||0,y:255-(h&&h.g||0)},b)}if(b!=z)switch(k.color.mode){case"h":z.val("y",360-(a.val("h")||0),b);break;case"s":var i=a.val("s");z.val("y",100-(null!=i?i:100),b);break;case"v":var j=a.val("v");z.val("y",100-(null!=j?j:100),b);break;case"r":z.val("y",255-(a.val("r")||0),b);break;case"g":z.val("y",255-(a.val("g")||0),b);break;case"b":z.val("y",255-(a.val("b")||0),b);break;case"a":var l=a.val("a");z.val("y",255-(null!=l?l:255),b)}},T=function(a){try{var b=a.val("all");F.css({backgroundColor:b&&"#"+b.hex||"transparent"}),Z.call(j,F,b&&Math.precision(100*b.a/255,4)||0)}catch(c){}},U=function(a){switch(k.color.mode){case"h":W.call(j,n,new d({h:a.val("h")||0,s:100,v:100}).val("hex"));break;case"s":case"a":var b=a.val("s");Z.call(j,q,100-(null!=b?b:100));break;case"v":var c=a.val("v");Z.call(j,p,null!=c?c:100);break;case"r":Z.call(j,q,Math.precision(100*((a.val("r")||0)/255),4));break;case"g":Z.call(j,q,Math.precision(100*((a.val("g")||0)/255),4));break;case"b":Z.call(j,q,Math.precision(100*((a.val("b")||0)/255)))}var e=a.val("a");Z.call(j,r,Math.precision(100*(255-(e||0))/255,4))},V=function(a){switch(k.color.mode){case"h":var b=a.val("a");Z.call(j,w,Math.precision(100*(255-(b||0))/255,4));break;case"s":var c=a.val("hva"),e=new d({h:c&&c.h||0,s:100,v:null!=c?c.v:100});W.call(j,o,e.val("hex")),Z.call(j,t,100-(null!=c?c.v:100)),Z.call(j,w,Math.precision(100*(255-(c&&c.a||0))/255,4));break;case"v":var f=a.val("hsa"),g=new d({h:f&&f.h||0,s:null!=f?f.s:100,v:100});W.call(j,o,g.val("hex")),Z.call(j,w,Math.precision(100*(255-(f&&f.a||0))/255,4));break;case"r":case"g":case"b":var h=0,i=0,l=a.val("rgba");"r"==k.color.mode?(h=l&&l.b||0,i=l&&l.g||0):"g"==k.color.mode?(h=l&&l.b||0,i=l&&l.r||0):"b"==k.color.mode&&(h=l&&l.r||0,i=l&&l.g||0);var m=i>h?h:i;Z.call(j,t,h>i?Math.precision(100*((h-i)/(255-i)),4):0),Z.call(j,u,i>h?Math.precision(100*((i-h)/(255-h)),4):0),Z.call(j,v,Math.precision(100*(m/255),4)),Z.call(j,w,Math.precision(100*(255-(l&&l.a||0))/255,4));break;case"a":var b=a.val("a");W.call(j,o,a.val("hex")||"000000"),Z.call(j,w,null!=b?0:100),Z.call(j,x,null!=b?100:0)}},W=function(a,b){a.css({backgroundColor:b&&6==b.length&&"#"+b||"transparent"})},X=function(a,b){!l||-1==b.indexOf("AlphaBar.png")&&-1==b.indexOf("Bars.png")&&-1==b.indexOf("Maps.png")?a.css({backgroundImage:"url('"+b+"')"}):(a.attr("pngSrc",b),a.css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b+"', sizingMethod='scale')"}))},Y=function(a,b){a.css({top:b+"px"})},Z=function(a,b){if(a.css({visibility:b>0?"visible":"hidden"}),b>0&&100>b)if(l){var c=a.attr("pngSrc");null==c||-1==c.indexOf("AlphaBar.png")&&-1==c.indexOf("Bars.png")&&-1==c.indexOf("Maps.png")?a.css({opacity:Math.precision(b/100,4)}):a.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"', sizingMethod='scale') progid:DXImageTransform.Microsoft.Alpha(opacity="+b+")"})}else a.css({opacity:Math.precision(b/100,4)});else if(0==b||100==b)if(l){var c=a.attr("pngSrc");null==c||-1==c.indexOf("AlphaBar.png")&&-1==c.indexOf("Bars.png")&&-1==c.indexOf("Maps.png")?a.css({opacity:""}):a.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"', sizingMethod='scale')"})}else a.css({opacity:""})},$=function(){ub.active.val("ahex",ub.current.val("ahex"))},_=function(){ub.current.val("ahex",ub.active.val("ahex"))},ab=function(b){a(this).parents("tbody:first").find('input:radio[value!="'+b.target.value+'"]').removeAttr("checked"),O.call(j,b.target.value)},bb=function(){$.call(j)},cb=function(){$.call(j),k.window.expandable&&pb.call(j),a.isFunction(nb)&&nb.call(j,ub.active,I)},db=function(){_.call(j),k.window.expandable&&pb.call(j),a.isFunction(lb)&&lb.call(j,ub.active,H)},eb=function(){ob.call(j)},fb=function(a){var b=a.val("hex");G.css({backgroundColor:b&&"#"+b||"transparent"}),Z.call(j,G,Math.precision(100*(a.val("a")||0)/255,4))},gb=function(a){var b=a.val("hex"),c=a.val("va");K.css({backgroundColor:b&&"#"+b||"transparent"}),Z.call(j,L,Math.precision(100*(255-(c&&c.a||0))/255,4)),k.window.bindToInput&&k.window.updateInputColor&&k.window.input.css({backgroundColor:b&&"#"+b||"transparent",color:null==c||c.v>75?"#000000":"#ffffff"})},hb=function(b){k.window.element,k.window.page,B=parseInt(m.css("left")),C=parseInt(m.css("top")),D=b.pageX,E=b.pageY,a(document).bind("mousemove",ib).bind("mouseup",jb),b.preventDefault()},ib=function(b){return m.css({left:B-(D-b.pageX)+"px",top:C-(E-b.pageY)+"px"}),k.window.expandable&&!a.support.boxModel&&m.prev().css({left:m.css("left"),top:m.css("top")}),b.stopPropagation(),b.preventDefault(),!1
},jb=function(b){return a(document).unbind("mousemove",ib).unbind("mouseup",jb),b.stopPropagation(),b.preventDefault(),!1},kb=function(b){return b.preventDefault(),b.stopPropagation(),ub.active.val("ahex",a(this).attr("title")||null,b.target),!1},lb=a.isFunction(h[1])&&h[1]||null,mb=a.isFunction(h[2])&&h[2]||null,nb=a.isFunction(h[3])&&h[3]||null,ob=function(){ub.current.val("ahex",ub.active.val("ahex"));var b=function(){if(k.window.expandable&&!a.support.boxModel){var b=m.find("table:first");m.before("<iframe/>"),m.prev().css({width:b.width(),height:m.height(),opacity:0,position:"absolute",left:m.css("left"),top:m.css("top")})}};switch(k.window.expandable&&(a(document.body).children("div.jPicker.Container").css({zIndex:10}),m.css({zIndex:20})),k.window.effects.type){case"fade":m.fadeIn(k.window.effects.speed.show,b);break;case"slide":m.slideDown(k.window.effects.speed.show,b);break;case"show":default:m.show(k.window.effects.speed.show,b)}},pb=function(){var b=function(){k.window.expandable&&m.css({zIndex:10}),k.window.expandable&&!a.support.boxModel&&m.prev().remove()};switch(k.window.effects.type){case"fade":m.fadeOut(k.window.effects.speed.hide,b);break;case"slide":m.slideUp(k.window.effects.speed.hide,b);break;case"show":default:m.hide(k.window.effects.speed.hide,b)}},qb=function(){var e=k.window,f=e.expandable?a(j).next().find(".Container:first"):null;m=e.expandable?a("<div/>"):a(j),m.addClass("jPicker Container"),e.expandable&&m.hide(),m.get(0).onselectstart=function(a){return"input"!==a.target.nodeName.toLowerCase()?!1:void 0};var g=ub.active.val("all");e.alphaPrecision<0?e.alphaPrecision=0:e.alphaPrecision>2&&(e.alphaPrecision=2);var h='<table class="jPicker" cellpadding="0" cellspacing="0"><tbody>'+(e.expandable?'<tr><td class="Move" colspan="5">&nbsp;</td></tr>':"")+'<tr><td rowspan="9"><h2 class="Title">'+(e.title||tb.text.title)+'</h2><div class="Map"><span class="Map1">&nbsp;</span><span class="Map2">&nbsp;</span><span class="Map3">&nbsp;</span><img src="'+sb.clientPath+sb.colorMap.arrow.file+'" class="Arrow"/></div></td><td rowspan="9"><div class="Bar"><span class="Map1">&nbsp;</span><span class="Map2">&nbsp;</span><span class="Map3">&nbsp;</span><span class="Map4">&nbsp;</span><span class="Map5">&nbsp;</span><span class="Map6">&nbsp;</span><img src="'+sb.clientPath+sb.colorBar.arrow.file+'" class="Arrow"/></div></td><td colspan="2" class="Preview">'+tb.text.newColor+'<div><span class="Active" title="'+tb.tooltips.colors.newColor+'">&nbsp;</span><span class="Current" title="'+tb.tooltips.colors.currentColor+'">&nbsp;</span></div>'+tb.text.currentColor+'</td><td rowspan="9" class="Button"><input type="button" class="Ok" value="'+tb.text.ok+'" title="'+tb.tooltips.buttons.ok+'"/><input type="button" class="Cancel" value="'+tb.text.cancel+'" title="'+tb.tooltips.buttons.cancel+'"/><hr/><div class="Grid">&nbsp;</div></td></tr><tr class="Hue"><td class="Radio"><label title="'+tb.tooltips.hue.radio+'"><input type="radio" value="h"'+("h"==k.color.mode?' checked="checked"':"")+'/>H:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(null!=g?g.h:"")+'" title="'+tb.tooltips.hue.textbox+'"/>&nbsp;&deg;</td></tr><tr class="Saturation"><td class="Radio"><label title="'+tb.tooltips.saturation.radio+'"><input type="radio" value="s"'+("s"==k.color.mode?' checked="checked"':"")+'/>S:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(null!=g?g.s:"")+'" title="'+tb.tooltips.saturation.textbox+'"/>&nbsp;%</td></tr><tr class="Value"><td class="Radio"><label title="'+tb.tooltips.value.radio+'"><input type="radio" value="v"'+("v"==k.color.mode?' checked="checked"':"")+'/>V:</label><br/><br/></td><td class="Text"><input type="text" maxlength="3" value="'+(null!=g?g.v:"")+'" title="'+tb.tooltips.value.textbox+'"/>&nbsp;%<br/><br/></td></tr><tr class="Red"><td class="Radio"><label title="'+tb.tooltips.red.radio+'"><input type="radio" value="r"'+("r"==k.color.mode?' checked="checked"':"")+'/>R:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(null!=g?g.r:"")+'" title="'+tb.tooltips.red.textbox+'"/></td></tr><tr class="Green"><td class="Radio"><label title="'+tb.tooltips.green.radio+'"><input type="radio" value="g"'+("g"==k.color.mode?' checked="checked"':"")+'/>G:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(null!=g?g.g:"")+'" title="'+tb.tooltips.green.textbox+'"/></td></tr><tr class="Blue"><td class="Radio"><label title="'+tb.tooltips.blue.radio+'"><input type="radio" value="b"'+("b"==k.color.mode?' checked="checked"':"")+'/>B:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(null!=g?g.b:"")+'" title="'+tb.tooltips.blue.textbox+'"/></td></tr><tr class="Alpha"><td class="Radio">'+(e.alphaSupport?'<label title="'+tb.tooltips.alpha.radio+'"><input type="radio" value="a"'+("a"==k.color.mode?' checked="checked"':"")+"/>A:</label>":"&nbsp;")+'</td><td class="Text">'+(e.alphaSupport?'<input type="text" maxlength="'+(3+e.alphaPrecision)+'" value="'+(null!=g?Math.precision(100*g.a/255,e.alphaPrecision):"")+'" title="'+tb.tooltips.alpha.textbox+'"/>&nbsp;%':"&nbsp;")+'</td></tr><tr class="Hex"><td colspan="2" class="Text"><label title="'+tb.tooltips.hex.textbox+'">#:<input type="text" maxlength="6" class="Hex" value="'+(null!=g?g.hex:"")+'"/></label>'+(e.alphaSupport?'<input type="text" maxlength="2" class="AHex" value="'+(null!=g?g.ahex.substring(6):"")+'" title="'+tb.tooltips.hex.alpha+'"/></td>':"&nbsp;")+"</tr></tbody></table>";e.expandable?(m.html(h),0==a(document.body).children("div.jPicker.Container").length?a(document.body).prepend(m):a(document.body).children("div.jPicker.Container:last").after(m),m.mousedown(function(){a(document.body).children("div.jPicker.Container").css({zIndex:10}),m.css({zIndex:20})}),m.css({left:"left"==e.position.x?f.offset().left-530-("center"==e.position.y?25:0)+"px":"center"==e.position.x?f.offset().left-260+"px":"right"==e.position.x?f.offset().left-10+("center"==e.position.y?25:0)+"px":"screenCenter"==e.position.x?(a(document).width()>>1)-260+"px":f.offset().left+parseInt(e.position.x)+"px",position:"absolute",top:"top"==e.position.y?f.offset().top-312+"px":"center"==e.position.y?f.offset().top-156+"px":"bottom"==e.position.y?f.offset().top+25+"px":f.offset().top+parseInt(e.position.y)+"px"})):(m=a(j),m.html(h));var l=m.find("tbody:first");n=l.find("div.Map:first"),o=l.find("div.Bar:first");var B=n.find("span"),C=o.find("span");p=B.filter(".Map1:first"),q=B.filter(".Map2:first"),r=B.filter(".Map3:first"),s=C.filter(".Map1:first"),t=C.filter(".Map2:first"),u=C.filter(".Map3:first"),v=C.filter(".Map4:first"),w=C.filter(".Map5:first"),x=C.filter(".Map6:first"),y=new b(n,{map:{width:sb.colorMap.width,height:sb.colorMap.height},arrow:{image:sb.clientPath+sb.colorMap.arrow.file,width:sb.colorMap.arrow.width,height:sb.colorMap.arrow.height}}),y.bind(Q),z=new b(o,{map:{width:sb.colorBar.width,height:sb.colorBar.height},arrow:{image:sb.clientPath+sb.colorBar.arrow.file,width:sb.colorBar.arrow.width,height:sb.colorBar.arrow.height}}),z.bind(R),A=new c(l,ub.active,e.expandable&&e.bindToInput?e.input:null,e.alphaPrecision);var D=null!=g?g.hex:null,E=l.find(".Preview"),S=l.find(".Button");if(F=E.find(".Active:first").css({backgroundColor:D&&"#"+D||"transparent"}),G=E.find(".Current:first").css({backgroundColor:D&&"#"+D||"transparent"}).bind("click",bb),Z.call(j,G,Math.precision(100*ub.current.val("a"))/255,4),H=S.find(".Ok:first").bind("click",db),I=S.find(".Cancel:first").bind("click",cb),J=S.find(".Grid:first"),setTimeout(function(){X.call(j,p,sb.clientPath+"Maps.png"),X.call(j,q,sb.clientPath+"Maps.png"),X.call(j,r,sb.clientPath+"map-opacity.png"),X.call(j,s,sb.clientPath+"Bars.png"),X.call(j,t,sb.clientPath+"Bars.png"),X.call(j,u,sb.clientPath+"Bars.png"),X.call(j,v,sb.clientPath+"Bars.png"),X.call(j,w,sb.clientPath+"bar-opacity.png"),X.call(j,x,sb.clientPath+"AlphaBar.png"),X.call(j,E.find("div:first"),sb.clientPath+"preview-opacity.png")},0),l.find("td.Radio input").bind("click",ab),ub.quickList&&ub.quickList.length>0){var T="";for(i=0;i<ub.quickList.length;i++){"string"==(typeof ub.quickList[i]).toString().toLowerCase()&&(ub.quickList[i]=new d({hex:ub.quickList[i]}));var U=ub.quickList[i].val("a"),V=ub.quickList[i].val("ahex");!e.alphaSupport&&V&&(V=V.substring(0,6)+"ff");var W=ub.quickList[i].val("hex");T+='<span class="QuickColor"'+(V&&' title="#'+V+'"'||"")+' style="background-color:'+(W&&"#"+W||"")+";"+(W?"":"background-image:url("+sb.clientPath+"NoColor.png)")+(e.alphaSupport&&U&&255>U?";opacity:"+Math.precision(U/255,4)+";filter:Alpha(opacity="+Math.precision(U/2.55,4)+")":"")+'">&nbsp;</span>'}X.call(j,J,sb.clientPath+"bar-opacity.png"),J.html(T),J.find(".QuickColor").click(kb)}O.call(j,k.color.mode),ub.active.bind(P),a.isFunction(mb)&&ub.active.bind(mb),ub.current.bind(fb),e.expandable?(j.icon=f.parents(".Icon:first"),K=j.icon.find(".Color:first").css({backgroundColor:D&&"#"+D||"transparent"}),L=j.icon.find(".Alpha:first"),X.call(j,L,sb.clientPath+"bar-opacity.png"),Z.call(j,L,Math.precision(100*(255-(null!=g?g.a:0))/255,4)),M=j.icon.find(".Image:first").css({backgroundImage:"url('"+sb.clientPath+sb.picker.file+"')"}).bind("click",eb),e.bindToInput&&e.updateInputColor&&e.input.css({backgroundColor:D&&"#"+D||"transparent",color:null==g||g.v>75?"#000000":"#ffffff"}),N=l.find(".Move:first").bind("mousedown",hb),ub.active.bind(gb)):ob.call(j)},rb=function(){for(m.find("td.Radio input").unbind("click",ab),G.unbind("click",bb),I.unbind("click",cb),H.unbind("click",db),k.window.expandable&&(M.unbind("click",eb),N.unbind("mousedown",hb),j.icon=null),m.find(".QuickColor").unbind("click",kb),n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y.destroy(),y=null,z.destroy(),z=null,A.destroy(),A=null,F=null,G=null,H=null,I=null,J=null,lb=null,nb=null,mb=null,m.html(""),i=0;i<e.length;i++)e[i]==j&&e.splice(i,1)},sb=k.images,tb=k.localization,ub={active:"string"==(typeof k.color.active).toString().toLowerCase()?new d({ahex:!k.window.alphaSupport&&k.color.active?k.color.active.substring(0,6)+"ff":k.color.active}):new d({ahex:!k.window.alphaSupport&&k.color.active.val("ahex")?k.color.active.val("ahex").substring(0,6)+"ff":k.color.active.val("ahex")}),current:"string"==(typeof k.color.active).toString().toLowerCase()?new d({ahex:!k.window.alphaSupport&&k.color.active?k.color.active.substring(0,6)+"ff":k.color.active}):new d({ahex:!k.window.alphaSupport&&k.color.active.val("ahex")?k.color.active.val("ahex").substring(0,6)+"ff":k.color.active.val("ahex")}),quickList:k.color.quickList};a.extend(!0,j,{commitCallback:lb,liveCallback:mb,cancelCallback:nb,color:ub,show:ob,hide:pb,destroy:rb}),e.push(j),setTimeout(function(){qb.call(j)},0)})},a.fn.jPicker.defaults={window:{title:null,effects:{type:"slide",speed:{show:"slow",hide:"fast"}},position:{x:"screenCenter",y:"top"},expandable:!1,liveUpdate:!0,alphaSupport:!1,alphaPrecision:0,updateInputColor:!0},color:{mode:"h",active:new d({ahex:"#ffcc00ff"}),quickList:[new d({h:360,s:33,v:100}),new d({h:360,s:66,v:100}),new d({h:360,s:100,v:100}),new d({h:360,s:100,v:75}),new d({h:360,s:100,v:50}),new d({h:180,s:0,v:100}),new d({h:30,s:33,v:100}),new d({h:30,s:66,v:100}),new d({h:30,s:100,v:100}),new d({h:30,s:100,v:75}),new d({h:30,s:100,v:50}),new d({h:180,s:0,v:90}),new d({h:60,s:33,v:100}),new d({h:60,s:66,v:100}),new d({h:60,s:100,v:100}),new d({h:60,s:100,v:75}),new d({h:60,s:100,v:50}),new d({h:180,s:0,v:80}),new d({h:90,s:33,v:100}),new d({h:90,s:66,v:100}),new d({h:90,s:100,v:100}),new d({h:90,s:100,v:75}),new d({h:90,s:100,v:50}),new d({h:180,s:0,v:70}),new d({h:120,s:33,v:100}),new d({h:120,s:66,v:100}),new d({h:120,s:100,v:100}),new d({h:120,s:100,v:75}),new d({h:120,s:100,v:50}),new d({h:180,s:0,v:60}),new d({h:150,s:33,v:100}),new d({h:150,s:66,v:100}),new d({h:150,s:100,v:100}),new d({h:150,s:100,v:75}),new d({h:150,s:100,v:50}),new d({h:180,s:0,v:50}),new d({h:180,s:33,v:100}),new d({h:180,s:66,v:100}),new d({h:180,s:100,v:100}),new d({h:180,s:100,v:75}),new d({h:180,s:100,v:50}),new d({h:180,s:0,v:40}),new d({h:210,s:33,v:100}),new d({h:210,s:66,v:100}),new d({h:210,s:100,v:100}),new d({h:210,s:100,v:75}),new d({h:210,s:100,v:50}),new d({h:180,s:0,v:30}),new d({h:240,s:33,v:100}),new d({h:240,s:66,v:100}),new d({h:240,s:100,v:100}),new d({h:240,s:100,v:75}),new d({h:240,s:100,v:50}),new d({h:180,s:0,v:20}),new d({h:270,s:33,v:100}),new d({h:270,s:66,v:100}),new d({h:270,s:100,v:100}),new d({h:270,s:100,v:75}),new d({h:270,s:100,v:50}),new d({h:180,s:0,v:10}),new d({h:300,s:33,v:100}),new d({h:300,s:66,v:100}),new d({h:300,s:100,v:100}),new d({h:300,s:100,v:75}),new d({h:300,s:100,v:50}),new d({h:180,s:0,v:0}),new d({h:330,s:33,v:100}),new d({h:330,s:66,v:100}),new d({h:330,s:100,v:100}),new d({h:330,s:100,v:75}),new d({h:330,s:100,v:50}),new d]},images:{clientPath:"/BMS DEV/Bin/img/",colorMap:{width:256,height:256,arrow:{file:"mappoint.gif",width:15,height:15}},colorBar:{width:20,height:256,arrow:{file:"rangearrows.gif",width:20,height:7}},picker:{file:"picker.gif",width:25,height:24}},localization:{text:{title:"Drag Markers To Pick A Color",newColor:"new",currentColor:"current",ok:"OK",cancel:"Cancel"},tooltips:{colors:{newColor:"New Color - Press &ldquo;OK&rdquo; To Commit",currentColor:"Click To Revert To Original Color"},buttons:{ok:"Commit To This Color Selection",cancel:"Cancel And Revert To Original Color"},hue:{radio:"Set To &ldquo;Hue&rdquo; Color Mode",textbox:"Enter A &ldquo;Hue&rdquo; Value (0-360&deg;)"},saturation:{radio:"Set To &ldquo;Saturation&rdquo; Color Mode",textbox:"Enter A &ldquo;Saturation&rdquo; Value (0-100%)"},value:{radio:"Set To &ldquo;Value&rdquo; Color Mode",textbox:"Enter A &ldquo;Value&rdquo; Value (0-100%)"},red:{radio:"Set To &ldquo;Red&rdquo; Color Mode",textbox:"Enter A &ldquo;Red&rdquo; Value (0-255)"},green:{radio:"Set To &ldquo;Green&rdquo; Color Mode",textbox:"Enter A &ldquo;Green&rdquo; Value (0-255)"},blue:{radio:"Set To &ldquo;Blue&rdquo; Color Mode",textbox:"Enter A &ldquo;Blue&rdquo; Value (0-255)"},alpha:{radio:"Set To &ldquo;Alpha&rdquo; Color Mode",textbox:"Enter A &ldquo;Alpha&rdquo; Value (0-100)"},hex:{textbox:"Enter A &ldquo;Hex&rdquo; Color Value (#000000-#ffffff)",alpha:"Enter A &ldquo;Alpha&rdquo; Value (#00-#ff)"}}}}}(jQuery,"1.1.6"),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+100*(c/d),g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",n.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a,b){return"string"==typeof a?a:a[b%a.length]}function i(a){return"undefined"==typeof this?new i(a):(this.opts=f(a||{},i.defaults,o),void 0)}function j(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}n.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function g(a,g,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:h(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)g(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)g(i);return b(a,m)},i.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};i.defaults={},f(i.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),j=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+j)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+j)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!k){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function s(){m++;for(var a=0;a<h.lines;a++)l=Math.max(1-(m+(h.lines-a)*r)%p*q,h.opacity),f.opacity(i,a*h.direction+n,l,h);f.timeout=f.el&&setTimeout(s,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*j+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,j=0,l=(f.lines-1)*(1-f.direction)/2;j<f.lines;j++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:k&&c(f.opacity,f.trail,l+j*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,g(h(f.color,j),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var p=e(a("group"),{behavior:"url(#default#VML)"});return!d(p,"transform")&&p.adj?j():k=d(p,"animation"),i});